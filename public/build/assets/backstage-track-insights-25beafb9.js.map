{"version":3,"file":"backstage-track-insights-25beafb9.js","sources":["../../../common/resources/client/utils/date/start-of-day.ts","../../../common/resources/client/utils/date/end-of-day.ts","../../../common/resources/client/i18n/get-user-timezone.ts","../../../common/resources/client/ui/forms/input-field/date/date-range-picker/dialog/date-range-presets.ts","../../../common/resources/client/icons/material/DateRange.tsx","../../../common/resources/client/ui/forms/input-field/input.tsx","../../../common/resources/client/ui/forms/input-field/date/date-range-picker/date-picker-field.tsx","../../../common/resources/client/ui/forms/input-field/date/utils.ts","../../../common/resources/client/ui/forms/input-field/date/use-base-date-picker-state.ts","../../../common/resources/client/i18n/use-current-date-time.ts","../../../common/resources/client/ui/forms/input-field/date/date-range-picker/use-date-range-picker-state.ts","../../../common/resources/client/icons/material/ArrowRightAlt.tsx","../../../common/resources/client/ui/forms/input-field/date/segments/utils/adjust-segment.ts","../../../common/resources/client/ui/forms/input-field/date/segments/utils/set-segment.ts","../../../common/resources/client/ui/forms/input-field/date/segments/utils/page-step.ts","../../../common/resources/client/ui/forms/input-field/date/segments/editable-date-segment.tsx","../../../common/resources/client/ui/forms/input-field/date/segments/literal-segment.tsx","../../../common/resources/client/ui/forms/input-field/date/segments/utils/get-segment-limits.ts","../../../common/resources/client/ui/forms/input-field/date/segments/date-segment-list.tsx","../../../common/resources/client/ui/forms/input-field/date/calendar/calendar-cell.tsx","../../../common/resources/client/ui/forms/input-field/date/calendar/calendar-month.tsx","../../../common/resources/client/ui/forms/input-field/date/calendar/calendar.tsx","../../../common/resources/client/i18n/formatted-date-time-range.tsx","../../../common/resources/client/ui/forms/input-field/date/date-range-picker/dialog/date-preset-list.tsx","../../../common/resources/client/ui/forms/input-field/date/date-range-picker/dialog/date-range-dialog.tsx","../../../common/resources/client/datatable/requests/paginated-resources.ts","../../../common/resources/client/users/queries/use-normalized-models.ts","../../../common/resources/client/users/queries/use-normalized-model.ts","../../../common/resources/client/ui/forms/normalized-model-field.tsx","../../../common/resources/client/ui/forms/input-field/date/date-picker/use-date-picker-state.ts","../../../common/resources/client/ui/forms/input-field/date/date-picker/date-picker.tsx","../../../common/resources/client/ui/forms/input-field/chip-field/string-to-chip-value.ts","../../../common/resources/client/ui/forms/input-field/chip-field/chip-field.tsx","../../../common/resources/client/ui/forms/input-field/chip-field/form-chip-field.tsx","../../../common/resources/client/icons/material/DragHandle.tsx","../../../common/resources/client/utils/hooks/sticky-sentinel.ts","../../../common/resources/client/admin/crupdate-resource-layout.tsx","../../../common/resources/client/ui/overlays/dialog/info-dialog-trigger/info-dialog-trigger-icon.tsx","../../../common/resources/client/ui/overlays/dialog/info-dialog-trigger/info-dialog-trigger.tsx","../../../resources/client/admin/tracks-datatable-page/music.svg","../../../resources/client/web-player/artists/artist-picker/use-artist-picker-suggestions.ts","../../../resources/client/web-player/artists/artist-picker/form-artist-picker.tsx","../../../common/resources/client/tags/form-normalized-model-chip-field.tsx","../../../common/resources/client/tags/tag.ts","../../../common/resources/client/icons/material/FileUpload.tsx","../../../resources/client/admin/tracks-datatable-page/track-form/track-upload-status-text.tsx","../../../resources/client/admin/tracks-datatable-page/track-form/track-upload-progress.tsx","../../../resources/client/admin/tracks-datatable-page/requests/use-extract-track-file-metadata.ts","../../../resources/client/web-player/backstage/upload-page/use-track-uploader.ts","../../../resources/client/web-player/backstage/upload-page/use-track-upload.ts","../../../resources/client/admin/tracks-datatable-page/track-form/track-form-upload-button.tsx","../../../resources/client/admin/tracks-datatable-page/track-form/track-form.tsx","../../../resources/client/admin/tracks-datatable-page/requests/use-create-track.ts","../../../resources/client/admin/tracks-datatable-page/crupdate/use-create-track-form.ts","../../../resources/client/admin/tracks-datatable-page/crupdate/create-track-page.tsx","../../../resources/client/admin/tracks-datatable-page/requests/use-update-track.ts","../../../resources/client/admin/tracks-datatable-page/crupdate/use-update-track-form.ts","../../../resources/client/admin/tracks-datatable-page/crupdate/update-track-page.tsx","../../../resources/client/admin/albums-datatable-page/requests/use-create-album.ts","../../../resources/client/admin/albums-datatable-page/requests/use-update-album.ts","../../../resources/client/admin/tracks-datatable-page/track-form/update-track-dialog.tsx","../../../resources/client/admin/tracks-datatable-page/track-form/create-track-dialog.tsx","../../../resources/client/admin/albums-datatable-page/album-form/album-tracks-form.tsx","../../../resources/client/admin/albums-datatable-page/album-form/album-form.tsx","../../../resources/client/admin/albums-datatable-page/update-album-page.tsx","../../../resources/client/web-player/backstage/upload-page/album-uploader.tsx","../../../resources/client/web-player/backstage/upload-page/tracks-uploader.tsx","../../../resources/client/web-player/backstage/upload-page/album-border.png","../../../resources/client/web-player/backstage/upload-page/uploaded-media-preview.tsx","../../../resources/client/web-player/backstage/upload-page/drop-tarket-mask.tsx","../../../resources/client/web-player/backstage/upload-page/use-user-minutes-limit.ts","../../../resources/client/web-player/backstage/images/light-bg.svg","../../../resources/client/web-player/backstage/images/dark-bg.svg","../../../resources/client/web-player/backstage/backstage-layout.tsx","../../../resources/client/web-player/backstage/upload-page/upload-page.tsx","../../../resources/client/admin/albums-datatable-page/create-album-page.tsx","../../../resources/client/web-player/backstage/requests/use-backstage-request.ts","../../../common/resources/client/icons/material/DocumentScanner.tsx","../../../resources/client/admin/artist-datatable-page/artist-form/artist-albums-table.tsx","../../../resources/client/admin/artist-datatable-page/artist-form/crupdate-artist-form.tsx","../../../resources/client/admin/artist-datatable-page/requests/use-update-artist.ts","../../../resources/client/admin/artist-datatable-page/update-artist-page.tsx","../../../common/resources/client/admin/analytics/report-date-selector.tsx","../../../common/resources/client/charts/chart-layout.tsx","../../../common/resources/client/charts/chart-loading-indicator.tsx","../../../common/resources/client/charts/base-chart.tsx","../../../common/resources/client/charts/data/format-report-data.ts","../../../common/resources/client/charts/chart-colors.tsx","../../../common/resources/client/charts/line-chart.tsx","../../../common/resources/client/charts/polar-area-chart.tsx","../../../common/resources/client/admin/analytics/geo-chart/use-google-geo-chart.ts","../../../common/resources/client/icons/material/ArrowBack.tsx","../../../common/resources/client/i18n/formatted-country-name.tsx","../../../common/resources/client/admin/analytics/geo-chart/geo-chart.tsx","../../../resources/client/admin/reports/requests/use-insights-report.ts","../../../common/resources/client/icons/material/Info.tsx","../../../resources/client/admin/reports/top-models-chart-layout.tsx","../../../resources/client/admin/reports/insights-report-charts.tsx","../../../resources/client/web-player/backstage/insights/backstage-insights-layout.tsx","../../../resources/client/web-player/backstage/insights/backstage-insights-title.tsx","../../../resources/client/web-player/backstage/insights/backstage-artist-insights.tsx","../../../resources/client/web-player/backstage/insights/backstage-album-insights.tsx","../../../resources/client/web-player/backstage/insights/backstage-track-insights.tsx"],"sourcesContent":["import {ZonedDateTime} from '@internationalized/date';\n\nexport function startOfDay(date: ZonedDateTime): ZonedDateTime {\n  return date.set({hour: 0, minute: 0, second: 0, millisecond: 0});\n}\n","import {ZonedDateTime} from '@internationalized/date';\n\nexport function endOfDay(date: ZonedDateTime): ZonedDateTime {\n  return date.set({\n    hour: 24 - 1,\n    minute: 60 - 1,\n    second: 60 - 1,\n    millisecond: 1000 - 1,\n  });\n}\n","import {getBootstrapData} from '../core/bootstrap-data/use-backend-bootstrap-data';\nimport {getLocalTimeZone} from '@internationalized/date';\n\nexport function getUserTimezone(): string {\n  const defaultTimezone = getBootstrapData().settings.dates.default_timezone;\n  const preferredTimezone =\n    getBootstrapData().user?.timezone || defaultTimezone || 'auto';\n\n  if (!preferredTimezone || preferredTimezone === 'auto') {\n    return getLocalTimeZone();\n  }\n  return preferredTimezone;\n}\n","import {DateRangeValue} from '../date-range-value';\nimport {message} from '../../../../../../i18n/message';\nimport {MessageDescriptor} from '../../../../../../i18n/message-descriptor';\nimport {\n  endOfWeek,\n  endOfYear,\n  now,\n  startOfWeek,\n  startOfYear,\n} from '@internationalized/date';\nimport {startOfDay} from '../../../../../../utils/date/start-of-day';\nimport {endOfDay} from '../../../../../../utils/date/end-of-day';\nimport {getBootstrapData} from '../../../../../../core/bootstrap-data/use-backend-bootstrap-data';\nimport {getUserTimezone} from '../../../../../../i18n/get-user-timezone';\n\nconst Now = startOfDay(now(getUserTimezone()));\nconst locale = getBootstrapData().i18n?.language || 'en';\n\nexport interface DateRangePreset {\n  key: number;\n  label: MessageDescriptor;\n  getRangeValue: () => DateRangeValue;\n}\n\nexport const DateRangePresets: DateRangePreset[] = [\n  {\n    key: 0,\n    label: message('Today'),\n    getRangeValue: () => ({\n      preset: 0,\n      start: Now,\n      end: endOfDay(Now),\n    }),\n  },\n  {\n    key: 1,\n    label: message('Yesterday'),\n    getRangeValue: () => ({\n      preset: 1,\n      start: Now.subtract({days: 1}),\n      end: endOfDay(Now).subtract({days: 1}),\n    }),\n  },\n  {\n    key: 2,\n    label: message('This week'),\n    getRangeValue: () => ({\n      preset: 2,\n      start: startOfWeek(Now, locale),\n      end: endOfWeek(endOfDay(Now), locale),\n    }),\n  },\n  {\n    key: 3,\n    label: message('Last week'),\n    getRangeValue: () => {\n      const start = startOfWeek(Now, locale).subtract({days: 7});\n      return {\n        preset: 3,\n        start,\n        end: start.add({days: 6}),\n      };\n    },\n  },\n  {\n    key: 4,\n    label: message('Last 7 days'),\n    getRangeValue: () => ({\n      preset: 4,\n      start: Now.subtract({days: 7}),\n      end: endOfDay(Now),\n    }),\n  },\n  {\n    key: 5,\n    label: message('Last 14 days'),\n    getRangeValue: () => ({\n      preset: 5,\n      start: Now.subtract({days: 14}),\n      end: endOfDay(Now),\n    }),\n  },\n  {\n    key: 6,\n    label: message('Last 30 days'),\n    getRangeValue: () => ({\n      preset: 6,\n      start: Now.subtract({days: 30}),\n      end: endOfDay(Now),\n    }),\n  },\n  {\n    key: 7,\n    label: message('Last 3 months'),\n    getRangeValue: () => ({\n      preset: 7,\n      start: Now.subtract({months: 3}),\n      end: endOfDay(Now),\n    }),\n  },\n  {\n    key: 8,\n    label: message('Last 12 months'),\n    getRangeValue: () => ({\n      preset: 8,\n      start: Now.subtract({months: 12}),\n      end: endOfDay(Now),\n    }),\n  },\n  {\n    key: 9,\n    label: message('This year'),\n    getRangeValue: () => ({\n      preset: 9,\n      start: startOfYear(Now),\n      end: endOfYear(endOfDay(Now)),\n    }),\n  },\n  {\n    key: 10,\n    label: message('Last year'),\n    getRangeValue: () => ({\n      preset: 10,\n      start: startOfYear(Now).subtract({years: 1}),\n      end: endOfYear(endOfDay(Now)).subtract({years: 1}),\n    }),\n  },\n];\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const DateRangeIcon = createSvgIcon(\n  <path d=\"M7 11h2v2H7v-2zm14-5v14c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2l.01-14c0-1.1.88-2 1.99-2h1V2h2v2h8V2h2v2h1c1.1 0 2 .9 2 2zM5 8h14V6H5v2zm14 12V10H5v10h14zm-4-7h2v-2h-2v2zm-4 0h2v-2h-2v2z\" />\n, 'DateRangeOutlined');\n","import {FocusScope} from '@react-aria/focus';\nimport React, {ComponentPropsWithoutRef, CSSProperties, ReactNode} from 'react';\nimport clsx from 'clsx';\n\ninterface InputProps {\n  className?: string;\n  children: ReactNode;\n  autoFocus?: boolean;\n  disabled?: boolean;\n  style?: CSSProperties;\n  inputProps?: ComponentPropsWithoutRef<'div'>;\n  wrapperProps?: ComponentPropsWithoutRef<'div'>;\n  onClick?: React.MouseEventHandler<HTMLDivElement>;\n}\n\nexport const Input = React.forwardRef<HTMLDivElement, InputProps>(\n  (props, ref) => {\n    const {\n      children,\n      inputProps,\n      wrapperProps,\n      className,\n      autoFocus,\n      style,\n      onClick,\n    } = props;\n\n    return (\n      <div {...wrapperProps} onClick={onClick}>\n        <div\n          {...inputProps}\n          role=\"group\"\n          className={clsx(\n            className,\n            'flex items-center focus-within:ring focus-within:ring-primary/focus focus-within:border-primary/60'\n          )}\n          ref={ref}\n          style={style}\n        >\n          <FocusScope autoFocus={autoFocus}>{children}</FocusScope>\n        </div>\n      </div>\n    );\n  }\n);\n","import React, {ComponentPropsWithoutRef, FocusEventHandler, Ref} from 'react';\nimport clsx from 'clsx';\nimport {createFocusManager} from '@react-aria/focus';\nimport {mergeProps, useObjectRef} from '@react-aria/utils';\nimport {getInputFieldClassNames} from '../../get-input-field-class-names';\nimport {Field, FieldProps} from '../../field';\nimport {Input} from '../../input';\nimport {useField} from '../../use-field';\n\nexport interface DatePickerFieldProps\n  extends Omit<FieldProps, 'fieldClassNames'> {\n  inputRef?: Ref<HTMLDivElement>;\n  onBlur?: FocusEventHandler;\n  showCalendarFooter?: boolean;\n}\nexport const DatePickerField = React.forwardRef<\n  HTMLDivElement,\n  DatePickerFieldProps\n>(({inputRef, wrapperProps, children, onBlur, ...other}, ref) => {\n  const fieldClassNames = getInputFieldClassNames(other);\n  const objRef = useObjectRef(ref);\n\n  const {fieldProps, inputProps} = useField({\n    ...other,\n    focusRef: objRef,\n    labelElementType: 'span',\n  });\n\n  fieldClassNames.wrapper = clsx(\n    fieldClassNames.wrapper,\n    other.disabled && 'pointer-events-none'\n  );\n\n  return (\n    <Field\n      wrapperProps={mergeProps<ComponentPropsWithoutRef<'div'>[]>(\n        wrapperProps!,\n        {\n          onBlur: e => {\n            if (!objRef.current.contains(e.relatedTarget)) {\n              onBlur?.(e);\n            }\n          },\n          onClick: () => {\n            // focus first segment when clicking on label or somewhere else in the field, but no directly on segment\n            const focusManager = createFocusManager(objRef);\n            focusManager.focusFirst();\n          },\n        }\n      )}\n      fieldClassNames={fieldClassNames}\n      ref={objRef}\n      {...fieldProps}\n    >\n      <Input\n        inputProps={inputProps}\n        className={clsx(fieldClassNames.input, 'gap-10')}\n        ref={inputRef}\n      >\n        {children}\n      </Input>\n    </Field>\n  );\n});\n","import {CalendarDate, DateValue} from '@internationalized/date';\n\nexport function getDefaultGranularity(date: DateValue) {\n  if (date instanceof CalendarDate) {\n    return 'day';\n  }\n  return 'minute';\n}\n\nexport function dateIsInvalid(\n  date: CalendarDate,\n  min?: DateValue,\n  max?: DateValue\n) {\n  return (\n    (min != null && date.compare(min) < 0) ||\n    (max != null && date.compare(max) > 0)\n  );\n}\n","import {useState} from 'react';\nimport {DateValue, toZoned, ZonedDateTime} from '@internationalized/date';\nimport {getDefaultGranularity} from './utils';\nimport type {DatePickerValueProps} from './date-picker/use-date-picker-state';\nimport {DateRangeValue} from './date-range-picker/date-range-value';\nimport {useUserTimezone} from '@common/i18n/use-user-timezone';\n\nexport function useBaseDatePickerState(\n  selectedDate: DateValue,\n  props:\n    | DatePickerValueProps<ZonedDateTime>\n    | DatePickerValueProps<Partial<DateRangeValue>, DateRangeValue>\n) {\n  const timezone = useUserTimezone();\n  const [calendarIsOpen, setCalendarIsOpen] = useState(false);\n  const closeDialogOnSelection = props.closeDialogOnSelection ?? true;\n\n  const granularity = props.granularity || getDefaultGranularity(selectedDate);\n  const min = props.min ? toZoned(props.min, timezone) : undefined;\n  const max = props.max ? toZoned(props.max, timezone) : undefined;\n\n  return {\n    timezone,\n    granularity,\n    min,\n    max,\n    calendarIsOpen,\n    setCalendarIsOpen,\n    closeDialogOnSelection,\n  };\n}\n","import {useMemo} from 'react';\nimport {now} from '@internationalized/date';\nimport {useUserTimezone} from './use-user-timezone';\n\nexport function useCurrentDateTime() {\n  const timezone = useUserTimezone();\n  return useMemo(() => {\n    return now(timezone);\n  }, [timezone]);\n}\n","import {useControlledState} from '@react-stately/utils';\nimport {HTMLAttributes, useCallback, useState} from 'react';\nimport {\n  CalendarDate,\n  DateValue,\n  endOfMonth,\n  isSameDay,\n  isSameMonth,\n  maxDate,\n  minDate,\n  startOfMonth,\n  toCalendarDate,\n  toZoned,\n  ZonedDateTime,\n} from '@internationalized/date';\nimport {\n  BaseDatePickerState,\n  DatePickerValueProps,\n} from '../date-picker/use-date-picker-state';\nimport {DateRangeValue} from './date-range-value';\nimport {useBaseDatePickerState} from '../use-base-date-picker-state';\nimport {startOfDay} from '@common/utils/date/start-of-day';\nimport {endOfDay} from '@common/utils/date/end-of-day';\nimport {useCurrentDateTime} from '@common/i18n/use-current-date-time';\n\nexport interface IsPlaceholderValue {\n  start: boolean;\n  end: boolean;\n}\n\nexport type DateRangePickerState = BaseDatePickerState<\n  DateRangeValue,\n  IsPlaceholderValue\n>;\n\nexport function useDateRangePickerState(\n  props: DatePickerValueProps<Partial<DateRangeValue>, DateRangeValue>\n): DateRangePickerState {\n  const now = useCurrentDateTime();\n  const [isPlaceholder, setIsPlaceholder] = useState<IsPlaceholderValue>({\n    start: (!props.value || !props.value.start) && !props.defaultValue?.start,\n    end: (!props.value || !props.value.end) && !props.defaultValue?.end,\n  });\n\n  // if user clears the date, we will want to still keep an\n  // instance internally, but return null via \"onChange\" callback\n  const setStateValue = props.onChange;\n  const [internalValue, setInternalValue] = useControlledState(\n    props.value ? completeRange(props.value, now) : undefined,\n    !props.value ? completeRange(props.defaultValue, now) : undefined,\n    props.onChange\n  );\n\n  const {\n    min,\n    max,\n    granularity,\n    timezone,\n    calendarIsOpen,\n    setCalendarIsOpen,\n    closeDialogOnSelection,\n  } = useBaseDatePickerState(internalValue.start, props);\n\n  const clear = useCallback(() => {\n    setIsPlaceholder({start: true, end: true});\n    setInternalValue(completeRange(null, now));\n    setStateValue?.(null);\n    setCalendarIsOpen(false);\n  }, [now, setInternalValue, setStateValue, setCalendarIsOpen]);\n\n  const [anchorDate, setAnchorDate] = useState<CalendarDate | null>(null);\n  const [isHighlighting, setIsHighlighting] = useState(false);\n  const [highlightedRange, setHighlightedRange] =\n    useState<DateRangeValue>(internalValue);\n  const [calendarDates, setCalendarDates] = useState<CalendarDate[]>(() => {\n    return rangeToCalendarDates(internalValue, max);\n  });\n\n  const constrainRange = useCallback(\n    (range: DateRangeValue): DateRangeValue => {\n      let start = range.start;\n      let end = range.end;\n\n      // make sure start date is after min date and before max date/range end\n      if (min) {\n        start = maxDate(start, min);\n      }\n      const startMax = max ? minDate(max, end) : end;\n      start = minDate(start, startMax);\n\n      // make sure end date is after min date/range start and before max date\n      const endMin = min ? maxDate(min, start) : start;\n      end = maxDate(end, endMin);\n\n      if (max) {\n        end = minDate(end, max);\n      }\n\n      return {start: toZoned(start, timezone), end: toZoned(end, timezone)};\n    },\n    [min, max, timezone]\n  );\n\n  const setSelectedValue = useCallback(\n    (newRange: DateRangeValue) => {\n      const value = {\n        ...constrainRange(newRange),\n        preset: newRange.preset,\n      };\n      setInternalValue(value);\n      setHighlightedRange(value);\n      setCalendarDates(rangeToCalendarDates(value, max));\n      setIsPlaceholder({start: false, end: false});\n    },\n    [setInternalValue, constrainRange, max]\n  );\n\n  const dayIsActive = useCallback(\n    (day: CalendarDate) => {\n      return (\n        (!isPlaceholder.start && isSameDay(day, highlightedRange.start)) ||\n        (!isPlaceholder.end && isSameDay(day, highlightedRange.end))\n      );\n    },\n    [highlightedRange, isPlaceholder]\n  );\n\n  const dayIsHighlighted = useCallback(\n    (day: CalendarDate) => {\n      return (\n        (isHighlighting || (!isPlaceholder.start && !isPlaceholder.end)) &&\n        day.compare(highlightedRange.start) >= 0 &&\n        day.compare(highlightedRange.end) <= 0\n      );\n    },\n    [highlightedRange, isPlaceholder, isHighlighting]\n  );\n\n  const dayIsRangeStart = useCallback(\n    (day: CalendarDate) => isSameDay(day, highlightedRange.start),\n    [highlightedRange]\n  );\n\n  const dayIsRangeEnd = useCallback(\n    (day: CalendarDate) => isSameDay(day, highlightedRange.end),\n    [highlightedRange]\n  );\n\n  const getCellProps = useCallback(\n    (date: CalendarDate, isSameMonth: boolean): HTMLAttributes<HTMLElement> => {\n      return {\n        onPointerEnter: () => {\n          if (isHighlighting && isSameMonth) {\n            setHighlightedRange(\n              makeRange({start: anchorDate!, end: date, timezone})\n            );\n          }\n        },\n        onClick: () => {\n          if (!isHighlighting) {\n            setIsHighlighting(true);\n            setAnchorDate(date);\n            setHighlightedRange(makeRange({start: date, end: date, timezone}));\n          } else {\n            const finalRange = makeRange({\n              start: startOfDay(toZoned(anchorDate!, timezone)),\n              end: endOfDay(toZoned(date, timezone)),\n              timezone,\n            });\n            setIsHighlighting(false);\n            setAnchorDate(null);\n            setSelectedValue?.(finalRange);\n            if (closeDialogOnSelection) {\n              setCalendarIsOpen?.(false);\n            }\n          }\n        },\n      };\n    },\n    [\n      anchorDate,\n      isHighlighting,\n      setSelectedValue,\n      setCalendarIsOpen,\n      closeDialogOnSelection,\n      timezone,\n    ]\n  );\n\n  return {\n    selectedValue: internalValue,\n    setSelectedValue,\n    calendarIsOpen,\n    setCalendarIsOpen,\n    dayIsActive,\n    dayIsHighlighted,\n    dayIsRangeStart,\n    dayIsRangeEnd,\n    getCellProps,\n    calendarDates,\n    setIsPlaceholder,\n    isPlaceholder,\n    clear,\n    setCalendarDates,\n    min,\n    max,\n    granularity,\n    timezone,\n    closeDialogOnSelection,\n  };\n}\n\nfunction rangeToCalendarDates(\n  range: DateRangeValue,\n  max?: DateValue\n): CalendarDate[] {\n  let start = toCalendarDate(startOfMonth(range.start));\n  let end = toCalendarDate(endOfMonth(range.end));\n\n  // make sure we don't show the same month twice\n  if (isSameMonth(start, end)) {\n    end = endOfMonth(end.add({months: 1}));\n  }\n\n  // if next month is disabled, show previous instead\n  if (max && end.compare(max) > 0) {\n    end = start;\n    start = startOfMonth(start.subtract({months: 1}));\n  }\n  return [start, end];\n}\n\ninterface MakeRangeProps {\n  start: DateValue;\n  end: DateValue;\n  timezone: string;\n}\nfunction makeRange(props: MakeRangeProps): DateRangeValue {\n  const start = toZoned(props.start, props.timezone);\n  const end = toZoned(props.end, props.timezone);\n  if (start.compare(end) > 0) {\n    return {start: end, end: start};\n  }\n  return {start, end};\n}\n\nfunction completeRange(\n  range: Partial<DateRangeValue> | null | undefined,\n  now: ZonedDateTime\n): DateRangeValue {\n  if (range?.start && range?.end) {\n    return range as DateRangeValue;\n  } else if (!range?.start && range?.end) {\n    range.start = range.end.subtract({months: 1});\n    return range as DateRangeValue;\n  } else if (!range?.end && range?.start) {\n    range.end = range.start.add({months: 1});\n    return range as DateRangeValue;\n  }\n  return {start: now, end: now.add({months: 1})};\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const ArrowRightAltIcon = createSvgIcon(\n  <path d=\"M16.01 11H4v2h12.01v3L20 12l-3.99-4v3z\" />\n, 'ArrowRightAltOutlined');\n","import {ZonedDateTime} from '@internationalized/date';\n\nexport function adjustSegment(\n  value: ZonedDateTime,\n  part: string,\n  amount: number,\n  options: Intl.ResolvedDateTimeFormatOptions\n) {\n  switch (part) {\n    case 'era':\n    case 'year':\n    case 'month':\n    case 'day':\n      return value.cycle(part, amount, {round: part === 'year'});\n  }\n\n  if ('hour' in value) {\n    switch (part) {\n      case 'dayPeriod': {\n        const hours = value.hour;\n        const isPM = hours >= 12;\n        return value.set({hour: isPM ? hours - 12 : hours + 12});\n      }\n      case 'hour':\n      case 'minute':\n      case 'second':\n        return value.cycle(part, amount, {\n          round: part !== 'hour',\n          hourCycle: options.hour12 ? 12 : 24,\n        });\n    }\n  }\n\n  return value;\n}\n","import {ZonedDateTime} from '@internationalized/date';\n\nexport function setSegment(\n  value: ZonedDateTime,\n  part: string,\n  segmentValue: number,\n  options: Intl.ResolvedDateTimeFormatOptions\n) {\n  switch (part) {\n    case 'day':\n    case 'month':\n    case 'year':\n      return value.set({[part]: segmentValue});\n  }\n\n  if ('hour' in value) {\n    switch (part) {\n      case 'dayPeriod': {\n        const hours = value.hour;\n        const wasPM = hours >= 12;\n        const isPM = segmentValue >= 12;\n        if (isPM === wasPM) {\n          return value;\n        }\n        return value.set({hour: wasPM ? hours - 12 : hours + 12});\n      }\n      case 'hour':\n        // In 12 hour time, ensure that AM/PM does not change\n        if (options.hour12) {\n          const hours = value.hour;\n          const wasPM = hours >= 12;\n          if (!wasPM && segmentValue === 12) {\n            segmentValue = 0;\n          }\n          if (wasPM && segmentValue < 12) {\n            segmentValue += 12;\n          }\n        }\n      // fallthrough\n      case 'minute':\n      case 'second':\n        return value.set({[part]: segmentValue});\n    }\n  }\n\n  return value;\n}\n","export const PAGE_STEP = {\n  year: 5,\n  month: 2,\n  day: 7,\n  hour: 2,\n  minute: 15,\n  second: 15,\n  dayPeriod: 1,\n};\n","import {useFocusManager} from '@react-aria/focus';\nimport React, {\n  ComponentPropsWithoutRef,\n  HTMLAttributes,\n  KeyboardEventHandler,\n  useMemo,\n  useRef,\n} from 'react';\nimport {NumberParser} from '@internationalized/number';\nimport {mergeProps} from '@react-aria/utils';\nimport {today, ZonedDateTime} from '@internationalized/date';\nimport {useSelectedLocale} from '../../../../../i18n/selected-locale';\nimport {useDateFormatter} from '../../../../../i18n/use-date-formatter';\nimport {DatePickerState} from '../date-picker/use-date-picker-state';\nimport {adjustSegment} from './utils/adjust-segment';\nimport {setSegment} from './utils/set-segment';\nimport {PAGE_STEP} from './utils/page-step';\nimport {DateRangePickerState} from '../date-range-picker/use-date-range-picker-state';\nimport {useIsMobileMediaQuery} from '../../../../../utils/hooks/is-mobile-media-query';\n\nexport interface EditableSegment {\n  type: 'day' | 'dayPeriod' | 'hour' | 'minute' | 'month' | 'second' | 'year';\n  text: string;\n  value: number;\n  minValue: number;\n  maxValue: number;\n  minLength: number;\n}\n\ninterface DatePickerSegmentProps {\n  segment: EditableSegment;\n  domProps?: ComponentPropsWithoutRef<'div'>;\n  state: DatePickerState | DateRangePickerState;\n  value: ZonedDateTime;\n  onChange: (newValue: ZonedDateTime) => void;\n  isPlaceholder?: boolean;\n}\nexport function EditableDateSegment({\n  segment,\n  domProps,\n  value,\n  onChange,\n  isPlaceholder,\n  state: {timezone, calendarIsOpen, setCalendarIsOpen},\n}: DatePickerSegmentProps) {\n  const isMobile = useIsMobileMediaQuery();\n  const enteredKeys = useRef('');\n  const {localeCode} = useSelectedLocale();\n  const focusManager = useFocusManager();\n  const formatter = useDateFormatter({timeZone: timezone});\n  const parser = useMemo(\n    () => new NumberParser(localeCode, {maximumFractionDigits: 0}),\n    [localeCode]\n  );\n\n  const setSegmentValue = (newValue: number) => {\n    onChange(\n      setSegment(value, segment.type, newValue, formatter.resolvedOptions())\n    );\n  };\n\n  const adjustSegmentValue = (amount: number) => {\n    onChange(\n      adjustSegment(value, segment.type, amount, formatter.resolvedOptions())\n    );\n  };\n\n  const backspace = () => {\n    if (parser.isValidPartialNumber(segment.text)) {\n      const newValue = segment.text.slice(0, -1);\n      const parsed = parser.parse(newValue);\n      if (newValue.length === 0 || parsed === 0) {\n        const now = today(timezone);\n        if (segment.type in now) {\n          // @ts-ignore\n          setSegmentValue(now[segment.type]);\n        }\n      } else {\n        setSegmentValue(parsed);\n      }\n      enteredKeys.current = newValue;\n    } else if (segment.type === 'dayPeriod') {\n      adjustSegmentValue(-1);\n    }\n  };\n\n  const onKeyDown: KeyboardEventHandler = e => {\n    if (e.ctrlKey || e.metaKey || e.shiftKey || e.altKey) {\n      return;\n    }\n\n    // Navigation between date segments and deletion\n    switch (e.key) {\n      case 'ArrowLeft':\n        e.preventDefault();\n        e.stopPropagation();\n        focusManager.focusPrevious();\n        break;\n      case 'ArrowRight':\n        e.preventDefault();\n        e.stopPropagation();\n        focusManager.focusNext();\n        break;\n      case 'Enter':\n        (e.target as HTMLElement).closest('form')?.requestSubmit();\n        setCalendarIsOpen(!calendarIsOpen);\n        break;\n      case 'Tab':\n        break;\n      case 'Backspace':\n      case 'Delete': {\n        e.preventDefault();\n        e.stopPropagation();\n        backspace();\n        break;\n      }\n\n      // Spinbutton incrementing/decrementing\n      case 'ArrowUp':\n        e.preventDefault();\n        enteredKeys.current = '';\n        adjustSegmentValue(1);\n        break;\n      case 'ArrowDown':\n        e.preventDefault();\n        enteredKeys.current = '';\n        adjustSegmentValue(-1);\n        break;\n      case 'PageUp':\n        e.preventDefault();\n        enteredKeys.current = '';\n        adjustSegmentValue(PAGE_STEP[segment.type] || 1);\n        break;\n      case 'PageDown':\n        e.preventDefault();\n        enteredKeys.current = '';\n        adjustSegmentValue(-(PAGE_STEP[segment.type] || 1));\n        break;\n      case 'Home':\n        e.preventDefault();\n        enteredKeys.current = '';\n        setSegmentValue(segment.maxValue);\n        break;\n      case 'End':\n        e.preventDefault();\n        enteredKeys.current = '';\n        setSegmentValue(segment.minValue);\n        break;\n    }\n\n    onInput(e.key);\n  };\n\n  const amPmFormatter = useDateFormatter({hour: 'numeric', hour12: true});\n  const am = useMemo(() => {\n    const amDate = new Date();\n    amDate.setHours(0);\n    return amPmFormatter\n      .formatToParts(amDate)\n      .find(part => part.type === 'dayPeriod')!.value;\n  }, [amPmFormatter]);\n  const pm = useMemo(() => {\n    const pmDate = new Date();\n    pmDate.setHours(12);\n    return amPmFormatter\n      .formatToParts(pmDate)\n      .find(part => part.type === 'dayPeriod')!.value;\n  }, [amPmFormatter]);\n\n  // Update date values on user keyboard input\n  const onInput = (key: string) => {\n    const newValue = enteredKeys.current + key;\n\n    switch (segment.type) {\n      case 'dayPeriod':\n        if (am.toLowerCase().startsWith(key)) {\n          setSegmentValue(0);\n        } else if (pm.toLowerCase().startsWith(key)) {\n          setSegmentValue(12);\n        } else {\n          break;\n        }\n        focusManager.focusNext();\n        break;\n      case 'day':\n      case 'hour':\n      case 'minute':\n      case 'second':\n      case 'month':\n      case 'year': {\n        if (!parser.isValidPartialNumber(newValue)) {\n          return;\n        }\n\n        let numberValue = parser.parse(newValue);\n        let segmentValue = numberValue;\n        let allowsZero = segment.minValue === 0;\n        if (segment.type === 'hour' && formatter.resolvedOptions().hour12) {\n          switch (formatter.resolvedOptions().hourCycle) {\n            case 'h11':\n              if (numberValue > 11) {\n                segmentValue = parser.parse(key);\n              }\n              break;\n            case 'h12':\n              allowsZero = false;\n              if (numberValue > 12) {\n                segmentValue = parser.parse(key);\n              }\n              break;\n          }\n\n          if (segment.value >= 12 && numberValue > 1) {\n            numberValue += 12;\n          }\n        } else if (numberValue > segment.maxValue) {\n          segmentValue = parser.parse(key);\n        }\n\n        if (Number.isNaN(numberValue)) {\n          return;\n        }\n\n        const shouldSetValue = segmentValue !== 0 || allowsZero;\n        if (shouldSetValue) {\n          setSegmentValue(segmentValue);\n        }\n\n        if (\n          Number(`${numberValue}0`) > segment.maxValue ||\n          newValue.length >= String(segment.maxValue).length\n        ) {\n          enteredKeys.current = '';\n          if (shouldSetValue) {\n            focusManager.focusNext();\n          }\n        } else {\n          enteredKeys.current = newValue;\n        }\n        break;\n      }\n    }\n  };\n\n  const spinButtonProps: HTMLAttributes<HTMLDivElement> = isMobile\n    ? {}\n    : {\n        'aria-label': segment.type,\n        'aria-valuetext': isPlaceholder ? undefined : `${segment.value}`,\n        'aria-valuemin': segment.minValue,\n        'aria-valuemax': segment.maxValue,\n        'aria-valuenow': isPlaceholder ? undefined : segment.value,\n        tabIndex: 0,\n        onKeyDown,\n      };\n\n  return (\n    <div\n      {...mergeProps(domProps!, {\n        ...spinButtonProps,\n        onFocus: e => {\n          enteredKeys.current = '';\n          e.target.scrollIntoView({block: 'nearest'});\n        },\n        onClick: e => {\n          e.preventDefault();\n          e.stopPropagation();\n        },\n      } as HTMLAttributes<HTMLDivElement>)}\n      className=\"p-2 outline-none caret-transparent cursor-default rounded focus:bg-primary focus:text-on-primary select-none whitespace-nowrap box-content tabular-nums text-center\"\n    >\n      {segment.text.padStart(segment.minLength, '0')}\n    </div>\n  );\n}\n","import {useFocusManager} from '@react-aria/focus';\nimport {ComponentPropsWithoutRef} from 'react';\n\nexport interface LiteralSegment {\n  type: 'literal';\n  minLength: 1;\n  text: string;\n}\n\ninterface LiteralSegmentProps extends ComponentPropsWithoutRef<'div'> {\n  segment: LiteralSegment;\n  domProps?: ComponentPropsWithoutRef<'div'>;\n}\nexport function LiteralDateSegment({segment, domProps}: LiteralSegmentProps) {\n  const focusManager = useFocusManager();\n  return (\n    <div\n      {...domProps}\n      onPointerDown={e => {\n        if (e.pointerType === 'mouse') {\n          e.preventDefault();\n          const res = focusManager.focusNext({from: e.target as HTMLElement});\n          if (!res) {\n            focusManager.focusPrevious({from: e.target as HTMLElement});\n          }\n        }\n      }}\n      aria-hidden\n      className=\"min-w-4 cursor-default select-none\"\n    >\n      {segment.text}\n    </div>\n  );\n}\n","import {\n  DateValue,\n  getMinimumDayInMonth,\n  getMinimumMonthInYear,\n} from '@internationalized/date';\n\nexport function getSegmentLimits(\n  date: DateValue,\n  type: string,\n  options: Intl.ResolvedDateTimeFormatOptions\n) {\n  switch (type) {\n    case 'year':\n      return {\n        value: date.year,\n        placeholder: 'yyyy',\n        minValue: 1,\n        maxValue: date.calendar.getYearsInEra(date),\n      };\n    case 'month':\n      return {\n        value: date.month,\n        placeholder: 'mm',\n        minValue: getMinimumMonthInYear(date),\n        maxValue: date.calendar.getMonthsInYear(date),\n      };\n    case 'day':\n      return {\n        value: date.day,\n        minValue: getMinimumDayInMonth(date),\n        maxValue: date.calendar.getDaysInMonth(date),\n        placeholder: 'dd',\n      };\n  }\n\n  if ('hour' in date) {\n    switch (type) {\n      case 'dayPeriod':\n        return {\n          value: date.hour >= 12 ? 12 : 0,\n          minValue: 0,\n          maxValue: 12,\n          placeholder: '--',\n        };\n      case 'hour':\n        if (options.hour12) {\n          const isPM = date.hour >= 12;\n          return {\n            value: date.hour,\n            minValue: isPM ? 12 : 0,\n            maxValue: isPM ? 23 : 11,\n            placeholder: '--',\n          };\n        }\n\n        return {\n          value: date.hour,\n          minValue: 0,\n          maxValue: 23,\n          placeholder: '--',\n        };\n      case 'minute':\n        return {\n          value: date.minute,\n          minValue: 0,\n          maxValue: 59,\n          placeholder: '--',\n        };\n    }\n  }\n\n  return {};\n}\n","import React, {ComponentPropsWithoutRef, useMemo} from 'react';\nimport {ZonedDateTime} from '@internationalized/date';\nimport {EditableDateSegment, EditableSegment} from './editable-date-segment';\nimport {LiteralDateSegment, LiteralSegment} from './literal-segment';\nimport {useDateFormatter} from '@common/i18n/use-date-formatter';\nimport {DatePickerState} from '../date-picker/use-date-picker-state';\nimport {getSegmentLimits} from './utils/get-segment-limits';\nimport {DateRangePickerState} from '../date-range-picker/use-date-range-picker-state';\n\ninterface DateSegmentListProps {\n  segmentProps?: ComponentPropsWithoutRef<'div'>;\n  state: DatePickerState | DateRangePickerState;\n  value: ZonedDateTime;\n  onChange: (newValue: ZonedDateTime) => void;\n  isPlaceholder?: boolean;\n}\nexport function DateSegmentList({\n  segmentProps,\n  state,\n  value,\n  onChange,\n  isPlaceholder,\n}: DateSegmentListProps) {\n  const {granularity} = state;\n  const options = useMemo(() => {\n    const memoOptions: Intl.DateTimeFormatOptions = {\n      year: 'numeric',\n      month: 'numeric',\n      day: 'numeric',\n    };\n    if (granularity === 'minute') {\n      memoOptions.hour = 'numeric';\n      memoOptions.minute = 'numeric';\n    }\n    return memoOptions;\n  }, [granularity]);\n\n  const formatter = useDateFormatter(options);\n\n  const dateValue = useMemo(() => value.toDate(), [value]);\n  const segments = useMemo(() => {\n    return formatter.formatToParts(dateValue).map(segment => {\n      const limits = getSegmentLimits(\n        value,\n        segment.type,\n        formatter.resolvedOptions()\n      );\n      const textValue =\n        isPlaceholder && segment.type !== 'literal'\n          ? limits.placeholder\n          : segment.value;\n      return {\n        type: segment.type,\n        text: segment.value === ', ' ? ' ' : textValue,\n        ...limits,\n        minLength:\n          segment.type !== 'literal' ? String(limits.maxValue).length : 1,\n      } as LiteralSegment | EditableSegment;\n    });\n  }, [dateValue, formatter, isPlaceholder, value]);\n\n  return (\n    <div className=\"flex items-center\">\n      {segments.map((segment, index) => {\n        if (segment.type === 'literal') {\n          return (\n            <LiteralDateSegment\n              domProps={segmentProps}\n              key={index}\n              segment={segment}\n            />\n          );\n        }\n        return (\n          <EditableDateSegment\n            isPlaceholder={isPlaceholder}\n            domProps={segmentProps}\n            state={state}\n            value={value}\n            onChange={onChange}\n            segment={segment}\n            key={index}\n          />\n        );\n      })}\n    </div>\n  );\n}\n","import React from 'react';\nimport clsx from 'clsx';\nimport {\n  CalendarDate,\n  DateValue,\n  getDayOfWeek,\n  isSameMonth,\n  isToday,\n} from '@internationalized/date';\nimport {useSelectedLocale} from '../../../../../i18n/selected-locale';\nimport {DatePickerState} from '../date-picker/use-date-picker-state';\nimport {dateIsInvalid} from '../utils';\nimport {DateRangePickerState} from '../date-range-picker/use-date-range-picker-state';\n\ninterface CalendarCellProps {\n  date: CalendarDate;\n  currentMonth: DateValue;\n  state: DatePickerState | DateRangePickerState;\n}\nexport function CalendarCell({\n  date,\n  currentMonth,\n  state: {\n    dayIsActive,\n    dayIsHighlighted,\n    dayIsRangeStart,\n    dayIsRangeEnd,\n    getCellProps,\n    timezone,\n    min,\n    max,\n  },\n}: CalendarCellProps) {\n  const {localeCode} = useSelectedLocale();\n  const dayOfWeek = getDayOfWeek(date, localeCode);\n  const isActive = dayIsActive(date);\n  const isHighlighted = dayIsHighlighted(date);\n  const isRangeStart = dayIsRangeStart(date);\n  const isRangeEnd = dayIsRangeEnd(date);\n  const dayIsToday = isToday(date, timezone);\n  const sameMonth = isSameMonth(date, currentMonth);\n  const isDisabled = dateIsInvalid(date, min, max);\n\n  return (\n    <div\n      role=\"button\"\n      aria-disabled={isDisabled}\n      className={clsx(\n        'w-40 h-40 text-sm relative isolate flex-shrink-0',\n        isDisabled && 'text-disabled pointer-events-none',\n        !sameMonth && 'invisible pointer-events-none'\n      )}\n      {...getCellProps(date, sameMonth)}\n    >\n      <span\n        className={clsx(\n          'absolute inset-0 flex items-center justify-center rounded-full w-full h-full select-none z-10 cursor-pointer',\n          !isActive && !dayIsToday && 'hover:bg-hover',\n          isActive && 'bg-primary text-on-primary font-semibold',\n          dayIsToday && !isActive && 'bg-chip'\n        )}\n      >\n        {date.day}\n      </span>\n      {isHighlighted && sameMonth && (\n        <span\n          className={clsx(\n            'absolute w-full h-full inset-0 bg-primary/focus',\n            (isRangeStart || dayOfWeek === 0 || date.day === 1) &&\n              'rounded-l-full',\n            (isRangeEnd ||\n              dayOfWeek === 6 ||\n              date.day ===\n                currentMonth.calendar.getDaysInMonth(currentMonth)) &&\n              'rounded-r-full'\n          )}\n        />\n      )}\n    </div>\n  );\n}\n","import React from 'react';\nimport clsx from 'clsx';\nimport {m} from 'framer-motion';\nimport {\n  CalendarDate,\n  endOfMonth,\n  getWeeksInMonth,\n  startOfMonth,\n  startOfWeek,\n} from '@internationalized/date';\nimport {KeyboardArrowLeftIcon} from '../../../../../icons/material/KeyboardArrowLeft';\nimport {IconButton} from '../../../../buttons/icon-button';\nimport {KeyboardArrowRightIcon} from '../../../../../icons/material/KeyboardArrowRight';\nimport {CalendarCell} from './calendar-cell';\nimport {DatePickerState} from '../date-picker/use-date-picker-state';\nimport {useDateFormatter} from '../../../../../i18n/use-date-formatter';\nimport {useSelectedLocale} from '../../../../../i18n/selected-locale';\nimport {dateIsInvalid} from '../utils';\nimport {DateRangePickerState} from '../date-range-picker/use-date-range-picker-state';\n\nexport interface CalendarMonthProps {\n  state: DatePickerState | DateRangePickerState;\n  startDate: CalendarDate;\n  isFirst: boolean;\n  isLast: boolean;\n}\nexport function CalendarMonth({\n  startDate,\n  state,\n  isFirst,\n  isLast,\n}: CalendarMonthProps) {\n  const {localeCode} = useSelectedLocale();\n  const weeksInMonth = getWeeksInMonth(startDate, localeCode);\n  const monthStart = startOfWeek(startDate, localeCode);\n\n  return (\n    <div className=\"w-280 flex-shrink-0\">\n      <CalendarMonthHeader\n        isFirst={isFirst}\n        isLast={isLast}\n        state={state}\n        currentMonth={startDate}\n      />\n      <div className=\"block\" role=\"grid\">\n        <WeekdayHeader state={state} startDate={startDate} />\n        {[...new Array(weeksInMonth).keys()].map(weekIndex => (\n          <m.div className=\"flex mb-6\" key={weekIndex}>\n            {[...new Array(7).keys()].map(dayIndex => (\n              <CalendarCell\n                key={dayIndex}\n                date={monthStart.add({weeks: weekIndex, days: dayIndex})}\n                currentMonth={startDate}\n                state={state}\n              />\n            ))}\n          </m.div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\ninterface CalendarMonthHeaderProps {\n  state: DatePickerState | DateRangePickerState;\n  currentMonth: CalendarDate;\n  isFirst: boolean;\n  isLast: boolean;\n}\nfunction CalendarMonthHeader({\n  currentMonth,\n  isFirst,\n  isLast,\n  state: {calendarDates, setCalendarDates, timezone, min, max},\n}: CalendarMonthHeaderProps) {\n  const shiftCalendars = (direction: 'forward' | 'backward') => {\n    const count = calendarDates.length;\n    let newDates: CalendarDate[];\n    if (direction === 'forward') {\n      newDates = calendarDates.map(date =>\n        endOfMonth(date.add({months: count}))\n      );\n    } else {\n      newDates = calendarDates.map(date =>\n        endOfMonth(date.subtract({months: count}))\n      );\n    }\n    setCalendarDates(newDates);\n  };\n\n  const monthFormatter = useDateFormatter({\n    month: 'long',\n    year: 'numeric',\n    era: currentMonth.calendar.identifier !== 'gregory' ? 'long' : undefined,\n    calendar: currentMonth.calendar.identifier,\n  });\n\n  const isBackwardDisabled = dateIsInvalid(\n    currentMonth.subtract({days: 1}),\n    min,\n    max\n  );\n  const isForwardDisabled = dateIsInvalid(\n    startOfMonth(currentMonth.add({months: 1})),\n    min,\n    max\n  );\n\n  return (\n    <div className=\"flex items-center justify-between gap-10\">\n      <IconButton\n        size=\"md\"\n        className={clsx('text-muted', !isFirst && 'invisible')}\n        disabled={!isFirst || isBackwardDisabled}\n        aria-hidden={!isFirst}\n        onClick={() => {\n          shiftCalendars('backward');\n        }}\n      >\n        <KeyboardArrowLeftIcon />\n      </IconButton>\n      <div className=\"text-sm font-semibold select-none\">\n        {monthFormatter.format(currentMonth.toDate(timezone))}\n      </div>\n      <IconButton\n        size=\"md\"\n        className={clsx('text-muted', !isLast && 'invisible')}\n        disabled={!isLast || isForwardDisabled}\n        aria-hidden={!isLast}\n        onClick={() => {\n          shiftCalendars('forward');\n        }}\n      >\n        <KeyboardArrowRightIcon />\n      </IconButton>\n    </div>\n  );\n}\n\ninterface WeekdayHeaderProps {\n  state: DatePickerState | DateRangePickerState;\n  startDate: CalendarDate;\n}\nfunction WeekdayHeader({state: {timezone}, startDate}: WeekdayHeaderProps) {\n  const {localeCode} = useSelectedLocale();\n  const dayFormatter = useDateFormatter({weekday: 'short'});\n\n  const monthStart = startOfWeek(startDate, localeCode);\n\n  return (\n    <div className=\"flex\">\n      {[...new Array(7).keys()].map(index => {\n        const date = monthStart.add({days: index});\n        const dateDay = date.toDate(timezone);\n        const weekday = dayFormatter.format(dateDay);\n        return (\n          <div\n            className=\"w-40 h-40 text-sm font-semibold relative flex-shrink-0\"\n            key={index}\n          >\n            <div className=\"absolute flex items-center justify-center w-full h-full select-none\">\n              {weekday}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n","import React from 'react';\nimport {startOfMonth, toCalendarDate} from '@internationalized/date';\nimport {useIsMobileMediaQuery} from '../../../../../utils/hooks/is-mobile-media-query';\nimport {CalendarMonth} from './calendar-month';\nimport {DatePickerState} from '../date-picker/use-date-picker-state';\nimport {DateRangePickerState} from '../date-range-picker/use-date-range-picker-state';\n\ninterface CalendarProps {\n  state: DatePickerState | DateRangePickerState;\n  visibleMonths?: 1 | 2;\n}\nexport function Calendar({state, visibleMonths = 1}: CalendarProps) {\n  const isMobile = useIsMobileMediaQuery();\n\n  if (isMobile) {\n    visibleMonths = 1;\n  }\n\n  return (\n    <>\n      {[...new Array(visibleMonths).keys()].map(index => {\n        const startDate = toCalendarDate(\n          startOfMonth(state.calendarDates[index])\n        );\n        const isFirst = index === 0;\n        const isLast = index === visibleMonths - 1;\n        return (\n          <CalendarMonth\n            key={index}\n            state={state}\n            startDate={startDate}\n            isFirst={isFirst}\n            isLast={isLast}\n          />\n        );\n      })}\n    </>\n  );\n}\n","import {DateValue, parseAbsolute} from '@internationalized/date';\nimport {Fragment, memo} from 'react';\nimport {useDateFormatter} from './use-date-formatter';\nimport {useSettings} from '../core/settings/use-settings';\nimport {shallowEqual} from '../utils/shallow-equal';\nimport {useUserTimezone} from './use-user-timezone';\nimport {DateFormatPresets} from '@common/i18n/formatted-date';\n\ninterface FormattedDateTimeRangeProps {\n  start?: string | DateValue | Date;\n  end?: string | DateValue | Date;\n  options?: Intl.DateTimeFormatOptions;\n  preset?: keyof typeof DateFormatPresets;\n}\nexport const FormattedDateTimeRange = memo(\n  ({start, end, options, preset}: FormattedDateTimeRangeProps) => {\n    const {dates} = useSettings();\n    const timezone = useUserTimezone();\n    const formatter = useDateFormatter(\n      options ||\n        (DateFormatPresets as Record<string, Intl.DateTimeFormatOptions>)[\n          preset || dates?.format\n        ]\n    );\n\n    if (!start || !end) {\n      return null;\n    }\n\n    let value: string;\n\n    try {\n      value = formatter.formatRange(\n        castToDate(start, timezone),\n        castToDate(end, timezone)\n      );\n    } catch (e) {\n      value = '';\n    }\n\n    return <Fragment>{value}</Fragment>;\n  },\n  shallowEqual\n);\n\nfunction castToDate(date: string | DateValue | Date, timezone: string): Date {\n  if (typeof date === 'string') {\n    return parseAbsolute(date, timezone).toDate();\n  }\n  if ('toDate' in date) {\n    return date.toDate(timezone);\n  }\n  return date;\n}\n","import {List, ListItem} from '../../../../../list/list';\nimport {DateRangePresets} from './date-range-presets';\nimport {Trans} from '../../../../../../i18n/trans';\nimport {DateRangeValue} from '../date-range-value';\n\ninterface DatePresetList {\n  onPresetSelected: (value: DateRangeValue) => void;\n  selectedValue?: DateRangeValue | null;\n}\nexport function DatePresetList({\n  onPresetSelected,\n  selectedValue,\n}: DatePresetList) {\n  return (\n    <List\n      className=\"min-w-192\"\n      padding=\"py-14\"\n      dataTestId=\"date-range-preset-list\"\n    >\n      {DateRangePresets.map(preset => (\n        <ListItem\n          borderRadius=\"rounded-none\"\n          capitalizeFirst\n          key={preset.key}\n          isSelected={selectedValue?.preset === preset.key}\n          onSelected={() => {\n            const newValue = preset.getRangeValue();\n            onPresetSelected(newValue);\n          }}\n        >\n          <Trans {...preset.label} />\n        </ListItem>\n      ))}\n    </List>\n  );\n}\n","import React, {useRef} from 'react';\nimport {AnimatePresence, m} from 'framer-motion';\nimport {DatePickerField} from '../date-picker-field';\nimport {DateRangePickerState} from '../use-date-range-picker-state';\nimport {Calendar} from '../../calendar/calendar';\nimport {DialogFooter} from '../../../../../overlays/dialog/dialog-footer';\nimport {Button} from '../../../../../buttons/button';\nimport {useDialogContext} from '../../../../../overlays/dialog/dialog-context';\nimport {Dialog} from '../../../../../overlays/dialog/dialog';\nimport {DialogBody} from '../../../../../overlays/dialog/dialog-body';\nimport {ArrowRightAltIcon} from '../../../../../../icons/material/ArrowRightAlt';\nimport {DateSegmentList} from '../../segments/date-segment-list';\nimport {Trans} from '../../../../../../i18n/trans';\nimport {FormattedDateTimeRange} from '../../../../../../i18n/formatted-date-time-range';\nimport {DatePresetList} from './date-preset-list';\nimport {useIsTabletMediaQuery} from '@common/utils/hooks/is-tablet-media-query';\n\ninterface DateRangeDialogProps {\n  state: DateRangePickerState;\n  showInlineDatePickerField?: boolean;\n}\nexport function DateRangeDialog({\n  state,\n  showInlineDatePickerField = false,\n}: DateRangeDialogProps) {\n  const isTablet = useIsTabletMediaQuery();\n  const {close} = useDialogContext();\n  const initialStateRef = useRef<DateRangePickerState>(state);\n\n  const hasPlaceholder = state.isPlaceholder.start || state.isPlaceholder.end;\n\n  const footer = (\n    <DialogFooter\n      dividerTop\n      startAction={\n        !hasPlaceholder && !isTablet ? (\n          <div className=\"text-xs\">\n            <FormattedDateTimeRange\n              start={state.selectedValue.start.toDate()}\n              end={state.selectedValue.end.toDate()}\n              options={{dateStyle: 'medium'}}\n            />\n          </div>\n        ) : undefined\n      }\n    >\n      <Button\n        variant=\"text\"\n        size=\"xs\"\n        onClick={() => {\n          state.setSelectedValue(initialStateRef.current.selectedValue);\n          state.setIsPlaceholder(initialStateRef.current.isPlaceholder);\n          close();\n        }}\n      >\n        <Trans message=\"Cancel\" />\n      </Button>\n      <Button\n        variant=\"flat\"\n        color=\"primary\"\n        size=\"xs\"\n        onClick={() => {\n          close(state.selectedValue);\n        }}\n      >\n        <Trans message=\"Select\" />\n      </Button>\n    </DialogFooter>\n  );\n\n  return (\n    <Dialog size=\"auto\">\n      <DialogBody className=\"flex\" padding=\"p-0\">\n        {!isTablet && (\n          <DatePresetList\n            selectedValue={state.selectedValue}\n            onPresetSelected={preset => {\n              state.setSelectedValue(preset);\n              if (state.closeDialogOnSelection) {\n                close(preset);\n              }\n            }}\n          />\n        )}\n        <AnimatePresence initial={false}>\n          <Calendars\n            state={state}\n            showInlineDatePickerField={showInlineDatePickerField}\n          />\n        </AnimatePresence>\n      </DialogBody>\n      {!state.closeDialogOnSelection && footer}\n    </Dialog>\n  );\n}\n\ninterface CustomRangePanelProps {\n  state: DateRangePickerState;\n  showInlineDatePickerField?: boolean;\n}\nfunction Calendars({state, showInlineDatePickerField}: CustomRangePanelProps) {\n  return (\n    <m.div\n      initial={{width: 0, overflow: 'hidden'}}\n      animate={{width: 'auto'}}\n      exit={{width: 0, overflow: 'hidden'}}\n      transition={{type: 'tween', duration: 0.125}}\n      className=\"border-l px-20 pt-10 pb-20\"\n    >\n      {showInlineDatePickerField && <InlineDatePickerField state={state} />}\n      <div className=\"flex items-start gap-36\">\n        <Calendar state={state} visibleMonths={2} />\n      </div>\n    </m.div>\n  );\n}\n\ninterface InlineDatePickerFieldProps {\n  state: DateRangePickerState;\n}\nfunction InlineDatePickerField({state}: InlineDatePickerFieldProps) {\n  const {selectedValue, setSelectedValue} = state;\n  return (\n    <DatePickerField className=\"mb-20 mt-10\">\n      <DateSegmentList\n        state={state}\n        value={selectedValue.start}\n        onChange={newValue => {\n          setSelectedValue({...selectedValue, start: newValue});\n        }}\n      />\n      <ArrowRightAltIcon className=\"block flex-shrink-0 text-muted\" size=\"md\" />\n      <DateSegmentList\n        state={state}\n        value={selectedValue.end}\n        onChange={newValue => {\n          setSelectedValue({...selectedValue, end: newValue});\n        }}\n      />\n    </DatePickerField>\n  );\n}\n","import {useQuery, UseQueryOptions} from '@tanstack/react-query';\nimport {PaginatedBackendResponse} from '../../http/backend-response/pagination-response';\nimport {apiClient} from '../../http/query-client';\n\nexport interface GetDatatableDataParams {\n  orderBy?: string;\n  orderDir?: 'asc' | 'desc';\n  filters?: string | null;\n  query?: string;\n  with?: string;\n  perPage?: number;\n  page?: number;\n  [key: string]: string | number | boolean | undefined | null;\n}\n\nexport const DatatableDataQueryKey = (\n  endpoint: string,\n  params?: GetDatatableDataParams | Record<string, string | number | boolean>\n) => {\n  // split endpoint by slash, so we can clear cache from the root later,\n  // for example, 'link-group' will clear 'link-group/1/links' endpoint\n  const key: (string | GetDatatableDataParams)[] = endpoint.split('/');\n  if (params) {\n    key.push(params);\n  }\n  return key;\n};\n\nexport function useDatatableData<T = object>(\n  endpoint: string,\n  params: GetDatatableDataParams,\n  options?: Omit<\n    UseQueryOptions<\n      PaginatedBackendResponse<T>,\n      unknown,\n      PaginatedBackendResponse<T>,\n      any[]\n    >,\n    'queryKey' | 'queryFn'\n  >\n) {\n  return useQuery(\n    DatatableDataQueryKey(endpoint, params),\n    () => paginate<T>(endpoint, params),\n    {\n      ...options,\n      keepPreviousData: true,\n    }\n  );\n}\n\nfunction paginate<T>(\n  endpoint: string,\n  params: GetDatatableDataParams\n): Promise<PaginatedBackendResponse<T>> {\n  return apiClient.get(endpoint, {params}).then(response => response.data);\n}\n","import {useQuery, UseQueryOptions} from '@tanstack/react-query';\nimport {NormalizedModel} from '../../datatable/filters/normalized-model';\nimport {apiClient} from '../../http/query-client';\nimport {BackendResponse} from '../../http/backend-response/backend-response';\n\nconst defaultEndpoint = (model: string, prefix: string = 'normalized-models') =>\n  `${prefix}/${model}`;\n\ninterface Response extends BackendResponse {\n  results: NormalizedModel[];\n}\n\ninterface Params {\n  query?: string;\n  perPage?: number;\n}\n\nexport function useNormalizedModels(\n  model: string,\n  queryParams: Params,\n  queryOptions?: Omit<\n    UseQueryOptions<Response, unknown, Response, [string, Params]>,\n    'queryKey' | 'queryFn'\n  > | null,\n  userEndpoint?: string\n) {\n  const endpoint = defaultEndpoint(model, userEndpoint);\n  return useQuery(\n    [endpoint, queryParams],\n    () => fetchUsers(endpoint, queryParams),\n    {\n      keepPreviousData: true,\n      ...queryOptions,\n    }\n  );\n}\n\nasync function fetchUsers(endpoint: string, params: Params) {\n  return apiClient.get<Response>(endpoint, {params}).then(r => r.data);\n}\n","import {useQuery} from '@tanstack/react-query';\nimport {NormalizedModel} from '../../datatable/filters/normalized-model';\nimport {apiClient} from '../../http/query-client';\nimport {BackendResponse} from '../../http/backend-response/backend-response';\n\nconst buildEndpoint = (\n  modelName: string,\n  modelId: string | number,\n  prefix = 'normalized-models'\n) => `${prefix}/${modelName}/${modelId}`;\n\ninterface Response extends BackendResponse {\n  model: NormalizedModel;\n}\n\nexport function useNormalizedModel(\n  model: string,\n  modelId: string | number | null,\n  queryParams?: Record<string, string>,\n  userEndpoint?: string\n) {\n  const endpoint = buildEndpoint(model, modelId!, userEndpoint);\n  return useQuery(\n    [endpoint, queryParams],\n    () => fetchModel(endpoint, queryParams),\n    {\n      enabled: model != null && modelId != null,\n    }\n  );\n}\n\nasync function fetchModel(\n  endpoint: string,\n  params?: Record<string, string>\n): Promise<Response> {\n  return apiClient.get(endpoint, {params}).then(r => r.data);\n}\n","import React, {ReactNode, useRef, useState} from 'react';\nimport {useTrans} from '../../i18n/use-trans';\nimport {Trans} from '../../i18n/trans';\nimport {Avatar} from '../images/avatar';\nimport {Tooltip} from '../tooltip/tooltip';\nimport {IconButton} from '../buttons/icon-button';\nimport {EditIcon} from '../../icons/material/Edit';\nimport {message} from '../../i18n/message';\nimport {Item} from './listbox/item';\nimport {ComboBox} from './combobox/combobox';\nimport {useController} from 'react-hook-form';\nimport {useControlledState} from '@react-stately/utils';\nimport {getInputFieldClassNames} from './input-field/get-input-field-class-names';\nimport clsx from 'clsx';\nimport {Skeleton} from '../skeleton/skeleton';\nimport {useNormalizedModels} from '../../users/queries/use-normalized-models';\nimport {useNormalizedModel} from '../../users/queries/use-normalized-model';\nimport {AnimatePresence, m} from 'framer-motion';\nimport {opacityAnimation} from '../animation/opacity-animation';\n\ninterface NormalizedModelFieldProps {\n  modelType: string;\n  label?: ReactNode;\n  className?: string;\n  value?: string | number;\n  defaultValue?: string | number;\n  onChange?: (value: string | number) => void;\n  invalid?: boolean;\n  errorMessage?: string;\n  description?: ReactNode;\n  openMenuOnFocus?: boolean;\n  autoFocus?: boolean;\n  queryParams?: Record<string, string>;\n  customEndpoint?: string;\n  disabled?: boolean;\n}\nexport function NormalizedModelField({\n  modelType,\n  label,\n  className,\n  value,\n  defaultValue = '',\n  onChange,\n  description,\n  errorMessage,\n  invalid,\n  openMenuOnFocus,\n  autoFocus,\n  queryParams,\n  customEndpoint,\n  disabled,\n}: NormalizedModelFieldProps) {\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [inputValue, setInputValue] = useState('');\n  const [selectedValue, setSelectedValue] = useControlledState(\n    value,\n    defaultValue,\n    onChange\n  );\n  const query = useNormalizedModels(\n    modelType,\n    {\n      query: inputValue,\n      ...queryParams,\n    },\n    null,\n    customEndpoint\n  );\n  const {trans} = useTrans();\n\n  const fieldClassNames = getInputFieldClassNames({size: 'md'});\n\n  if (selectedValue) {\n    return (\n      <div className={className}>\n        <div className={fieldClassNames.label}>{label}</div>\n        <div\n          className={clsx('p-10 border rounded', invalid && 'border-danger')}\n        >\n          <AnimatePresence initial={false} mode=\"wait\">\n            <SelectedModelPreview\n              disabled={disabled}\n              endpoint={customEndpoint}\n              modelType={modelType}\n              modelId={selectedValue}\n              queryParams={queryParams}\n              onEditClick={() => {\n                setSelectedValue('');\n                setInputValue('');\n                requestAnimationFrame(() => {\n                  inputRef.current?.focus();\n                });\n              }}\n            />\n          </AnimatePresence>\n        </div>\n        {description && !errorMessage && (\n          <div className={fieldClassNames.description}>{description}</div>\n        )}\n        {errorMessage && (\n          <div className={fieldClassNames.error}>{errorMessage}</div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <ComboBox\n      className={className}\n      invalid={invalid}\n      errorMessage={errorMessage}\n      description={description}\n      isAsync\n      placeholder={trans(message('Find item..'))}\n      label={label}\n      isLoading={query.isFetching}\n      items={query.data?.results}\n      inputValue={inputValue}\n      onInputValueChange={setInputValue}\n      clearInputOnItemSelection\n      selectionMode=\"single\"\n      selectedValue={selectedValue}\n      onSelectionChange={setSelectedValue}\n      ref={inputRef}\n      openMenuOnFocus={openMenuOnFocus}\n      autoFocus={autoFocus}\n      disabled={disabled}\n    >\n      {model => (\n        <Item\n          value={model.id}\n          key={model.id}\n          description={model.description}\n          startIcon={<Avatar src={model.image} />}\n        >\n          {model.name}\n        </Item>\n      )}\n    </ComboBox>\n  );\n}\n\ninterface SelectedModelPreviewProps {\n  modelType: string;\n  modelId: string | number;\n  selectedValue?: number | string;\n  onEditClick?: () => void;\n  endpoint?: string;\n  disabled?: boolean;\n  queryParams?: NormalizedModelFieldProps['queryParams'];\n}\nfunction SelectedModelPreview({\n  modelType,\n  modelId,\n  onEditClick,\n  endpoint,\n  disabled,\n  queryParams,\n}: SelectedModelPreviewProps) {\n  const {data, isLoading} = useNormalizedModel(\n    modelType,\n    modelId,\n    queryParams,\n    endpoint\n  );\n\n  if (isLoading || !data?.model) {\n    return <LoadingSkeleton key=\"skeleton\" />;\n  }\n\n  return (\n    <m.div\n      className={clsx(\n        'flex items-center gap-10',\n        disabled && 'text-disabled cursor-not-allowed pointer-events-none'\n      )}\n      key=\"preview\"\n      {...opacityAnimation}\n    >\n      {data.model.image && <Avatar src={data.model.image} />}\n      <div>\n        <div>{data.model.name}</div>\n        <div className=\"text-muted text-xs\">{data.model.description}</div>\n      </div>\n      <Tooltip label={<Trans message=\"Change item\" />}>\n        <IconButton\n          className=\"ml-auto text-muted\"\n          size=\"sm\"\n          onClick={onEditClick}\n          disabled={disabled}\n        >\n          <EditIcon />\n        </IconButton>\n      </Tooltip>\n    </m.div>\n  );\n}\n\nfunction LoadingSkeleton() {\n  return (\n    <m.div className=\"flex items-center gap-10\" {...opacityAnimation}>\n      <Skeleton variant=\"rect\" size=\"w-32 h-32\" />\n      <div className=\"flex-auto max-h-[36px]\">\n        <Skeleton className=\"text-xs\" />\n        <Skeleton className=\"text-xs max-h-8\" />\n      </div>\n      <Skeleton variant=\"icon\" size=\"w-24 h-24\" />\n    </m.div>\n  );\n}\n\ninterface FormNormalizedModelFieldProps extends NormalizedModelFieldProps {\n  name: string;\n}\nexport function FormNormalizedModelField({\n  name,\n  ...fieldProps\n}: FormNormalizedModelFieldProps) {\n  const {\n    field: {onChange, value = ''},\n    fieldState: {invalid, error},\n  } = useController({\n    name,\n  });\n\n  return (\n    <NormalizedModelField\n      value={value}\n      onChange={onChange}\n      invalid={invalid}\n      errorMessage={error?.message}\n      {...fieldProps}\n    />\n  );\n}\n","import {useControlledState} from '@react-stately/utils';\nimport {HTMLAttributes, useCallback, useState} from 'react';\nimport {\n  CalendarDate,\n  DateValue,\n  isSameDay,\n  toCalendarDate,\n  toZoned,\n  ZonedDateTime,\n} from '@internationalized/date';\nimport {useBaseDatePickerState} from '../use-base-date-picker-state';\nimport {useCurrentDateTime} from '@common/i18n/use-current-date-time';\n\nexport type Granularity = 'day' | 'minute';\n\nexport type DatePickerState = BaseDatePickerState;\n\nexport interface BaseDatePickerState<T = ZonedDateTime, P = boolean> {\n  timezone: string;\n  granularity: Granularity;\n  selectedValue: T;\n  setSelectedValue: (value: T) => void;\n  calendarIsOpen: boolean;\n  setCalendarIsOpen: (isOpen: boolean) => void;\n  calendarDates: CalendarDate[];\n  setCalendarDates: (dates: CalendarDate[]) => void;\n  dayIsActive: (day: CalendarDate) => boolean;\n  dayIsHighlighted: (day: CalendarDate) => boolean;\n  dayIsRangeStart: (day: CalendarDate) => boolean;\n  dayIsRangeEnd: (day: CalendarDate) => boolean;\n  isPlaceholder: P;\n  setIsPlaceholder: (value: P) => void;\n  clear: () => void;\n  min?: ZonedDateTime;\n  max?: ZonedDateTime;\n  closeDialogOnSelection: boolean;\n  getCellProps: (\n    date: CalendarDate,\n    isSameMonth: boolean\n  ) => HTMLAttributes<HTMLElement>;\n}\n\nexport interface DatePickerValueProps<V, CV = V> {\n  value?: V | null | '';\n  defaultValue?: V | null;\n  onChange?: (value: CV | null) => void;\n  min?: DateValue;\n  max?: DateValue;\n  granularity?: Granularity;\n  closeDialogOnSelection?: boolean;\n}\nexport function useDatePickerState(\n  props: DatePickerValueProps<ZonedDateTime>\n): BaseDatePickerState {\n  const now = useCurrentDateTime();\n  const [isPlaceholder, setIsPlaceholder] = useState(\n    !props.value && !props.defaultValue\n  );\n\n  // if user clears the date, we will want to still keep an\n  // instance internally, but return null via \"onChange\" callback\n  const setStateValue = props.onChange;\n  const [internalValue, setInternalValue] = useControlledState(\n    props.value || now,\n    props.defaultValue || now,\n    setStateValue\n  );\n\n  const {\n    min,\n    max,\n    granularity,\n    timezone,\n    calendarIsOpen,\n    setCalendarIsOpen,\n    closeDialogOnSelection,\n  } = useBaseDatePickerState(internalValue, props);\n\n  const clear = useCallback(() => {\n    setIsPlaceholder(true);\n    setInternalValue(now);\n    setStateValue?.(null);\n    setCalendarIsOpen(false);\n  }, [now, setInternalValue, setStateValue, setCalendarIsOpen]);\n\n  const [calendarDates, setCalendarDates] = useState<CalendarDate[]>(() => {\n    return [toCalendarDate(internalValue)];\n  });\n\n  const setSelectedValue = useCallback(\n    (newValue: DateValue) => {\n      if (min && newValue.compare(min) < 0) {\n        newValue = min;\n      } else if (max && newValue.compare(max) > 0) {\n        newValue = max;\n      }\n\n      // preserve time\n      const value = internalValue\n        ? internalValue.set(newValue)\n        : toZoned(newValue, timezone);\n      setInternalValue(value);\n      setCalendarDates([toCalendarDate(value)]);\n      setIsPlaceholder(false);\n    },\n    [setInternalValue, min, max, internalValue, timezone]\n  );\n\n  const dayIsActive = useCallback(\n    (day: DateValue) => !isPlaceholder && isSameDay(internalValue, day),\n    [internalValue, isPlaceholder]\n  );\n\n  const getCellProps = useCallback(\n    (date: DateValue): HTMLAttributes<HTMLElement> => {\n      return {\n        onClick: () => {\n          setSelectedValue?.(date);\n          if (closeDialogOnSelection) {\n            setCalendarIsOpen?.(false);\n          }\n        },\n      };\n    },\n    [setSelectedValue, setCalendarIsOpen, closeDialogOnSelection]\n  );\n\n  return {\n    selectedValue: internalValue,\n    setSelectedValue: setInternalValue,\n    calendarIsOpen,\n    setCalendarIsOpen,\n    dayIsActive,\n    dayIsHighlighted: () => false,\n    dayIsRangeStart: () => false,\n    dayIsRangeEnd: () => false,\n    getCellProps,\n    calendarDates,\n    setCalendarDates,\n    isPlaceholder,\n    clear,\n    setIsPlaceholder,\n    min,\n    max,\n    granularity,\n    timezone,\n    closeDialogOnSelection,\n  };\n}\n","import React, {\n  ComponentPropsWithoutRef,\n  Fragment,\n  MouseEvent,\n  useRef,\n} from 'react';\nimport {parseAbsoluteToLocal, ZonedDateTime} from '@internationalized/date';\nimport {useController} from 'react-hook-form';\nimport {mergeProps} from '@react-aria/utils';\nimport {\n  DatePickerValueProps,\n  useDatePickerState,\n} from './use-date-picker-state';\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\nimport {DateRangeIcon} from '@common/icons/material/DateRange';\nimport {Dialog} from '@common/ui/overlays/dialog/dialog';\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\nimport {Calendar} from '../calendar/calendar';\nimport {\n  DatePickerField,\n  DatePickerFieldProps,\n} from '../date-range-picker/date-picker-field';\nimport {DateSegmentList} from '../segments/date-segment-list';\nimport {useDateFormatter} from '@common/i18n/use-date-formatter';\nimport {useTrans} from '@common/i18n/use-trans';\nimport clsx from 'clsx';\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\nimport {Button} from '@common/ui/buttons/button';\nimport {Trans} from '@common/i18n/trans';\nimport {useCurrentDateTime} from '@common/i18n/use-current-date-time';\n\nexport interface DatePickerProps\n  extends Omit<DatePickerFieldProps, 'children'>,\n    DatePickerValueProps<ZonedDateTime> {}\nexport function DatePicker({showCalendarFooter, ...props}: DatePickerProps) {\n  const state = useDatePickerState(props);\n  const inputRef = useRef<HTMLDivElement>(null);\n  const now = useCurrentDateTime();\n\n  const footer = showCalendarFooter && (\n    <DialogFooter\n      padding=\"px-14 pb-14\"\n      startAction={\n        <Button\n          disabled={state.isPlaceholder}\n          variant=\"text\"\n          color=\"primary\"\n          onClick={() => {\n            state.clear();\n          }}\n        >\n          <Trans message=\"Clear\" />\n        </Button>\n      }\n    >\n      <Button\n        variant=\"text\"\n        color=\"primary\"\n        onClick={() => {\n          state.setSelectedValue(now);\n          state.setCalendarIsOpen(false);\n        }}\n      >\n        <Trans message=\"Today\" />\n      </Button>\n    </DialogFooter>\n  );\n\n  const dialog = (\n    <DialogTrigger\n      offset={8}\n      placement=\"bottom-start\"\n      isOpen={state.calendarIsOpen}\n      onOpenChange={state.setCalendarIsOpen}\n      type=\"popover\"\n      triggerRef={inputRef}\n      returnFocusToTrigger={false}\n      moveFocusToDialog={false}\n    >\n      <Dialog size=\"auto\">\n        <DialogBody\n          className=\"flex items-start gap-40\"\n          padding={showCalendarFooter ? 'px-24 pt-20 pb-10' : null}\n        >\n          <Calendar state={state} visibleMonths={1} />\n        </DialogBody>\n        {footer}\n      </Dialog>\n    </DialogTrigger>\n  );\n\n  const openOnClick: ComponentPropsWithoutRef<'div'> = {\n    onClick: e => {\n      e.stopPropagation();\n      e.preventDefault();\n      if (!isHourSegment(e)) {\n        state.setCalendarIsOpen(true);\n      } else {\n        state.setCalendarIsOpen(false);\n      }\n    },\n  };\n\n  return (\n    <Fragment>\n      <DatePickerField\n        ref={inputRef}\n        wrapperProps={openOnClick}\n        endAdornment={\n          <DateRangeIcon className={clsx(props.disabled && 'text-disabled')} />\n        }\n        {...props}\n      >\n        <DateSegmentList\n          segmentProps={openOnClick}\n          state={state}\n          value={state.selectedValue}\n          onChange={state.setSelectedValue}\n          isPlaceholder={state.isPlaceholder}\n        />\n      </DatePickerField>\n      {dialog}\n    </Fragment>\n  );\n}\n\ninterface FormDatePickerProps extends DatePickerProps {\n  name: string;\n}\nexport function FormDatePicker(props: FormDatePickerProps) {\n  const {min, max} = props;\n  const {trans} = useTrans();\n  const {format} = useDateFormatter();\n  const {\n    field: {onChange, onBlur, value = null, ref},\n    fieldState: {invalid, error},\n  } = useController({\n    name: props.name,\n    rules: {\n      validate: v => {\n        if (!v) return;\n        const date = parseAbsoluteToLocal(v);\n        if (min && date.compare(min) < 0) {\n          return trans({\n            message: 'Enter a date after :date',\n            values: {date: format(v)},\n          });\n        }\n        if (max && date.compare(max) > 0) {\n          return trans({\n            message: 'Enter a date before :date',\n            values: {date: format(v)},\n          });\n        }\n      },\n    },\n  });\n\n  const parsedValue: null | ZonedDateTime = value\n    ? parseAbsoluteToLocal(value)\n    : null;\n\n  const formProps: Partial<DatePickerProps> = {\n    onChange: e => {\n      onChange(e ? e.toAbsoluteString() : e);\n    },\n    onBlur,\n    value: parsedValue,\n    invalid,\n    errorMessage: error?.message,\n    inputRef: ref,\n  };\n\n  return <DatePicker {...mergeProps(formProps, props)} />;\n}\n\nfunction isHourSegment(e: MouseEvent<HTMLDivElement>): boolean {\n  return ['hour', 'minute', 'dayPeriod'].includes(\n    (e.currentTarget as HTMLElement).ariaLabel || ''\n  );\n}\n","import {ChipValue} from './chip-field';\n\nexport function stringToChipValue(value: string | number): ChipValue {\n  // add both name and description so \"validateWith\" works properly in chip field, if it depends on description\n  return {id: value, name: `${value}`, description: `${value}`};\n}\n","import React, {\n  HTMLAttributes,\n  Key,\n  ReactElement,\n  ReactNode,\n  Ref,\n  RefObject,\n  useCallback,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport {useFocusManager} from '@react-aria/focus';\nimport clsx from 'clsx';\nimport {mergeProps, useLayoutEffect, useObjectRef} from '@react-aria/utils';\nimport {useControlledState} from '@react-stately/utils';\nimport {ChipList} from './chip-list';\nimport {Field} from '../field';\nimport {Input} from '../input';\nimport {Chip, ChipProps} from './chip';\nimport {NormalizedModel} from '@common/datatable/filters/normalized-model';\nimport {getInputFieldClassNames} from '../get-input-field-class-names';\nimport {ProgressCircle} from '../../../progress/progress-circle';\nimport {useField} from '../use-field';\nimport {Avatar} from '../../../images/avatar';\nimport {Listbox} from '../../listbox/listbox';\nimport {useListbox} from '../../listbox/use-listbox';\nimport {BaseFieldPropsWithDom} from '../base-field-props';\nimport {useListboxKeyboardNavigation} from '../../listbox/use-listbox-keyboard-navigation';\nimport {createEventHandler} from '@common/utils/dom/create-event-handler';\nimport {ListBoxChildren, ListboxProps} from '../../listbox/types';\nimport {stringToChipValue} from './string-to-chip-value';\nimport {Popover} from '../../../overlays/popover';\nimport {KeyboardArrowDownIcon} from '@common/icons/material/KeyboardArrowDown';\n\nexport interface ChipValue extends Omit<NormalizedModel, 'model_type'> {\n  invalid?: boolean;\n  errorMessage?: string;\n}\n\nexport type ChipFieldProps<T> = Omit<\n  ListboxProps,\n  'selectionMode' | 'displayWith'\n> &\n  Omit<\n    BaseFieldPropsWithDom<HTMLInputElement>,\n    'value' | 'onChange' | 'defaultValue'\n  > & {\n    value?: (ChipValue | string)[];\n    defaultValue?: (ChipValue | string)[];\n    displayWith?: (value: ChipValue) => ReactNode;\n    validateWith?: (value: ChipValue) => ChipValue;\n    allowCustomValue?: boolean;\n    showDropdownArrow?: boolean;\n    onChange?: (value: ChipValue[]) => void;\n    suggestions?: T[];\n    children?: ListBoxChildren<T>['children'];\n    placeholder?: string;\n    chipSize?: ChipProps['size'];\n    openMenuOnFocus?: boolean;\n    valueKey?: 'id' | 'name';\n    onChipClick?: (value: ChipValue) => void;\n  };\n\nfunction ChipFieldInner<T>(\n  props: ChipFieldProps<T>,\n  ref: Ref<HTMLInputElement>\n) {\n  const fieldRef = useRef<HTMLDivElement>(null);\n  const inputRef = useObjectRef(ref);\n  const {\n    displayWith = v => v.name,\n    validateWith,\n    children,\n    suggestions,\n    isLoading,\n    inputValue,\n    onInputValueChange,\n    onItemSelected,\n    placeholder,\n    onOpenChange,\n    chipSize = 'md',\n    openMenuOnFocus = true,\n    showEmptyMessage,\n    value: propsValue,\n    defaultValue,\n    onChange: propsOnChange,\n    valueKey,\n    isAsync,\n    allowCustomValue = true,\n    showDropdownArrow,\n    onChipClick,\n    ...inputFieldProps\n  } = props;\n  const fieldClassNames = getInputFieldClassNames({\n    ...props,\n    flexibleHeight: true,\n  });\n\n  const [value, onChange] = useChipFieldValueState(props);\n\n  const [listboxIsOpen, setListboxIsOpen] = useState(false);\n\n  const loadingIndicator = (\n    <ProgressCircle isIndeterminate size=\"sm\" aria-label=\"loading...\" />\n  );\n\n  const dropdownArrow = showDropdownArrow ? <KeyboardArrowDownIcon /> : null;\n\n  const {fieldProps, inputProps} = useField({\n    ...inputFieldProps,\n    focusRef: inputRef,\n    endAdornment: isLoading && listboxIsOpen ? loadingIndicator : dropdownArrow,\n  });\n\n  return (\n    <Field fieldClassNames={fieldClassNames} {...fieldProps}>\n      <Input\n        ref={fieldRef}\n        className={clsx('flex items-center flex-wrap', fieldClassNames.input)}\n        onClick={() => {\n          // refocus input when clicking outside it, but while still inside chip field\n          inputRef.current?.focus();\n        }}\n      >\n        <ListWrapper\n          displayChipUsing={displayWith}\n          onChipClick={onChipClick}\n          items={value}\n          setItems={onChange}\n          chipSize={chipSize}\n        />\n        <ChipInput\n          showEmptyMessage={showEmptyMessage}\n          inputProps={inputProps}\n          inputValue={inputValue}\n          onInputValueChange={onInputValueChange}\n          fieldRef={fieldRef}\n          inputRef={inputRef}\n          chips={value}\n          setChips={onChange}\n          validateWith={validateWith}\n          isLoading={isLoading}\n          suggestions={suggestions}\n          placeholder={placeholder}\n          openMenuOnFocus={openMenuOnFocus}\n          listboxIsOpen={listboxIsOpen}\n          setListboxIsOpen={setListboxIsOpen}\n          allowCustomValue={allowCustomValue}\n        >\n          {children}\n        </ChipInput>\n      </Input>\n    </Field>\n  );\n}\n\ninterface ListWrapperProps {\n  items: ChipValue[];\n  setItems: (items: ChipValue[]) => void;\n  displayChipUsing: (value: ChipValue) => ReactNode;\n  chipSize?: ChipProps['size'];\n  onChipClick?: (value: ChipValue) => void;\n}\nfunction ListWrapper({\n  items,\n  setItems,\n  displayChipUsing,\n  chipSize,\n  onChipClick,\n}: ListWrapperProps) {\n  const manager = useFocusManager();\n  const removeItem = useCallback(\n    (key: Key) => {\n      const i = items.findIndex(cr => cr.id === key);\n      const newItems = [...items];\n      if (i > -1) {\n        newItems.splice(i, 1);\n        setItems(newItems);\n      }\n      return newItems;\n    },\n    [items, setItems]\n  );\n\n  return (\n    <ChipList\n      className=\"flex-shrink-0 flex-wrap max-w-full my-8\"\n      size={chipSize}\n      selectable\n    >\n      {items.map(item => (\n        <Chip\n          key={item.id}\n          errorMessage={item.errorMessage}\n          adornment={item.image ? <Avatar circle src={item.image} /> : null}\n          onClick={() => onChipClick?.(item)}\n          onRemove={() => {\n            const newItems = removeItem(item.id);\n            if (newItems.length) {\n              // focus previous chip\n              manager.focusPrevious({tabbable: true});\n            } else {\n              // focus input\n              manager.focusLast();\n            }\n          }}\n        >\n          {displayChipUsing(item)}\n        </Chip>\n      ))}\n    </ChipList>\n  );\n}\n\ninterface ChipInputProps<T> {\n  showEmptyMessage?: boolean;\n  inputProps: ReturnType<typeof useField>['inputProps'];\n  inputValue?: string;\n  onInputValueChange?: (value: string) => void;\n  fieldRef: RefObject<HTMLDivElement>;\n  inputRef: RefObject<HTMLInputElement>;\n  chips: ChipValue[];\n  setChips: (items: ChipValue[]) => void;\n  validateWith?: (value: ChipValue) => ChipValue;\n  isLoading?: boolean;\n  suggestions?: T[];\n  placeholder?: string;\n  openMenuOnFocus?: boolean;\n  listboxIsOpen: boolean;\n  setListboxIsOpen: (value: boolean) => void;\n  allowCustomValue: boolean;\n  children: ListBoxChildren<T>['children'];\n}\nfunction ChipInput<T>(props: ChipInputProps<T>) {\n  const {\n    inputRef,\n    fieldRef,\n    validateWith,\n    setChips,\n    chips,\n    suggestions,\n    inputProps,\n    placeholder,\n    openMenuOnFocus,\n    listboxIsOpen,\n    setListboxIsOpen,\n    allowCustomValue,\n  } = props;\n  const inputClassName = 'outline-none text-sm mx-8 my-4 h-30 flex-auto';\n  const manager = useFocusManager();\n\n  const addItems = useCallback(\n    (items?: ChipValue[]) => {\n      items = (items || []).filter(item => {\n        const invalid = !item || !item.id || !item.name;\n        const alreadyExists = chips.findIndex(cr => cr.id === item?.id) > -1;\n        return !alreadyExists && !invalid;\n      });\n      if (!items.length) return;\n\n      if (validateWith) {\n        items = items.map(item => validateWith(item));\n      }\n      setChips([...chips, ...items]);\n    },\n    [chips, setChips, validateWith]\n  );\n\n  const listbox = useListbox<T>({\n    ...props,\n    clearInputOnItemSelection: true,\n    isOpen: listboxIsOpen,\n    onOpenChange: setListboxIsOpen,\n    items: suggestions,\n    selectionMode: 'none',\n    role: 'listbox',\n    virtualFocus: true,\n    onItemSelected: value => {\n      handleItemSelection(value as string);\n    },\n  });\n\n  const {\n    state: {\n      activeIndex,\n      setActiveIndex,\n      isOpen,\n      setIsOpen,\n      inputValue,\n      setInputValue,\n    },\n    refs,\n    listboxId,\n    collection,\n    onInputChange,\n  } = listbox;\n\n  const handleItemSelection = (textValue: string) => {\n    const option =\n      collection.size && activeIndex != null\n        ? [...collection.values()][activeIndex]\n        : null;\n    if (option?.item) {\n      addItems([option.item]);\n    } else if (allowCustomValue) {\n      addItems([stringToChipValue(option ? option.value : textValue)]);\n    }\n\n    setInputValue('');\n    setActiveIndex(null);\n    setIsOpen(false);\n  };\n\n  // position dropdown relative to whole chip field, not the input\n  useLayoutEffect(() => {\n    if (fieldRef.current && refs.reference.current !== fieldRef.current) {\n      listbox.reference(fieldRef.current);\n    }\n  }, [fieldRef, listbox, refs]);\n\n  const {handleTriggerKeyDown, handleListboxKeyboardNavigation} =\n    useListboxKeyboardNavigation(listbox);\n\n  const handleFocusAndClick = createEventHandler(() => {\n    if (openMenuOnFocus && !isOpen) {\n      setIsOpen(true);\n    }\n  });\n\n  return (\n    <Listbox\n      listbox={listbox}\n      mobileOverlay={Popover}\n      onPointerDown={e => {\n        // prevent focus from leaving input when scrolling listbox via mouse\n        e.preventDefault();\n      }}\n    >\n      <input\n        type=\"text\"\n        className={clsx(inputClassName, 'bg-transparent')}\n        placeholder={placeholder}\n        {...mergeProps(inputProps, {\n          ref: inputRef,\n          value: inputValue,\n          onChange: onInputChange,\n          onPaste: e => {\n            const paste = e.clipboardData.getData('text');\n            const emails = paste.match(\n              /([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\\.[a-zA-Z0-9._-]+)/gi\n            );\n            if (emails) {\n              e.preventDefault();\n              const selection = window.getSelection();\n              if (selection?.rangeCount) {\n                selection.deleteFromDocument();\n                addItems(emails.map(email => stringToChipValue(email)));\n              }\n            }\n          },\n          'aria-autocomplete': 'list',\n          'aria-controls': isOpen ? listboxId : undefined,\n          autoComplete: 'off',\n          autoCorrect: 'off',\n          spellCheck: 'false',\n          onKeyDown: e => {\n            const input = e.target as HTMLInputElement;\n\n            if (e.key === 'Enter') {\n              // prevent form submitting\n              e.preventDefault();\n              // add chip from selected listbox option or current input text value\n              handleItemSelection(input.value);\n              return;\n            }\n\n            // on escape, clear input and close dropdown\n            if (e.key === 'Escape' && isOpen) {\n              setIsOpen(false);\n              setInputValue('');\n            }\n\n            // move focus to input when focus is on first item and prevent arrow up from cycling listbox\n            if (\n              e.key === 'ArrowUp' &&\n              isOpen &&\n              (activeIndex === 0 || activeIndex == null)\n            ) {\n              setActiveIndex(null);\n              return;\n            }\n\n            // block left and right arrows from navigating in input, if focus is on listbox\n            if (\n              activeIndex != null &&\n              (e.key === 'ArrowLeft' || e.key === 'ArrowRight')\n            ) {\n              e.preventDefault();\n              return;\n            }\n\n            // move focus on the last chip, if focus is at the  start of input\n            if (\n              (e.key === 'ArrowLeft' ||\n                e.key === 'Backspace' ||\n                e.key === 'Delete') &&\n              input.selectionStart === 0 &&\n              activeIndex == null &&\n              chips.length\n            ) {\n              manager.focusPrevious({tabbable: true});\n              return;\n            }\n\n            // fallthrough to listbox navigation handlers for arrow keys\n            const handled = handleTriggerKeyDown(e);\n            if (!handled) {\n              handleListboxKeyboardNavigation(e);\n            }\n          },\n          onFocus: handleFocusAndClick,\n          onClick: handleFocusAndClick,\n        } as HTMLAttributes<HTMLInputElement>)}\n      />\n    </Listbox>\n  );\n}\n\nfunction useChipFieldValueState({\n  onChange,\n  value,\n  defaultValue,\n  valueKey,\n}: ChipFieldProps<any>) {\n  // convert value from string[] to ChipValue[], if needed\n  const propsValue = useMemo(() => {\n    return mixedValueToChipValue(value);\n  }, [value]);\n\n  // convert defaultValue from string[] to ChipValue[], if needed\n  const propsDefaultValue = useMemo(() => {\n    return mixedValueToChipValue(defaultValue);\n  }, [defaultValue]);\n\n  // emit string[] or ChipValue[] on change, based on \"valueKey\" prop\n  const handleChange = useCallback(\n    (value: ChipValue[]) => {\n      const newValue = valueKey ? value.map(v => v[valueKey]) : value;\n      onChange?.(newValue as any);\n    },\n    [onChange, valueKey]\n  );\n\n  return useControlledState<ChipValue[]>(\n    !propsValue ? undefined : propsValue,\n    propsDefaultValue || [],\n    handleChange\n  );\n}\n\nfunction mixedValueToChipValue(\n  value?: (string | number | ChipValue)[] | null\n): ChipValue[] | undefined {\n  if (value == null) {\n    return undefined;\n  }\n\n  return value.map(v => {\n    return typeof v !== 'object' ? stringToChipValue(v as string) : v;\n  });\n}\n\nexport const ChipField = React.forwardRef(ChipFieldInner) as <T>(\n  props: ChipFieldProps<T> & {ref?: Ref<HTMLInputElement>}\n) => ReactElement;\n","import {useController} from 'react-hook-form';\nimport {mergeProps} from '@react-aria/utils';\nimport React from 'react';\nimport {ChipField, ChipFieldProps} from './chip-field';\n\nexport type FormChipFieldProps<T> = ChipFieldProps<T> & {\n  name: string;\n};\n\nexport function FormChipField<T>({children, ...props}: FormChipFieldProps<T>) {\n  const {\n    field: {onChange, onBlur, value = [], ref},\n    fieldState: {invalid, error},\n  } = useController({\n    name: props.name,\n  });\n\n  const formProps: Partial<ChipFieldProps<T>> = {\n    onChange,\n    onBlur,\n    value,\n    invalid,\n    errorMessage: error?.message,\n  };\n\n  return (\n    <ChipField ref={ref} {...mergeProps(formProps, props)}>\n      {children}\n    </ChipField>\n  );\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const DragHandleIcon = createSvgIcon(\n  <path d=\"M20 9H4v2h16V9zM4 15h16v-2H4v2z\" />\n, 'DragHandleOutlined');\n","import {useCallback, useRef, useState} from 'react';\n\nexport function useStickySentinel() {\n  const [isSticky, setIsSticky] = useState(false);\n\n  const observerRef = useRef<IntersectionObserver>();\n\n  const sentinelRef = useCallback((sentinel: HTMLDivElement | null) => {\n    if (sentinel) {\n      const observer = new IntersectionObserver(\n        ([e]) => setIsSticky(e.intersectionRatio < 1),\n        {threshold: [1]}\n      );\n      observerRef.current = observer;\n      observer.observe(sentinel);\n    } else if (observerRef.current) {\n      observerRef.current?.disconnect();\n    }\n  }, []);\n\n  return {isSticky, sentinelRef};\n}\n","import {FieldValues, SubmitHandler, UseFormReturn} from 'react-hook-form';\nimport clsx from 'clsx';\nimport {ReactNode} from 'react';\nimport {useStickySentinel} from '../utils/hooks/sticky-sentinel';\nimport {Form} from '../ui/forms/form';\nimport {Button} from '../ui/buttons/button';\nimport {Trans} from '../i18n/trans';\n\ninterface Props<T extends FieldValues> {\n  onSubmit: SubmitHandler<T>;\n  form: UseFormReturn<T>;\n  title: ReactNode;\n  isLoading: boolean;\n  children: ReactNode;\n  disableSaveWhenNotDirty?: boolean;\n  wrapInContainer?: boolean;\n}\nexport function CrupdateResourceLayout<T extends FieldValues>({\n  onSubmit,\n  form,\n  title,\n  children,\n  isLoading = false,\n  disableSaveWhenNotDirty = false,\n  wrapInContainer = true,\n}: Props<T>) {\n  const {isSticky, sentinelRef} = useStickySentinel();\n  const isDirty = !disableSaveWhenNotDirty\n    ? true\n    : Object.keys(form.formState.dirtyFields).length;\n\n  return (\n    <Form\n      onSubmit={onSubmit}\n      onBeforeSubmit={() => {\n        form.clearErrors();\n      }}\n      form={form}\n    >\n      <div ref={sentinelRef} />\n      <div\n        className={clsx(\n          'sticky top-0 my-12 md:my-24 z-10 transition-shadow',\n          isSticky && 'bg-paper shadow'\n        )}\n      >\n        <div\n          className={clsx(\n            'flex items-center md:items-start gap-24 md:gap-80 py-14',\n            wrapInContainer && 'container mx-auto px-24'\n          )}\n        >\n          <h1 className=\"text-xl md:text-3xl whitespace-nowrap overflow-hidden overflow-ellipsis\">\n            {title}\n          </h1>\n          <Button\n            className=\"ml-auto\"\n            variant=\"flat\"\n            color=\"primary\"\n            type=\"submit\"\n            disabled={isLoading || !isDirty}\n          >\n            <Trans message=\"Save\" />\n          </Button>\n        </div>\n      </div>\n      <div\n        className={\n          wrapInContainer ? 'container mx-auto px-24 pb-24' : undefined\n        }\n      >\n        <div className=\"rounded\">{children}</div>\n      </div>\n    </Form>\n  );\n}\n","import {createSvgIcon} from '@common/icons/create-svg-icon';\n\nexport const InfoDialogTriggerIcon = createSvgIcon(\n  <path d=\"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z\" />,\n  'InfoDialogTrigger'\n);\n","import {IconButton} from '@common/ui/buttons/icon-button';\nimport {InfoDialogTriggerIcon} from '@common/ui/overlays/dialog/info-dialog-trigger/info-dialog-trigger-icon';\nimport {Dialog, DialogSize} from '@common/ui/overlays/dialog/dialog';\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\nimport React, {ReactNode} from 'react';\nimport clsx from 'clsx';\n\ninterface InfoDialogTriggerProps {\n  title?: ReactNode;\n  body: ReactNode;\n  dialogSize?: DialogSize;\n  className?: string;\n}\nexport function InfoDialogTrigger({\n  title,\n  body,\n  dialogSize = 'sm',\n  className,\n}: InfoDialogTriggerProps) {\n  return (\n    <DialogTrigger type=\"popover\" triggerOnHover>\n      <IconButton\n        className={clsx('text-muted opacity-70', className)}\n        size=\"xs\"\n      >\n        <InfoDialogTriggerIcon viewBox=\"0 0 16 16\" />\n      </IconButton>\n      <Dialog size={dialogSize}>\n        {title && (\n          <DialogHeader padding=\"px-18 pt-12\" size=\"md\" hideDismissButton>\n            {title}\n          </DialogHeader>\n        )}\n        <DialogBody>{body}</DialogBody>\n      </Dialog>\n    </DialogTrigger>\n  );\n}\n","export default \"__VITE_ASSET__be0c7262__\"","import {useQuery} from '@tanstack/react-query';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {NormalizedModel} from '@common/datatable/filters/normalized-model';\nimport {apiClient} from '@common/http/query-client';\n\ninterface Response extends BackendResponse {\n  results: NormalizedModel[];\n}\n\ninterface Params {\n  query?: string;\n  perPage?: number;\n}\n\nexport function useArtistPickerSuggestions(queryParams: Params) {\n  return useQuery(\n    ['artists', 'search-suggestions', queryParams],\n    () => fetchArtists(queryParams),\n    {\n      keepPreviousData: true,\n    }\n  );\n}\n\nasync function fetchArtists(params: Params) {\n  return apiClient\n    .get<Response>('search/suggestions/artist', {params})\n    .then(r => r.data);\n}\n","import {FormChipField} from '@common/ui/forms/input-field/chip-field/form-chip-field';\nimport {Trans} from '@common/i18n/trans';\nimport React, {useState} from 'react';\nimport {useArtistPickerSuggestions} from '@app/web-player/artists/artist-picker/use-artist-picker-suggestions';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {message} from '@common/i18n/message';\nimport {Item} from '@common/ui/forms/listbox/item';\n\ninterface FormArtistPickerProps {\n  name: string;\n  className?: string;\n}\nexport function FormArtistPicker({name, className}: FormArtistPickerProps) {\n  const {trans} = useTrans();\n  const [inputValue, setInputValue] = useState('');\n  const {data, isLoading} = useArtistPickerSuggestions({query: inputValue});\n\n  return (\n    <FormChipField\n      className={className}\n      name={name}\n      label={<Trans message=\"Artists\" />}\n      isAsync\n      inputValue={inputValue}\n      onInputValueChange={setInputValue}\n      suggestions={data?.results}\n      placeholder={trans(message('+Add artist'))}\n      isLoading={isLoading}\n      allowCustomValue={false}\n    >\n      {data?.results.map(result => (\n        <Item\n          value={result}\n          key={result.id}\n          startIcon={\n            result.image ? (\n              <img\n                className=\"rounded-full object-cover w-24 h-24\"\n                src={result.image}\n                alt=\"\"\n              />\n            ) : undefined\n          }\n        >\n          {result.name}\n        </Item>\n      ))}\n    </FormChipField>\n  );\n}\n","import {FormChipField} from '@common/ui/forms/input-field/chip-field/form-chip-field';\nimport React, {ReactNode, useState} from 'react';\nimport {Item} from '@common/ui/forms/listbox/item';\nimport {useNormalizedModels} from '@common/users/queries/use-normalized-models';\n\ninterface Props {\n  model: string;\n  name: string;\n  className?: string;\n  label?: ReactNode;\n  placeholder?: string;\n  allowCustomValue?: boolean;\n}\nexport function FormNormalizedModelChipField({\n  name,\n  label,\n  placeholder,\n  model,\n  className,\n  allowCustomValue = false,\n}: Props) {\n  const [inputValue, setInputValue] = useState('');\n  const {data, isLoading} = useNormalizedModels(model, {\n    query: inputValue,\n  });\n  return (\n    <FormChipField\n      className={className}\n      name={name}\n      label={label}\n      isAsync\n      inputValue={inputValue}\n      onInputValueChange={setInputValue}\n      suggestions={data?.results}\n      placeholder={placeholder}\n      isLoading={isLoading}\n      allowCustomValue={allowCustomValue}\n    >\n      {data?.results.map(result => (\n        <Item\n          value={result}\n          key={result.id}\n          startIcon={\n            result.image ? (\n              <img\n                className=\"rounded-full object-cover w-24 h-24\"\n                src={result.image}\n                alt=\"\"\n              />\n            ) : undefined\n          }\n        >\n          {result.name}\n        </Item>\n      ))}\n    </FormChipField>\n  );\n}\n","export const TAG_MODEL = 'tag';\n\nexport interface Tag {\n  id: number;\n  name: string;\n  display_name: string;\n  type: string;\n  updated_at: string;\n  created_at: string;\n  model_type: typeof TAG_MODEL;\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FileUploadIcon = createSvgIcon(\n  <path d=\"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zM7 9l1.41 1.41L11 7.83V16h2V7.83l2.59 2.58L17 9l-5-5-5 5z\" />\n, 'FileUploadOutlined');\n","import React, {ReactElement, useMemo} from 'react';\nimport {prettyBytes} from '@common/uploads/utils/pretty-bytes';\nimport {Trans} from '@common/i18n/trans';\nimport {FileUpload} from '@common/uploads/uploader/file-upload-store';\nimport {TrackUploadStatus} from '@app/admin/tracks-datatable-page/track-form/track-upload-progress';\nimport clsx from 'clsx';\n\ninterface Props {\n  fileUpload: FileUpload;\n  status: TrackUploadStatus;\n  className?: string;\n}\nexport function TrackUploadStatusText({fileUpload, status, className}: Props) {\n  const bytesUploaded = fileUpload?.bytesUploaded || 0;\n  const totalBytes = useMemo(\n    () => prettyBytes(fileUpload.file.size),\n    [fileUpload.file.size]\n  );\n  const uploadedBytes = useMemo(\n    () => prettyBytes(bytesUploaded),\n    [bytesUploaded]\n  );\n\n  let statusMessage: ReactElement;\n  if (status === 'completed') {\n    statusMessage = <Trans message=\"Upload complete\" />;\n  } else if (status === 'aborted') {\n    statusMessage = <Trans message=\"Upload cancelled\" />;\n  } else if (status === 'failed') {\n    statusMessage = <Trans message=\"Upload failed\" />;\n  } else if (status === 'processing') {\n    statusMessage = <Trans message=\"Processing upload...\" />;\n  } else if (status === 'pending') {\n    statusMessage = <Trans message=\"Waiting to start...\" />;\n  } else {\n    statusMessage = (\n      <Trans\n        message=\":bytesUploaded of :totalBytes uploaded\"\n        values={{\n          bytesUploaded: uploadedBytes,\n          totalBytes,\n        }}\n      />\n    );\n  }\n\n  return (\n    <div className={clsx('text-muted text-xs', className)}>{statusMessage}</div>\n  );\n}\n","import {FileUpload} from '@common/uploads/uploader/file-upload-store';\nimport {ProgressBar} from '@common/ui/progress/progress-bar';\nimport React, {ComponentPropsWithoutRef, ReactElement} from 'react';\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\nimport {message} from '@common/i18n/message';\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\nimport {MixedText} from '@common/i18n/mixed-text';\nimport {ErrorIcon} from '@common/icons/material/Error';\nimport {WarningIcon} from '@common/icons/material/Warning';\nimport {CheckCircleIcon} from '@common/icons/material/CheckCircle';\nimport {IconButton} from '@common/ui/buttons/icon-button';\nimport {CloseIcon} from '@common/icons/material/Close';\nimport {AnimatePresence, m} from 'framer-motion';\nimport {TrackUploadStatusText} from '@app/admin/tracks-datatable-page/track-form/track-upload-status-text';\n\nexport type TrackUploadStatus = FileUpload['status'] | 'processing' | undefined;\n\ninterface UploadProgressProps {\n  fileUpload: FileUpload;\n  status: TrackUploadStatus;\n  onAbort?: (uploadId: string) => void;\n  size?: 'sm' | 'md';\n  className?: string;\n}\nexport function TrackUploadProgress({\n  fileUpload,\n  status,\n  onAbort,\n  size = 'md',\n  className,\n}: UploadProgressProps) {\n  return (\n    <div className={className}>\n      <div className=\"flex items-center gap-24 justify-between\">\n        <TrackUploadStatusText fileUpload={fileUpload} status={status} />\n        <UploadStatusButton\n          fileUpload={fileUpload}\n          status={status}\n          onAbort={onAbort}\n        />\n      </div>\n      <ProgressBar\n        size={size === 'sm' ? 'xs' : 'sm'}\n        radius=\"rounded-sm\"\n        value={fileUpload.percentage}\n        isIndeterminate={status === 'processing' || status === 'pending'}\n      />\n    </div>\n  );\n}\n\nfunction UploadStatusButton({\n  fileUpload,\n  status,\n  onAbort,\n}: UploadProgressProps) {\n  const abortUpload = useFileUploadStore(s => s.abortUpload);\n  const clearInactive = useFileUploadStore(s => s.clearInactive);\n  const errorMessage = fileUpload.errorMessage;\n\n  let statusButton: ReactElement;\n  if (status === 'failed') {\n    const errMessage =\n      errorMessage || message('This file could not be uploaded');\n    statusButton = (\n      <AnimatedStatus>\n        <Tooltip variant=\"danger\" label={<MixedText value={errMessage} />}>\n          <ErrorIcon className=\"text-danger\" size=\"sm\" />\n        </Tooltip>\n      </AnimatedStatus>\n    );\n  } else if (status === 'aborted') {\n    statusButton = (\n      <AnimatedStatus>\n        <WarningIcon className=\"text-warning\" size=\"sm\" />\n      </AnimatedStatus>\n    );\n  } else if (status === 'completed' || status === 'processing') {\n    statusButton = (\n      <AnimatedStatus>\n        <CheckCircleIcon size=\"sm\" className=\"text-primary\" />\n      </AnimatedStatus>\n    );\n  } else if (onAbort) {\n    statusButton = (\n      <AnimatedStatus>\n        <IconButton size=\"xs\" onClick={() => onAbort(fileUpload.file.id)}>\n          <CloseIcon />\n        </IconButton>\n      </AnimatedStatus>\n    );\n  } else {\n    // keep the spacing, even if status button is hidden\n    statusButton = <div className=\"w-30 h-30\" />;\n  }\n\n  return <AnimatePresence>{statusButton}</AnimatePresence>;\n}\n\ninterface AnimatedStatusProps\n  extends Omit<\n    ComponentPropsWithoutRef<'div'>,\n    'onAnimationStart' | 'onDragStart' | 'onDragEnd' | 'onDrag'\n  > {\n  children: ReactElement;\n}\nfunction AnimatedStatus({children, ...domProps}: AnimatedStatusProps) {\n  return (\n    <m.div\n      className=\"flex w-30 h-30 items-center justify-center\"\n      {...domProps}\n      initial={{scale: 0, opacity: 0}}\n      animate={{scale: 1, opacity: 1}}\n      exit={{scale: 0, opacity: 0}}\n    >\n      {children}\n    </m.div>\n  );\n}\n","import {useMutation} from '@tanstack/react-query';\nimport {apiClient} from '@common/http/query-client';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\nimport {Album} from '@app/web-player/albums/album';\nimport {Artist} from '@app/web-player/artists/artist';\nimport {FileEntry} from '@common/uploads/file-entry';\nimport {CreateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-create-track';\nimport {NormalizedModel} from '@common/datatable/filters/normalized-model';\nimport {UseFormReturn} from 'react-hook-form';\nimport {CreateAlbumPayload} from '@app/admin/albums-datatable-page/requests/use-create-album';\n\nexport type ExtractedTrackMetadata = Partial<CreateTrackPayload> & {\n  release_date?: string;\n  album_name?: string;\n};\n\ninterface Response extends BackendResponse {\n  metadata: {\n    title?: string;\n    album?: Album;\n    album_name?: string;\n    artist?: Artist;\n    artist_name?: string;\n    genres?: string[];\n    duration?: number;\n    release_date?: string;\n    comment?: string;\n    image?: FileEntry;\n    lyrics?: string;\n  };\n}\n\ninterface Payload {\n  fileEntryId: number;\n  autoMatchAlbum?: boolean;\n}\n\nexport function useExtractTackFileMetadata() {\n  return useMutation((payload: Payload) => extractMeta(payload), {\n    onError: err => showHttpErrorToast(err),\n  });\n}\n\nfunction extractMeta(payload: Payload): Promise<ExtractedTrackMetadata> {\n  return apiClient\n    .post<Response>(`tracks/${payload.fileEntryId}/extract-metadata`, payload)\n    .then(r => metadataToFormValues(r.data));\n}\n\nfunction metadataToFormValues(response: Response): ExtractedTrackMetadata {\n  const values: ExtractedTrackMetadata = {\n    name: response.metadata.title,\n    duration: response.metadata.duration,\n    genres: response.metadata.genres || [],\n    description: response.metadata.comment,\n    lyric: response.metadata.lyrics,\n    release_date: response.metadata.release_date,\n    album_name: response.metadata.album_name,\n  };\n  if (response.metadata.album) {\n    values.album_id = response.metadata.album.id;\n  }\n  if (response.metadata.artist) {\n    values.artists = [response.metadata.artist];\n  }\n  if (response.metadata.image) {\n    values.image = response.metadata.image.url;\n  }\n  return values;\n}\n\nexport function hydrateAlbumForm(\n  form: UseFormReturn<CreateAlbumPayload>,\n  data: ExtractedTrackMetadata\n) {\n  if (!form.getValues('artists')?.length && data.artists) {\n    form.setValue('artists', data.artists);\n  }\n  if (!form.getValues('image') && data.image) {\n    form.setValue('image', data.image);\n  }\n  if (data.release_date) {\n    form.setValue('release_date', data.release_date);\n  }\n  if (data.genres?.length) {\n    form.setValue(\n      'genres',\n      // @ts-ignore\n      mergeArraysWithoutDuplicates(form.getValues('genres'), data.genres)\n    );\n  }\n  if (!form.getValues('name') && data.album_name) {\n    form.setValue('name', data.album_name);\n  }\n}\n\ntype Values = Partial<CreateTrackPayload>;\nexport function mergeTrackFormValues<\n  T extends Values = Values,\n  E extends Values = Values\n>(newValues: T, oldValues: E): T & E {\n  return {\n    ...oldValues,\n    ...newValues,\n    artists: mergeArraysWithoutDuplicates(oldValues.artists, newValues.artists),\n    genres: mergeArraysWithoutDuplicates(\n      oldValues.genres as NormalizedModel[],\n      newValues.genres as NormalizedModel[],\n      'name'\n    ),\n    tags: mergeArraysWithoutDuplicates(oldValues.tags, newValues.tags, 'name'),\n  };\n}\n\nfunction mergeArraysWithoutDuplicates(\n  oldValues: NormalizedModel[] = [],\n  newValues: NormalizedModel[] = [],\n  key: keyof NormalizedModel = 'id'\n) {\n  newValues = newValues.filter(\n    nv => !oldValues.find(ov => ov[key] === nv[key])\n  );\n  return [...oldValues, ...newValues];\n}\n","import {useSettings} from '@common/core/settings/use-settings';\nimport {\n  ExtractedTrackMetadata,\n  useExtractTackFileMetadata,\n} from '@app/admin/tracks-datatable-page/requests/use-extract-track-file-metadata';\nimport {UploadStrategyConfig} from '@common/uploads/uploader/strategy/upload-strategy';\nimport {useCallback, useMemo, useRef} from 'react';\nimport {UploadInputType} from '@common/uploads/types/upload-input-config';\nimport {Disk} from '@common/uploads/types/backend-metadata';\nimport {FileEntry} from '@common/uploads/file-entry';\nimport {toast} from '@common/ui/toast/toast';\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\nimport {openUploadWindow} from '@common/uploads/utils/open-upload-window';\nimport {generateWaveformData} from '@app/web-player/tracks/waveform/generate-waveform-data';\nimport {UploadedFile} from '@common/uploads/uploaded-file';\nimport {CreateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-create-track';\nimport {validateUpload} from '@common/uploads/uploader/validate-upload';\nimport {message} from '@common/i18n/message';\n\nconst FiftyMB = 50 * 1024 * 1024;\n\nexport interface TrackUploadMeta {\n  isGeneratingWave?: boolean;\n  isExtractingMetadata?: boolean;\n}\n\nexport type TrackUploadPayload = CreateTrackPayload & {uploadId: string};\n\ninterface Options {\n  autoMatchAlbum?: boolean;\n  onUploadStart?: (data: TrackUploadPayload) => void;\n  onMetadataChange: (\n    file: UploadedFile,\n    newData: ExtractedTrackMetadata & {waveData?: number[][]}\n  ) => void;\n}\nexport function useTrackUploader(options: Options) {\n  const {uploads} = useSettings();\n  const restrictions = useMemo(\n    () => ({\n      allowedFileTypes: [UploadInputType.audio, UploadInputType.video],\n      maxFileSize: uploads.max_size || FiftyMB,\n    }),\n    [uploads.max_size]\n  );\n\n  const extractMetadata = useExtractTackFileMetadata();\n  const optionsRef = useRef<Options>(options);\n  optionsRef.current = options;\n\n  const uploadMultiple = useFileUploadStore(s => s.uploadMultiple);\n  const updateFileUpload = useFileUploadStore(s => s.updateFileUpload);\n  const getUpload = useFileUploadStore(s => s.getUpload);\n  const updateUpload = useCallback(\n    (uploadId: string, newMeta: TrackUploadMeta) => {\n      updateFileUpload(uploadId, {\n        meta: {\n          // @ts-ignore\n          ...(getUpload(uploadId)?.meta || {}),\n          ...newMeta,\n        },\n      });\n    },\n    [updateFileUpload, getUpload]\n  );\n\n  const uploadOptions: UploadStrategyConfig = useMemo(() => {\n    return {\n      metadata: {\n        diskPrefix: 'track_media',\n        disk: Disk.public,\n      },\n      restrictions,\n      onSuccess: (entry: FileEntry, file) => {\n        updateUpload(file.id, {isExtractingMetadata: true});\n        extractMetadata.mutate(\n          {\n            fileEntryId: entry.id,\n            autoMatchAlbum: optionsRef.current.autoMatchAlbum,\n          },\n          {\n            onSuccess: formValues => {\n              updateUpload(file.id, {isExtractingMetadata: false});\n              const newValues: ExtractedTrackMetadata = {\n                ...formValues,\n                src: entry.url,\n              };\n              optionsRef.current.onMetadataChange(file, newValues);\n            },\n            onError: () => {\n              updateUpload(file.id, {isExtractingMetadata: false});\n            },\n          }\n        );\n      },\n      onError: message => {\n        if (message) {\n          toast.danger(message);\n        }\n      },\n    };\n  }, [extractMetadata, updateUpload, restrictions]);\n\n  const validateUploads = useCallback(\n    (files: UploadedFile[]) => {\n      const validFiles = files.filter(\n        file => !validateUpload(file, restrictions)\n      );\n      // show error message, if some files did not pass validation\n      if (files.length !== validFiles.length) {\n        toast.danger(\n          message(':count of your files is not supported.', {\n            values: {count: files.length - validFiles.length},\n          })\n        );\n      }\n      return validFiles;\n    },\n    [restrictions]\n  );\n\n  const uploadTracks = useCallback(\n    async (files: UploadedFile[]) => {\n      const validFiles = validateUploads(files);\n      if (!validFiles.length) return;\n      files.forEach(file => {\n        optionsRef.current.onUploadStart?.({\n          name: file.name,\n          uploadId: file.id,\n        });\n      });\n      uploadMultiple(files, uploadOptions);\n      for (const file of files) {\n        updateUpload(file.id, {isGeneratingWave: true});\n        const waveData = await generateWaveformData(file.native);\n        if (waveData) {\n          optionsRef.current.onMetadataChange(file, {waveData});\n        }\n        updateUpload(file.id, {isGeneratingWave: false});\n      }\n    },\n    [uploadOptions, uploadMultiple, updateUpload, validateUploads]\n  );\n\n  const openFilePicker = useCallback(async () => {\n    const files = await openUploadWindow({\n      multiple: true,\n      types: restrictions.allowedFileTypes,\n    });\n    await uploadTracks(files);\n  }, [uploadTracks, restrictions]);\n\n  return {openFilePicker, uploadTracks, validateUploads};\n}\n","import {TrackUploadStatus} from '@app/admin/tracks-datatable-page/track-form/track-upload-progress';\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\nimport {TrackUploadMeta} from '@app/web-player/backstage/upload-page/use-track-uploader';\n\nexport function useTrackUpload(uploadId: string | undefined) {\n  const upload = useFileUploadStore(s =>\n    uploadId ? s.fileUploads.get(uploadId) : null\n  );\n\n  let isUploading = false;\n  let status: TrackUploadStatus;\n\n  if (upload) {\n    const meta = upload.meta as TrackUploadMeta | undefined;\n    const isProcessing = meta?.isExtractingMetadata || meta?.isGeneratingWave;\n\n    isUploading =\n      upload?.status === 'pending' ||\n      upload?.status === 'inProgress' ||\n      !!isProcessing;\n\n    status =\n      upload?.status === 'completed' && isProcessing\n        ? 'processing'\n        : upload?.status;\n  }\n\n  return {isUploading, status, activeUpload: upload};\n}\n","import React, {useState} from 'react';\nimport {Trans} from '@common/i18n/trans';\nimport {Button} from '@common/ui/buttons/button';\nimport {FileUploadIcon} from '@common/icons/material/FileUpload';\nimport {TrackUploadProgress} from '@app/admin/tracks-datatable-page/track-form/track-upload-progress';\nimport {useFormContext} from 'react-hook-form';\nimport {CreateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-create-track';\nimport {useTrackUploader} from '@app/web-player/backstage/upload-page/use-track-uploader';\nimport {useTrackUpload} from '@app/web-player/backstage/upload-page/use-track-upload';\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\nimport {mergeTrackFormValues} from '@app/admin/tracks-datatable-page/requests/use-extract-track-file-metadata';\n\nexport function TrackFormUploadButton() {\n  const [uploadId, setUploadId] = useState<string>();\n  const {setValue, watch, getValues} = useFormContext<CreateTrackPayload>();\n  const {openFilePicker} = useTrackUploader({\n    onUploadStart: ({uploadId}) => setUploadId(uploadId),\n    onMetadataChange: (file, newData) => {\n      const mergedValues = mergeTrackFormValues(newData, getValues());\n      Object.entries(mergedValues).forEach(([key, value]) =>\n        setValue(key as keyof CreateTrackPayload, value, {shouldDirty: true})\n      );\n    },\n  });\n  const {status, isUploading, activeUpload} = useTrackUpload(uploadId);\n  const {abortUpload, clearInactive} = useFileUploadStore();\n  return (\n    <div>\n      <Button\n        className=\"w-full\"\n        variant=\"flat\"\n        color=\"primary\"\n        startIcon={<FileUploadIcon />}\n        disabled={isUploading}\n        onClick={() => openFilePicker()}\n      >\n        {watch('src') ? (\n          <Trans message=\"Replace file\" />\n        ) : (\n          <Trans message=\"Upload file\" />\n        )}\n      </Button>\n      {activeUpload && (\n        <TrackUploadProgress\n          fileUpload={activeUpload}\n          status={status}\n          className=\"mt-24\"\n          onAbort={uploadId => {\n            abortUpload(uploadId);\n            clearInactive();\n          }}\n        />\n      )}\n    </div>\n  );\n}\n","import React, {ReactNode} from 'react';\nimport {FormTextField} from '@common/ui/forms/input-field/text-field/text-field';\nimport {Trans} from '@common/i18n/trans';\nimport {FormImageSelector} from '@common/ui/images/image-selector';\nimport {FormNormalizedModelField} from '@common/ui/forms/normalized-model-field';\nimport {ALBUM_MODEL} from '@app/web-player/albums/album';\nimport {FormArtistPicker} from '@app/web-player/artists/artist-picker/form-artist-picker';\nimport {FormNormalizedModelChipField} from '@common/tags/form-normalized-model-chip-field';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {message} from '@common/i18n/message';\nimport {TAG_MODEL} from '@common/tags/tag';\nimport {GENRE_MODEL} from '@app/web-player/genres/genre';\nimport {useFormContext} from 'react-hook-form';\nimport {CreateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-create-track';\nimport {FormattedDuration} from '@common/i18n/formatted-duration';\nimport {useSettings} from '@common/core/settings/use-settings';\nimport {TrackFormUploadButton} from '@app/admin/tracks-datatable-page/track-form/track-form-upload-button';\nimport {useIsMobileMediaQuery} from '@common/utils/hooks/is-mobile-media-query';\n\ninterface TrackFormProps {\n  showExternalIdFields?: boolean;\n  showAlbumField?: boolean;\n  uploadButton?: ReactNode;\n}\nexport function TrackForm({\n  showExternalIdFields,\n  showAlbumField = true,\n  uploadButton,\n}: TrackFormProps) {\n  const {trans} = useTrans();\n  const isMobile = useIsMobileMediaQuery();\n\n  return (\n    <div className=\"md:flex gap-24\">\n      <div className=\"flex-shrink-0\">\n        <FormImageSelector\n          name=\"image\"\n          diskPrefix=\"track_image\"\n          variant={isMobile ? 'input' : 'square'}\n          label={isMobile ? <Trans message=\"Image\" /> : null}\n          previewSize={isMobile ? undefined : 'w-full md:w-224 aspect-square'}\n          stretchPreview\n        />\n        <div className=\"mt-24\">\n          {uploadButton ? uploadButton : <TrackFormUploadButton />}\n        </div>\n      </div>\n      <div className=\"flex-auto mt-24 md:mt-0\">\n        <FormTextField\n          name=\"name\"\n          label={<Trans message=\"Name\" />}\n          className=\"mb-24\"\n          required\n          autoFocus\n        />\n        {showAlbumField && (\n          <FormNormalizedModelField\n            className=\"mb-24\"\n            label={<Trans message=\"Album\" />}\n            name=\"album_id\"\n            modelType={ALBUM_MODEL}\n            openMenuOnFocus\n            customEndpoint=\"search/suggestions\"\n          />\n        )}\n        <FormArtistPicker name=\"artists\" className=\"mb-24\" />\n        <FormNormalizedModelChipField\n          label={<Trans message=\"Genres\" />}\n          placeholder={trans(message('+Add genre'))}\n          model={GENRE_MODEL}\n          name=\"genres\"\n          allowCustomValue\n          className=\"mb-24\"\n        />\n        <FormNormalizedModelChipField\n          label={<Trans message=\"Tags\" />}\n          placeholder={trans(message('+Add tag'))}\n          model={TAG_MODEL}\n          name=\"tags\"\n          allowCustomValue\n          className=\"mb-24\"\n        />\n        <FormTextField\n          name=\"description\"\n          label={<Trans message=\"Description\" />}\n          inputElementType=\"textarea\"\n          rows={5}\n          className=\"mb-24\"\n        />\n        <DurationField />\n        {showExternalIdFields && <SourceField />}\n        {showExternalIdFields && <SpotifyIdField />}\n      </div>\n    </div>\n  );\n}\n\nfunction SourceField() {\n  return (\n    <FormTextField\n      name=\"src\"\n      label={<Trans message=\"Playback source\" />}\n      className=\"mb-24\"\n      minLength={1}\n      maxLength={230}\n      description={\n        <Trans message=\"Supports audio, video, hls/dash stream and youtube video url. If left empty, best matching youtube video will be found automatically.\" />\n      }\n    />\n  );\n}\n\nfunction SpotifyIdField() {\n  const {spotify_is_setup} = useSettings();\n  if (!spotify_is_setup) {\n    return null;\n  }\n  return (\n    <FormTextField\n      name=\"spotify_id\"\n      label={<Trans message=\"Spotify ID\" />}\n      className=\"mb-24\"\n      minLength={22}\n      maxLength={22}\n    />\n  );\n}\n\nfunction DurationField() {\n  const {watch} = useFormContext<CreateTrackPayload>();\n  return (\n    <FormTextField\n      required\n      name=\"duration\"\n      label={<Trans message=\"Duration (in milliseconds)\" />}\n      className=\"mb-24\"\n      type=\"number\"\n      min={1}\n      max={86400000}\n      description={\n        <Trans\n          message=\"Will appear on the site as: :preview\"\n          values={{preview: <FormattedDuration ms={watch('duration')} />}}\n        />\n      }\n    />\n  );\n}\n","import {useMutation} from '@tanstack/react-query';\nimport {UseFormReturn} from 'react-hook-form';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {toast} from '@common/ui/toast/toast';\nimport {DatatableDataQueryKey} from '@common/datatable/requests/paginated-resources';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {message} from '@common/i18n/message';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {Track} from '@app/web-player/tracks/track';\nimport {NormalizedModel} from '@common/datatable/filters/normalized-model';\nimport {TrackUploadPayload} from '@app/web-player/backstage/upload-page/use-track-uploader';\n\nconst endpoint = 'tracks';\n\nexport interface CreateTrackResponse extends BackendResponse {\n  track: Track;\n}\n\nexport interface CreateTrackPayload\n  extends Omit<\n    Track,\n    'genres' | 'artists' | 'tags' | 'id' | 'model_type' | 'album' | 'lyric'\n  > {\n  album_id?: number;\n  artists?: NormalizedModel[];\n  waveData?: number[][];\n  genres?: NormalizedModel[] | string[];\n  tags?: NormalizedModel[];\n  lyric?: string;\n}\n\ninterface Options {\n  onSuccess?: (response: CreateTrackResponse) => void;\n}\n\nexport function useCreateTrack(\n  form: UseFormReturn<CreateTrackPayload> | UseFormReturn<TrackUploadPayload>,\n  {onSuccess}: Options = {}\n) {\n  const {trans} = useTrans();\n  return useMutation((payload: CreateTrackPayload) => createTrack(payload), {\n    onSuccess: response => {\n      toast(trans(message('Track created')));\n      queryClient.invalidateQueries(DatatableDataQueryKey(endpoint));\n      onSuccess?.(response);\n    },\n    onError: err => onFormQueryError(err, form),\n  });\n}\n\nfunction createTrack(payload: CreateTrackPayload) {\n  return apiClient\n    .post<CreateTrackResponse>(endpoint, prepareTrackPayload(payload))\n    .then(r => r.data);\n}\n\nexport function prepareTrackPayload(payload: CreateTrackPayload) {\n  return {\n    ...payload,\n    album_id: payload.album_id ? payload.album_id : null,\n    artists: payload.artists?.map(artist => artist.id),\n  };\n}\n","import {useForm} from 'react-hook-form';\nimport {\n  CreateTrackPayload,\n  CreateTrackResponse,\n  useCreateTrack,\n} from '@app/admin/tracks-datatable-page/requests/use-create-track';\n\ninterface Props {\n  onTrackCreated?: (response: CreateTrackResponse) => void;\n  defaultValues?: Partial<CreateTrackPayload>;\n}\n\nexport function useCreateTrackForm({\n  onTrackCreated,\n  defaultValues,\n}: Props = {}) {\n  const form = useForm<CreateTrackPayload>({\n    defaultValues,\n  });\n  const createTrack = useCreateTrack(form, {onSuccess: onTrackCreated});\n  return {form, createTrack};\n}\n","import React from 'react';\nimport {CrupdateResourceLayout} from '@common/admin/crupdate-resource-layout';\nimport {Trans} from '@common/i18n/trans';\nimport {TrackForm} from '@app/admin/tracks-datatable-page/track-form/track-form';\nimport {useCreateTrackForm} from '@app/admin/tracks-datatable-page/crupdate/use-create-track-form';\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\nimport {FileUploadProvider} from '@common/uploads/uploader/file-upload-provider';\nimport {useLocation} from 'react-router-dom';\nimport {getTrackLink} from '@app/web-player/tracks/track-link';\n\ninterface Props {\n  wrapInContainer?: boolean;\n}\nexport function CreateTrackPage({wrapInContainer}: Props) {\n  const navigate = useNavigate();\n  const {pathname} = useLocation();\n  const {form, createTrack} = useCreateTrackForm({\n    onTrackCreated: response => {\n      if (pathname.includes('admin')) {\n        navigate(`/admin/tracks/${response.track.id}/edit`);\n      } else {\n        navigate(getTrackLink(response.track));\n      }\n    },\n  });\n  return (\n    <CrupdateResourceLayout\n      form={form}\n      onSubmit={values => {\n        createTrack.mutate(values);\n      }}\n      title={<Trans message=\"Add new track\" />}\n      isLoading={createTrack.isLoading}\n      disableSaveWhenNotDirty\n      wrapInContainer={wrapInContainer}\n    >\n      <FileUploadProvider>\n        <TrackForm showExternalIdFields />\n      </FileUploadProvider>\n    </CrupdateResourceLayout>\n  );\n}\n","import {useMutation} from '@tanstack/react-query';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {toast} from '@common/ui/toast/toast';\nimport {message} from '@common/i18n/message';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {DatatableDataQueryKey} from '@common/datatable/requests/paginated-resources';\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {UseFormReturn} from 'react-hook-form';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {Track} from '@app/web-player/tracks/track';\nimport {\n  CreateTrackPayload,\n  prepareTrackPayload,\n} from '@app/admin/tracks-datatable-page/requests/use-create-track';\n\nexport interface UpdateTrackResponse extends BackendResponse {\n  track: Track;\n}\n\nexport interface UpdateTrackPayload extends CreateTrackPayload {\n  id: number;\n}\n\nconst Endpoint = (id: number) => `tracks/${id}`;\n\ninterface Options {\n  onSuccess?: (response: UpdateTrackResponse) => void;\n}\n\nexport function useUpdateTrack(\n  form: UseFormReturn<UpdateTrackPayload>,\n  options: Options = {}\n) {\n  const {trans} = useTrans();\n  return useMutation((payload: UpdateTrackPayload) => updateChannel(payload), {\n    onSuccess: response => {\n      toast(trans(message('Track updated')));\n      queryClient.invalidateQueries(DatatableDataQueryKey('tracks'));\n      options.onSuccess?.(response);\n    },\n    onError: err => onFormQueryError(err, form),\n  });\n}\n\nfunction updateChannel({\n  id,\n  ...payload\n}: UpdateTrackPayload): Promise<UpdateTrackResponse> {\n  return apiClient\n    .put(Endpoint(id), prepareTrackPayload(payload as CreateTrackPayload))\n    .then(r => r.data);\n}\n","import {useForm} from 'react-hook-form';\nimport {\n  UpdateTrackPayload,\n  UpdateTrackResponse,\n  useUpdateTrack,\n} from '@app/admin/tracks-datatable-page/requests/use-update-track';\nimport {Track} from '@app/web-player/tracks/track';\nimport {CreateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-create-track';\n\ninterface Options {\n  onTrackUpdated?: (response: UpdateTrackResponse) => void;\n}\n\nexport function useUpdateTrackForm(\n  track: UpdateTrackPayload | CreateTrackPayload | Omit<Track, 'lyric'>,\n  options: Options = {}\n) {\n  const form = useForm<UpdateTrackPayload>({\n    defaultValues: {\n      ...track,\n      image: track.image || (track as Track).album?.image,\n    },\n  });\n  const updateTrack = useUpdateTrack(form, {onSuccess: options.onTrackUpdated});\n  return {form, updateTrack};\n}\n","import React from 'react';\nimport {CrupdateResourceLayout} from '@common/admin/crupdate-resource-layout';\nimport {Trans} from '@common/i18n/trans';\nimport {TrackForm} from '@app/admin/tracks-datatable-page/track-form/track-form';\nimport {useTrack} from '@app/web-player/tracks/requests/use-track';\nimport {Track} from '@app/web-player/tracks/track';\nimport {useUpdateTrackForm} from '@app/admin/tracks-datatable-page/crupdate/use-update-track-form';\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\nimport {FileUploadProvider} from '@common/uploads/uploader/file-upload-provider';\nimport {PageStatus} from '@common/http/page-status';\nimport {Navigate, useLocation} from 'react-router-dom';\nimport {getTrackLink} from '@app/web-player/tracks/track-link';\nimport {useTrackPermissions} from '@app/web-player/tracks/hooks/use-track-permissions';\n\ninterface Props {\n  wrapInContainer?: boolean;\n}\nexport function UpdateTrackPage({wrapInContainer}: Props) {\n  const query = useTrack({forEditing: true});\n  if (query.data) {\n    return (\n      <PageContent track={query.data.track} wrapInContainer={wrapInContainer} />\n    );\n  }\n  return <PageStatus query={query} loaderClassName=\"absolute inset-0 m-auto\" />;\n}\n\ninterface PageContentProps {\n  track: Track;\n  wrapInContainer?: boolean;\n}\nfunction PageContent({track, wrapInContainer}: PageContentProps) {\n  const {canEdit} = useTrackPermissions([track]);\n  const navigate = useNavigate();\n  const {pathname} = useLocation();\n  const {form, updateTrack} = useUpdateTrackForm(track, {\n    onTrackUpdated: response => {\n      if (pathname.includes('admin')) {\n        navigate('/admin/tracks');\n      } else {\n        navigate(getTrackLink(response.track));\n      }\n    },\n  });\n\n  if (!canEdit) {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  return (\n    <CrupdateResourceLayout\n      form={form}\n      onSubmit={values => {\n        updateTrack.mutate(values);\n      }}\n      title={<Trans message=\"Edit :name track\" values={{name: track.name}} />}\n      isLoading={updateTrack.isLoading}\n      disableSaveWhenNotDirty\n      wrapInContainer={wrapInContainer}\n    >\n      <FileUploadProvider>\n        <TrackForm showExternalIdFields />\n      </FileUploadProvider>\n    </CrupdateResourceLayout>\n  );\n}\n","import {useMutation} from '@tanstack/react-query';\nimport {UseFormReturn} from 'react-hook-form';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {toast} from '@common/ui/toast/toast';\nimport {DatatableDataQueryKey} from '@common/datatable/requests/paginated-resources';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {message} from '@common/i18n/message';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {NormalizedModel} from '@common/datatable/filters/normalized-model';\nimport {Album} from '@app/web-player/albums/album';\nimport {\n  CreateTrackPayload,\n  prepareTrackPayload,\n} from '@app/admin/tracks-datatable-page/requests/use-create-track';\n\nconst endpoint = 'albums';\n\ninterface Response extends BackendResponse {\n  album: Album;\n}\n\nexport type CreateAlbumPayloadTrack = Omit<\n  CreateTrackPayload,\n  'album' | 'artists' | 'lyric'\n> & {\n  uploadId: string;\n};\n\nexport interface CreateAlbumPayload\n  extends Omit<Album, 'genres' | 'tags' | 'tracks' | 'artists'> {\n  artists: NormalizedModel[];\n  genres?: NormalizedModel[] | string[];\n  tags?: NormalizedModel[];\n  tracks: CreateAlbumPayloadTrack[];\n}\n\nexport function useCreateAlbum(form: UseFormReturn<CreateAlbumPayload>) {\n  const {trans} = useTrans();\n  return useMutation((payload: CreateAlbumPayload) => createAlbum(payload), {\n    onSuccess: () => {\n      toast(trans(message('Album created')));\n      queryClient.invalidateQueries(DatatableDataQueryKey(endpoint));\n    },\n    onError: err => onFormQueryError(err, form),\n  });\n}\n\nfunction createAlbum(payload: CreateAlbumPayload) {\n  return apiClient\n    .post<Response>(endpoint, prepareAlbumPayload(payload))\n    .then(r => r.data);\n}\n\nexport function prepareAlbumPayload(payload: CreateAlbumPayload) {\n  return {\n    ...payload,\n    artists: payload.artists?.map(artist => artist.id),\n    tracks: payload.tracks?.map(track => prepareTrackPayload(track)),\n  };\n}\n","import {useMutation} from '@tanstack/react-query';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\nimport {toast} from '@common/ui/toast/toast';\nimport {message} from '@common/i18n/message';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {DatatableDataQueryKey} from '@common/datatable/requests/paginated-resources';\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {UseFormReturn} from 'react-hook-form';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {\n  CreateAlbumPayload,\n  prepareAlbumPayload,\n} from '@app/admin/albums-datatable-page/requests/use-create-album';\nimport {Album} from '@app/web-player/albums/album';\nimport {useLocation} from 'react-router-dom';\nimport {getAlbumLink} from '@app/web-player/albums/album-link';\n\ninterface Response extends BackendResponse {\n  album: Album;\n}\n\nexport interface UpdateAlbumPayload extends CreateAlbumPayload {\n  id: number;\n}\n\nconst Endpoint = (id: number) => `albums/${id}`;\n\nexport function useUpdateAlbum(\n  form: UseFormReturn<UpdateAlbumPayload>,\n  albumId: number\n) {\n  const {trans} = useTrans();\n  const navigate = useNavigate();\n  const {pathname} = useLocation();\n  return useMutation(\n    (payload: UpdateAlbumPayload) => updateAlbum(albumId, payload),\n    {\n      onSuccess: response => {\n        toast(trans(message('Album updated')));\n        queryClient.invalidateQueries(DatatableDataQueryKey('albums'));\n        if (pathname.includes('admin')) {\n          navigate('/admin/albums');\n        } else {\n          navigate(getAlbumLink(response.album));\n        }\n      },\n      onError: err => onFormQueryError(err, form),\n    }\n  );\n}\n\nfunction updateAlbum(\n  id: number,\n  payload: UpdateAlbumPayload\n): Promise<Response> {\n  return apiClient\n    .put(Endpoint(id), prepareAlbumPayload(payload))\n    .then(r => r.data);\n}\n","import {Dialog} from '@common/ui/overlays/dialog/dialog';\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\nimport {Trans} from '@common/i18n/trans';\nimport React from 'react';\nimport {useUpdateTrackForm} from '@app/admin/tracks-datatable-page/crupdate/use-update-track-form';\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\nimport {TrackForm} from '@app/admin/tracks-datatable-page/track-form/track-form';\nimport {Form} from '@common/ui/forms/form';\nimport {Button} from '@common/ui/buttons/button';\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\nimport {UpdateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-update-track';\nimport {CreateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-create-track';\n\ninterface Props {\n  track: UpdateTrackPayload | CreateTrackPayload;\n  hideAlbumField?: boolean;\n}\nexport function UpdateTrackDialog({track, hideAlbumField}: Props) {\n  const {formId, close} = useDialogContext();\n  const {form} = useUpdateTrackForm(track);\n  return (\n    <Dialog size=\"fullscreen\">\n      <DialogHeader>\n        <Trans message=\"Edit :name track\" values={{name: track.name}} />\n      </DialogHeader>\n      <DialogBody>\n        <Form\n          id={formId}\n          form={form}\n          onSubmit={values => {\n            close(values);\n          }}\n          onBeforeSubmit={() => {\n            form.clearErrors();\n          }}\n        >\n          <TrackForm showExternalIdFields showAlbumField={!hideAlbumField} />\n        </Form>\n      </DialogBody>\n      <DialogFooter>\n        <Button variant=\"text\" onClick={() => close()}>\n          <Trans message=\"Cancel\" />\n        </Button>\n        <Button form={formId} variant=\"flat\" color=\"primary\" type=\"submit\">\n          <Trans message=\"Update\" />\n        </Button>\n      </DialogFooter>\n    </Dialog>\n  );\n}\n","import {Dialog} from '@common/ui/overlays/dialog/dialog';\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\nimport {Trans} from '@common/i18n/trans';\nimport React from 'react';\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\nimport {TrackForm} from '@app/admin/tracks-datatable-page/track-form/track-form';\nimport {Form} from '@common/ui/forms/form';\nimport {Button} from '@common/ui/buttons/button';\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\nimport {useCreateTrackForm} from '@app/admin/tracks-datatable-page/crupdate/use-create-track-form';\nimport {CreateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-create-track';\n\ninterface Props {\n  defaultValues?: Partial<CreateTrackPayload>;\n  hideAlbumField?: boolean;\n}\nexport function CreateTrackDialog({defaultValues, hideAlbumField}: Props) {\n  const {formId, close} = useDialogContext();\n  const {form} = useCreateTrackForm({defaultValues});\n  return (\n    <Dialog size=\"fullscreen\">\n      <DialogHeader>\n        <Trans message=\"Add new track\" />\n      </DialogHeader>\n      <DialogBody>\n        <Form\n          id={formId}\n          form={form}\n          onSubmit={values => {\n            close(values);\n          }}\n          onBeforeSubmit={() => {\n            form.clearErrors();\n          }}\n        >\n          <TrackForm showExternalIdFields showAlbumField={!hideAlbumField} />\n        </Form>\n      </DialogBody>\n      <DialogFooter>\n        <Button variant=\"text\" onClick={() => close()}>\n          <Trans message=\"Cancel\" />\n        </Button>\n        <Button form={formId} variant=\"flat\" color=\"primary\" type=\"submit\">\n          <Trans message=\"Create\" />\n        </Button>\n      </DialogFooter>\n    </Dialog>\n  );\n}\n","import {useFieldArray, useFormContext} from 'react-hook-form';\nimport {\n  CreateAlbumPayload,\n  CreateAlbumPayloadTrack,\n} from '@app/admin/albums-datatable-page/requests/use-create-album';\nimport React, {useRef} from 'react';\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\nimport {Trans} from '@common/i18n/trans';\nimport {Button} from '@common/ui/buttons/button';\nimport {FileUploadIcon} from '@common/icons/material/FileUpload';\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\nimport {IconButton} from '@common/ui/buttons/icon-button';\nimport {AddIcon} from '@common/icons/material/Add';\nimport {DragHandleIcon} from '@common/icons/material/DragHandle';\nimport {EditIcon} from '@common/icons/material/Edit';\nimport {CloseIcon} from '@common/icons/material/Close';\nimport {ProgressCircle} from '@common/ui/progress/progress-circle';\nimport {TrackUploadStatusText} from '@app/admin/tracks-datatable-page/track-form/track-upload-status-text';\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\nimport {UpdateTrackDialog} from '@app/admin/tracks-datatable-page/track-form/update-track-dialog';\nimport {ConfirmationDialog} from '@common/ui/overlays/dialog/confirmation-dialog';\nimport musicImage from '@app/admin/tracks-datatable-page/music.svg';\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\nimport {CreateTrackDialog} from '@app/admin/tracks-datatable-page/track-form/create-track-dialog';\nimport {useSortable} from '@common/ui/interactions/dnd/use-sortable';\nimport {DragPreviewRenderer} from '@common/ui/interactions/dnd/use-draggable';\nimport {DragPreview} from '@common/ui/interactions/dnd/drag-preview';\nimport {CreateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-create-track';\nimport {\n  hydrateAlbumForm,\n  mergeTrackFormValues,\n} from '@app/admin/tracks-datatable-page/requests/use-extract-track-file-metadata';\nimport {useTrackUploader} from '@app/web-player/backstage/upload-page/use-track-uploader';\nimport {useTrackUpload} from '@app/web-player/backstage/upload-page/use-track-upload';\nimport {UpdateTrackPayload} from '@app/admin/tracks-datatable-page/requests/use-update-track';\n\nexport function AlbumTracksForm() {\n  const form = useFormContext<CreateAlbumPayload>();\n  const {watch, setValue, getValues} = form;\n  const {fields, remove, prepend, move} = useFieldArray({\n    name: 'tracks',\n  });\n\n  const updateTrack = (\n    uploadId: string,\n    newValues: Partial<CreateTrackPayload>\n  ) => {\n    const index = getValues('tracks')?.findIndex(f => f.uploadId === uploadId);\n    if (index != null) {\n      setValue(\n        `tracks.${index}`,\n        mergeTrackFormValues(newValues, getValues(`tracks.${index}`)),\n        {shouldDirty: true}\n      );\n    }\n  };\n\n  const {openFilePicker} = useTrackUploader({\n    onUploadStart: data =>\n      prepend(\n        // newly uploaded track should inherit album artists, genres and tags\n        mergeTrackFormValues(data, {\n          artists: form.getValues('artists'),\n          genres: form.getValues('genres'),\n          tags: form.getValues('tags'),\n        })\n      ),\n    onMetadataChange: (file, newData) => {\n      hydrateAlbumForm(form, newData);\n      updateTrack(file.id, newData);\n    },\n  });\n\n  const tracks = watch('tracks') || [];\n\n  return (\n    <div>\n      <div className=\"flex items-center gap-12\">\n        <h2 className=\"text-xl font-semibold my-24\">\n          <Trans message=\"Tracks\" />\n        </h2>\n        <Button\n          variant=\"outline\"\n          color=\"primary\"\n          size=\"xs\"\n          className=\"ml-auto\"\n          startIcon={<FileUploadIcon />}\n          onClick={() => openFilePicker()}\n        >\n          <Trans message=\"Upload tracks\" />\n        </Button>\n        <DialogTrigger\n          type=\"modal\"\n          onClose={newTrack => {\n            if (newTrack) {\n              prepend(newTrack);\n            }\n          }}\n        >\n          <Tooltip label={<Trans message=\"Create track\" />}>\n            <IconButton\n              variant=\"outline\"\n              color=\"primary\"\n              size=\"xs\"\n              radius=\"rounded\"\n            >\n              <AddIcon />\n            </IconButton>\n          </Tooltip>\n          <CreateTrackDialog\n            hideAlbumField\n            defaultValues={{\n              artists: watch('artists'),\n              tags: watch('tags'),\n              genres: watch('genres'),\n            }}\n          />\n        </DialogTrigger>\n      </div>\n      {fields.map((field, index) => {\n        const track = tracks[index];\n        return (\n          <TrackItem\n            key={field.id}\n            track={track}\n            onRemove={() => remove(index)}\n            onSort={(oldIndex, newIndex) => move(oldIndex, newIndex)}\n            tracks={tracks}\n            onUpdate={newValues => {\n              updateTrack(track.uploadId, newValues);\n            }}\n          />\n        );\n      })}\n\n      {!fields.length ? (\n        <IllustratedMessage\n          className=\"mt-40\"\n          image={<SvgImage src={musicImage} />}\n          title={<Trans message=\"This album does not have any tracks yet\" />}\n        />\n      ) : null}\n    </div>\n  );\n}\n\ninterface TrackItemProps {\n  track: CreateAlbumPayloadTrack;\n  tracks: CreateAlbumPayloadTrack[];\n  onRemove: () => void;\n  onUpdate: (updatedTrack: UpdateTrackPayload | CreateTrackPayload) => void;\n  onSort: (oldIndex: number, newIndex: number) => void;\n}\nfunction TrackItem({\n  track,\n  tracks,\n  onRemove,\n  onUpdate,\n  onSort,\n}: TrackItemProps) {\n  const ref = useRef<HTMLDivElement>(null);\n  const previewRef = useRef<DragPreviewRenderer>(null);\n\n  const abortUpload = useFileUploadStore(s => s.abortUpload);\n  const activeUpload = useFileUploadStore(s => {\n    return track.uploadId ? s.fileUploads.get(track.uploadId) : null;\n  });\n  const {isUploading, status} = useTrackUpload(track.uploadId);\n\n  const {sortableProps} = useSortable({\n    disabled: isUploading,\n    ref,\n    item: track,\n    items: tracks,\n    type: 'albumFormTrack',\n    preview: previewRef,\n    previewVariant: 'line',\n    onSortEnd: (oldIndex, newIndex) => {\n      onSort(oldIndex, newIndex);\n    },\n  });\n\n  return (\n    <div\n      className=\"border-b border-t border-t-transparent py-4\"\n      ref={ref}\n      {...sortableProps}\n    >\n      <div className=\"flex items-center text-sm\">\n        <IconButton className=\"flex-shrink-0 mr-14\" disabled={isUploading}>\n          <DragHandleIcon />\n        </IconButton>\n        <div className=\"flex-auto whitespace-nowrap overflow-hidden overflow-ellipsis\">\n          {track.name}\n        </div>\n        {activeUpload && (\n          <div className=\"flex items-center mr-10\">\n            <TrackUploadStatusText\n              fileUpload={activeUpload}\n              status={status}\n              className=\"mr-10\"\n            />\n            <ProgressCircle\n              isIndeterminate={status === 'processing'}\n              value={activeUpload.percentage}\n              size=\"sm\"\n            />\n          </div>\n        )}\n        <DialogTrigger\n          type=\"modal\"\n          onClose={updatedTrack => {\n            if (updatedTrack) {\n              onUpdate(updatedTrack);\n            }\n          }}\n        >\n          <Tooltip label={<Trans message=\"Edit track\" />}>\n            <IconButton\n              className=\"flex-shrink-0 ml-auto text-muted\"\n              disabled={isUploading}\n            >\n              <EditIcon />\n            </IconButton>\n          </Tooltip>\n          <UpdateTrackDialog track={track} hideAlbumField={true} />\n        </DialogTrigger>\n        <DialogTrigger\n          type=\"modal\"\n          onClose={isConfirmed => {\n            if (isConfirmed) {\n              if (track.uploadId) {\n                abortUpload(track.uploadId);\n              }\n              onRemove();\n            }\n          }}\n        >\n          <Tooltip label={<Trans message=\"Remove track\" />}>\n            <IconButton className=\"flex-shrink-0 text-muted\">\n              <CloseIcon />\n            </IconButton>\n          </Tooltip>\n          <ConfirmationDialog\n            isDanger\n            title={<Trans message=\"Remove track\" />}\n            body={\n              <Trans message=\"Are you sure you want to remove this track from the album?\" />\n            }\n            confirm={<Trans message=\"Remove\" />}\n          />\n        </DialogTrigger>\n      </div>\n      <RowDragPreview track={track} ref={previewRef} />\n    </div>\n  );\n}\n\ninterface DragPreviewProps {\n  track: CreateTrackPayload;\n}\nconst RowDragPreview = React.forwardRef<DragPreviewRenderer, DragPreviewProps>(\n  ({track}, ref) => {\n    let content = track.name;\n    if (track.artists?.length) {\n      content += `- ${track.artists?.[0].name}`;\n    }\n    return (\n      <DragPreview ref={ref}>\n        {() => (\n          <div className=\"p-8 rounded shadow bg-chip text-sm\">{content}</div>\n        )}\n      </DragPreview>\n    );\n  }\n);\n","import React, {Fragment} from 'react';\nimport {FormTextField} from '@common/ui/forms/input-field/text-field/text-field';\nimport {Trans} from '@common/i18n/trans';\nimport {FormImageSelector} from '@common/ui/images/image-selector';\nimport {FormArtistPicker} from '@app/web-player/artists/artist-picker/form-artist-picker';\nimport {FormNormalizedModelChipField} from '@common/tags/form-normalized-model-chip-field';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {message} from '@common/i18n/message';\nimport {TAG_MODEL} from '@common/tags/tag';\nimport {GENRE_MODEL} from '@app/web-player/genres/genre';\nimport {useSettings} from '@common/core/settings/use-settings';\nimport {FormDatePicker} from '@common/ui/forms/input-field/date/date-picker/date-picker';\nimport {AlbumTracksForm} from '@app/admin/albums-datatable-page/album-form/album-tracks-form';\nimport {useIsMobileMediaQuery} from '@common/utils/hooks/is-mobile-media-query';\n\n// AlbumForm will be wrapped in FileUploadProvider by parent component\n\ninterface AlbumFormProps {\n  showExternalIdFields?: boolean;\n}\nexport function AlbumForm({showExternalIdFields}: AlbumFormProps) {\n  const {trans} = useTrans();\n  const isMobile = useIsMobileMediaQuery();\n  return (\n    <Fragment>\n      <div className=\"md:flex gap-24\">\n        <div className=\"flex-shrink-0\">\n          <FormImageSelector\n            name=\"image\"\n            diskPrefix=\"album_images\"\n            label={isMobile ? <Trans message=\"Image\" /> : null}\n            variant={isMobile ? 'input' : 'square'}\n            previewSize={isMobile ? undefined : 'w-full md:w-224 aspect-square'}\n            stretchPreview\n          />\n        </div>\n        <div className=\"flex-auto mt-24 md:mt-0\">\n          <FormTextField\n            name=\"name\"\n            label={<Trans message=\"Name\" />}\n            className=\"mb-24\"\n            required\n            autoFocus\n          />\n          <FormDatePicker\n            name=\"release_date\"\n            label={<Trans message=\"Release date\" />}\n            className=\"mb-24\"\n            granularity=\"day\"\n          />\n          <FormArtistPicker name=\"artists\" className=\"mb-24\" />\n          <FormNormalizedModelChipField\n            label={<Trans message=\"Genres\" />}\n            placeholder={trans(message('+Add genre'))}\n            model={GENRE_MODEL}\n            name=\"genres\"\n            allowCustomValue\n            className=\"mb-24\"\n          />\n          <FormNormalizedModelChipField\n            label={<Trans message=\"Tags\" />}\n            placeholder={trans(message('+Add tag'))}\n            model={TAG_MODEL}\n            name=\"tags\"\n            allowCustomValue\n            className=\"mb-24\"\n          />\n          <FormTextField\n            name=\"description\"\n            label={<Trans message=\"Description\" />}\n            inputElementType=\"textarea\"\n            rows={5}\n            className=\"mb-24\"\n          />\n          {showExternalIdFields && <SpotifyIdField />}\n        </div>\n      </div>\n      <AlbumTracksForm />\n    </Fragment>\n  );\n}\n\nfunction SpotifyIdField() {\n  const {spotify_is_setup} = useSettings();\n  if (!spotify_is_setup) {\n    return null;\n  }\n  return (\n    <FormTextField\n      name=\"spotify_id\"\n      label={<Trans message=\"Spotify ID\" />}\n      className=\"mb-24\"\n      minLength={22}\n      maxLength={22}\n    />\n  );\n}\n","import {useForm} from 'react-hook-form';\nimport React from 'react';\nimport {CrupdateResourceLayout} from '@common/admin/crupdate-resource-layout';\nimport {Trans} from '@common/i18n/trans';\nimport {useAlbum} from '@app/web-player/albums/requests/use-album';\nimport {Album} from '@app/web-player/albums/album';\nimport {\n  UpdateAlbumPayload,\n  useUpdateAlbum,\n} from '@app/admin/albums-datatable-page/requests/use-update-album';\nimport {AlbumForm} from '@app/admin/albums-datatable-page/album-form/album-form';\nimport {PageStatus} from '@common/http/page-status';\nimport {\n  FileUploadProvider,\n  useFileUploadStore,\n} from '@common/uploads/uploader/file-upload-provider';\nimport {Navigate} from 'react-router-dom';\nimport {useAlbumPermissions} from '@app/web-player/albums/use-album-permissions';\n\ninterface Props {\n  wrapInContainer?: boolean;\n}\nexport function UpdateAlbumPage({wrapInContainer}: Props) {\n  const query = useAlbum({\n    forEditing: true,\n    with: 'tags,genres,artists,fullTracks',\n  });\n\n  if (query.data) {\n    return (\n      <FileUploadProvider>\n        <PageContent\n          album={query.data.album}\n          wrapInContainer={wrapInContainer}\n        />\n      </FileUploadProvider>\n    );\n  }\n\n  return <PageStatus query={query} loaderClassName=\"absolute inset-0 m-auto\" />;\n}\n\ninterface PageContentProps {\n  album: Album;\n  wrapInContainer?: boolean;\n}\nfunction PageContent({album, wrapInContainer}: PageContentProps) {\n  const {canEdit} = useAlbumPermissions(album);\n  const uploadIsInProgress = !!useFileUploadStore(s => s.activeUploadsCount);\n  const form = useForm<UpdateAlbumPayload>({\n    defaultValues: {\n      image: album.image,\n      name: album.name,\n      release_date: album.release_date,\n      artists: album.artists,\n      genres: album.genres,\n      tags: album.tags,\n      description: album.description,\n      spotify_id: album.spotify_id,\n      tracks: album.tracks,\n    },\n  });\n  const updateAlbum = useUpdateAlbum(form, album.id);\n\n  if (!canEdit) {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  return (\n    <CrupdateResourceLayout\n      form={form}\n      onSubmit={values => {\n        updateAlbum.mutate(values);\n      }}\n      title={<Trans message=\"Edit :name album\" values={{name: album.name}} />}\n      isLoading={updateAlbum.isLoading || uploadIsInProgress}\n      disableSaveWhenNotDirty\n      wrapInContainer={wrapInContainer}\n    >\n      <AlbumForm showExternalIdFields />\n    </CrupdateResourceLayout>\n  );\n}\n","import {forwardRef, useImperativeHandle, useState} from 'react';\nimport {useForm} from 'react-hook-form';\nimport {\n  CreateAlbumPayload,\n  useCreateAlbum,\n} from '@app/admin/albums-datatable-page/requests/use-create-album';\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\nimport {useTrackUploader} from '@app/web-player/backstage/upload-page/use-track-uploader';\nimport {\n  hydrateAlbumForm,\n  mergeTrackFormValues,\n} from '@app/admin/tracks-datatable-page/requests/use-extract-track-file-metadata';\nimport {Form} from '@common/ui/forms/form';\nimport {AlbumForm} from '@app/admin/albums-datatable-page/album-form/album-form';\nimport {Button} from '@common/ui/buttons/button';\nimport {Trans} from '@common/i18n/trans';\nimport type {\n  UploaderActions,\n  UploaderProps,\n} from '@app/web-player/backstage/upload-page/upload-page';\nimport {usePrimaryArtistForCurrentUser} from '@app/web-player/backstage/use-primary-artist-for-current-user';\nimport {useCurrentDateTime} from '@common/i18n/use-current-date-time';\n\nexport const AlbumUploader = forwardRef<UploaderActions, UploaderProps>(\n  ({onUploadStart, onCancel, onCreate}, ref) => {\n    const userArtist = usePrimaryArtistForCurrentUser();\n    const now = useCurrentDateTime();\n    const [isVisible, setIsVisible] = useState(false);\n    const form = useForm<CreateAlbumPayload>({\n      defaultValues: {\n        tracks: [],\n        artists: userArtist ? [userArtist] : [],\n        release_date: now.toAbsoluteString(),\n      },\n    });\n    const tracks = form.watch('tracks') || [];\n\n    const abortUpload = useFileUploadStore(s => s.abortUpload);\n    const uploadIsInProgress = !!useFileUploadStore(s => s.activeUploadsCount);\n    const {openFilePicker, uploadTracks, validateUploads} = useTrackUploader({\n      onUploadStart: data => {\n        setIsVisible(true);\n        form.setValue('tracks', [...form.getValues('tracks'), data]);\n        onUploadStart();\n      },\n      onMetadataChange: (file, newData) => {\n        hydrateAlbumForm(form, newData);\n        form.setValue(\n          'tracks',\n          form.getValues('tracks').map(track => {\n            return track.uploadId === file.id\n              ? mergeTrackFormValues(newData, track)\n              : track;\n          })\n        );\n      },\n    });\n\n    useImperativeHandle(\n      ref,\n      () => ({\n        openFilePicker,\n        uploadTracks,\n        validateUploads,\n      }),\n      [openFilePicker, uploadTracks, validateUploads]\n    );\n\n    const createAlbum = useCreateAlbum(form);\n    return isVisible ? (\n      <Form\n        className=\"rounded border p-14 md:p-24 mb-30 bg-paper\"\n        form={form}\n        onSubmit={newValues =>\n          createAlbum.mutate(newValues, {\n            onSuccess: response => {\n              setIsVisible(false);\n              form.reset();\n              onCreate(response.album);\n            },\n          })\n        }\n      >\n        <AlbumForm showExternalIdFields={false} />\n        <div className=\"mt-24\">\n          <Button\n            variant=\"text\"\n            onClick={() => {\n              tracks.forEach(track => {\n                abortUpload(track.uploadId);\n              });\n              form.reset();\n              setIsVisible(false);\n              onCancel();\n            }}\n            className=\"mr-10\"\n          >\n            <Trans message=\"Cancel\" />\n          </Button>\n          <Button\n            type=\"submit\"\n            variant=\"flat\"\n            color=\"primary\"\n            disabled={uploadIsInProgress || createAlbum.isLoading}\n          >\n            <Trans message=\"Save\" />\n          </Button>\n        </div>\n      </Form>\n    ) : null;\n  }\n);\n","import {\n  forwardRef,\n  memo,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\nimport {\n  TrackUploadPayload,\n  useTrackUploader,\n} from '@app/web-player/backstage/upload-page/use-track-uploader';\nimport {mergeTrackFormValues} from '@app/admin/tracks-datatable-page/requests/use-extract-track-file-metadata';\nimport {\n  UploaderActions,\n  UploaderProps,\n} from '@app/web-player/backstage/upload-page/upload-page';\nimport {Track} from '@app/web-player/tracks/track';\nimport {useForm} from 'react-hook-form';\nimport {useCreateTrack} from '@app/admin/tracks-datatable-page/requests/use-create-track';\nimport {useTrackUpload} from '@app/web-player/backstage/upload-page/use-track-upload';\nimport {TrackUploadProgress} from '@app/admin/tracks-datatable-page/track-form/track-upload-progress';\nimport {Form} from '@common/ui/forms/form';\nimport {TrackForm} from '@app/admin/tracks-datatable-page/track-form/track-form';\nimport {Button} from '@common/ui/buttons/button';\nimport {Trans} from '@common/i18n/trans';\nimport {usePrimaryArtistForCurrentUser} from '@app/web-player/backstage/use-primary-artist-for-current-user';\n\nexport const TracksUploader = forwardRef<UploaderActions, UploaderProps>(\n  ({onUploadStart, onCancel, onCreate}, ref) => {\n    const userArtist = usePrimaryArtistForCurrentUser();\n    const abortUpload = useFileUploadStore(s => s.abortUpload);\n    const [tracks, setTracks] = useState<TrackUploadPayload[]>([]);\n\n    const {openFilePicker, uploadTracks, validateUploads} = useTrackUploader({\n      onUploadStart: data => {\n        setTracks(prev => {\n          if (userArtist) {\n            return [...prev, {...data, artists: [userArtist]}];\n          }\n          return [...prev, data];\n        });\n        onUploadStart();\n      },\n      onMetadataChange: (file, newData) => {\n        setTracks(allTracks => {\n          return allTracks.map(track => {\n            return track.uploadId === file.id\n              ? mergeTrackFormValues(newData, track)\n              : track;\n          });\n        });\n      },\n    });\n\n    useImperativeHandle(\n      ref,\n      () => ({\n        openFilePicker,\n        uploadTracks,\n        validateUploads,\n      }),\n      [openFilePicker, uploadTracks, validateUploads]\n    );\n\n    return (\n      <div className=\"w-full\">\n        {tracks.map(track => (\n          <TrackUploadItem\n            key={track.uploadId}\n            track={track}\n            onCreate={createdTrack => {\n              // hide upload form for this track\n              setTracks(prev =>\n                prev.filter(t => t.uploadId !== track.uploadId)\n              );\n              onCreate(createdTrack);\n            }}\n            onRemove={() => {\n              setTracks(prev => {\n                const newTracks = prev.filter(\n                  t => t.uploadId !== track.uploadId\n                );\n                // only invoke \"onCancel\" if every uploaded track has been removed, so upload mode can be unlocked\n                if (!newTracks.length) {\n                  onCancel();\n                }\n                return newTracks;\n              });\n              abortUpload(track.uploadId);\n            }}\n          />\n        ))}\n      </div>\n    );\n  }\n);\n\ninterface TrackUploadItemProps {\n  track: TrackUploadPayload;\n  onRemove: () => void;\n  onCreate: (track: Track) => void;\n}\nconst TrackUploadItem = memo(\n  ({track, onRemove, onCreate}: TrackUploadItemProps) => {\n    const form = useForm<TrackUploadPayload>({\n      defaultValues: track,\n    });\n    const createTrack = useCreateTrack(form);\n    const activeUpload = useFileUploadStore(s =>\n      s.fileUploads.get(track.uploadId)\n    );\n    const {isUploading, status} = useTrackUpload(track.uploadId);\n\n    useEffect(() => {\n      form.reset(track);\n    }, [track, form]);\n\n    const uploadProgress =\n      isUploading && activeUpload ? (\n        <TrackUploadProgress fileUpload={activeUpload} status={status} />\n      ) : null;\n\n    return (\n      <Form\n        form={form}\n        onSubmit={values => {\n          createTrack.mutate(values, {\n            onSuccess: response => onCreate(response.track),\n          });\n        }}\n        className=\"rounded border p-14 md:p-24 mb-30 bg-paper\"\n      >\n        <TrackForm uploadButton={uploadProgress} showExternalIdFields={false} />\n        <Button variant=\"text\" onClick={() => onRemove()} className=\"mr-10\">\n          <Trans message=\"Cancel\" />\n        </Button>\n        <Button\n          type=\"submit\"\n          variant=\"flat\"\n          color=\"primary\"\n          disabled={createTrack.isLoading || !form.watch('src')}\n        >\n          <Trans message=\"Save\" />\n        </Button>\n      </Form>\n    );\n  }\n);\n","export default \"__VITE_ASSET__19ef062e__\"","import {Track} from '@app/web-player/tracks/track';\nimport {Album, ALBUM_MODEL} from '@app/web-player/albums/album';\nimport {TrackImage} from '@app/web-player/tracks/track-image/track-image';\nimport {AlbumImage} from '@app/web-player/albums/album-image/album-image';\nimport {ArtistLinks} from '@app/web-player/artists/artist-links';\nimport {ChipList} from '@common/ui/forms/input-field/chip-field/chip-list';\nimport {Chip} from '@common/ui/forms/input-field/chip-field/chip';\nimport {Trans} from '@common/i18n/trans';\nimport {Link} from 'react-router-dom';\nimport {getTrackLink} from '@app/web-player/tracks/track-link';\nimport {getAlbumLink} from '@app/web-player/albums/album-link';\nimport {LinkStyle} from '@common/ui/buttons/external-link';\nimport {TextField} from '@common/ui/forms/input-field/text-field/text-field';\nimport clsx from 'clsx';\nimport albumBorderImage from './album-border.png';\nimport {ShareMediaButtons} from '@app/web-player/sharing/share-media-buttons';\n\ninterface UploadedMediaPreviewProps {\n  media: Track | Album;\n}\nexport function UploadedMediaPreview({media}: UploadedMediaPreviewProps) {\n  const isAlbum = media.model_type === ALBUM_MODEL;\n  const absoluteLink = isAlbum\n    ? getAlbumLink(media, {absolute: true})\n    : getTrackLink(media, {absolute: true});\n\n  return (\n    <div className=\"flex items-center gap-28 border rounded bg-paper p-20 my-20 mx-auto w-780 max-w-full\">\n      <div className={clsx(isAlbum && 'relative isolate my-14 mx-18')}>\n        {isAlbum ? (\n          <AlbumImage\n            album={media}\n            className=\"rounded flex-shrink-0 z-20 relative\"\n            size=\"w-132 h-132\"\n          />\n        ) : (\n          <TrackImage\n            track={media}\n            className=\"rounded flex-shrink-0 z-20 relative\"\n            size=\"w-132 h-132\"\n          />\n        )}\n        {isAlbum && (\n          <img\n            className=\"absolute block w-160 h-160 max-w-160 -top-14 -left-14 z-10\"\n            src={albumBorderImage}\n            alt=\"\"\n          />\n        )}\n      </div>\n      <div className=\"flex-auto\">\n        <div className=\"text-base font-bold\">{media.name}</div>\n        <div className=\"text-muted text-sm mb-14\">\n          <ArtistLinks artists={media.artists} />\n        </div>\n        {media.genres?.length ? (\n          <ChipList selectable={false} size=\"sm\" className=\"mb-14\">\n            {media.genres?.map(genre => {\n              return (\n                <Chip key={genre.id}>{genre.display_name || genre.name}</Chip>\n              );\n            })}\n          </ChipList>\n        ) : null}\n        <div className=\"text-sm\">\n          <Trans\n            message=\"Upload complete. <a>Go to your track</a>\"\n            values={{\n              a: parts => (\n                <Link\n                  className={LinkStyle}\n                  to={isAlbum ? getAlbumLink(media) : getTrackLink(media)}\n                >\n                  {parts}\n                </Link>\n              ),\n            }}\n          />\n        </div>\n      </div>\n      <div className=\"ml-auto flex-auto max-w-300\">\n        <div className=\"text-muted text-sm\">\n          <Trans message=\"Share your new track\" />\n          <ShareMediaButtons\n            name={media.name}\n            image={media.image}\n            link={absoluteLink}\n          />\n          <TextField\n            value={absoluteLink}\n            readOnly\n            className=\"mt-24 w-full\"\n            size=\"sm\"\n            onClick={e => {\n              (e.target as HTMLInputElement).select();\n            }}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n","import {opacityAnimation} from '@common/ui/animation/opacity-animation';\nimport {AnimatePresence, m} from 'framer-motion';\nimport {Trans} from '@common/i18n/trans';\n\ninterface DropTargetMaskProps {\n  isVisible: boolean;\n}\nexport function DropTargetMask({isVisible}: DropTargetMaskProps) {\n  const mask = (\n    <m.div\n      key=\"dragTargetMask\"\n      {...opacityAnimation}\n      transition={{duration: 0.3}}\n      className=\"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none\"\n    >\n      <m.div\n        initial={{y: '100%', opacity: 0}}\n        animate={{y: '-10px', opacity: 1}}\n        exit={{y: '100%', opacity: 0}}\n        className=\"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded\"\n      >\n        <Trans message=\"Drop your files anywhere on the page to upload\" />\n      </m.div>\n    </m.div>\n  );\n  return <AnimatePresence>{isVisible ? mask : null}</AnimatePresence>;\n}\n","import {useQuery} from '@tanstack/react-query';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {useAuth} from '@common/auth/use-auth';\nimport {getBootstrapData} from '@common/core/bootstrap-data/use-backend-bootstrap-data';\n\ninterface Response extends BackendResponse {\n  minutesLeft: number | null;\n}\n\nexport function resetMinutesLimitQuery() {\n  const {user} = getBootstrapData();\n  if (user?.id) {\n    queryClient.resetQueries(['minutesLimit', user.id]);\n  }\n}\n\nexport function useUserMinutesLimit() {\n  const {user} = useAuth();\n  const userId = user?.id!;\n  return useQuery(['minutesLimit', userId], () => fetchLimit(userId), {\n    enabled: userId != null,\n  });\n}\n\nfunction fetchLimit(userId: number): Promise<Response> {\n  return apiClient\n    .get(`users/${userId}/minutes-left`)\n    .then(response => response.data);\n}\n","export default \"__VITE_ASSET__5b7b3136__\"","export default \"__VITE_ASSET__430d5aeb__\"","import {Navbar} from '@common/ui/navigation/navbar/navbar';\nimport {Footer} from '@common/ui/footer/footer';\nimport lightBgImage from './images/light-bg.svg';\nimport darkBgImage from './images/dark-bg.svg';\nimport {useIsDarkMode} from '@common/ui/themes/use-is-dark-mode';\nimport {ComponentPropsWithoutRef, ReactNode} from 'react';\n\ninterface Props extends ComponentPropsWithoutRef<'div'> {\n  children: ReactNode;\n}\nexport function BackstageLayout({children, ...domProps}: Props) {\n  const isDarkMode = useIsDarkMode();\n  return (\n    <div className=\"h-full flex flex-col\" {...domProps}>\n      <Navbar className=\"flex-shrink-0\" color=\"bg\" darkModeColor=\"bg\" />\n      <div\n        className=\"overflow-y-auto flex-auto bg-cover relative\"\n        style={{\n          backgroundImage: `url(${isDarkMode ? darkBgImage : lightBgImage})`,\n        }}\n      >\n        <div className=\"container mx-auto p-14 md:p-24 min-h-full flex flex-col\">\n          <div className=\"flex-auto\">{children}</div>\n          <Footer />\n        </div>\n      </div>\n    </div>\n  );\n}\n","import {Trans} from '@common/i18n/trans';\nimport {Button} from '@common/ui/buttons/button';\nimport {Switch} from '@common/ui/forms/toggle/switch';\nimport {ComponentPropsWithoutRef, ReactNode, useRef, useState} from 'react';\nimport {FileUploadProvider} from '@common/uploads/uploader/file-upload-provider';\nimport {Link} from 'react-router-dom';\nimport {LinkStyle} from '@common/ui/buttons/external-link';\nimport {Track} from '@app/web-player/tracks/track';\nimport {Album} from '@app/web-player/albums/album';\nimport {AlbumUploader} from '@app/web-player/backstage/upload-page/album-uploader';\nimport {TracksUploader} from '@app/web-player/backstage/upload-page/tracks-uploader';\nimport {UploadedMediaPreview} from '@app/web-player/backstage/upload-page/uploaded-media-preview';\nimport {\n  NativeFileDraggable,\n  useDroppable,\n} from '@common/ui/interactions/dnd/use-droppable';\nimport {DropTargetMask} from '@app/web-player/backstage/upload-page/drop-tarket-mask';\nimport {useTrackUploader} from '@app/web-player/backstage/upload-page/use-track-uploader';\nimport {\n  resetMinutesLimitQuery,\n  useUserMinutesLimit,\n} from '@app/web-player/backstage/upload-page/use-user-minutes-limit';\nimport {BackstageLayout} from '@app/web-player/backstage/backstage-layout';\n\ntype UploadMode = 'album' | 'tracks';\n\nexport interface UploaderProps {\n  onUploadStart: () => void;\n  onCancel: () => void;\n  onCreate: (item: Track | Album) => void;\n}\n\nexport type UploaderActions = ReturnType<typeof useTrackUploader>;\n\ninterface Props {\n  backstageLayout?: boolean;\n}\nexport function UploadPage({backstageLayout = true}: Props) {\n  return (\n    <FileUploadProvider>\n      <Content backstageLayout={backstageLayout} />\n    </FileUploadProvider>\n  );\n}\n\nfunction Content({backstageLayout}: Props) {\n  const [uploadMode, setUploadMode] = useState<UploadMode>('tracks');\n  const [modeIsLocked, setModeIsLocked] = useState(false);\n\n  const uploaderRef = useRef<UploaderActions>(null);\n  const Uploader = uploadMode === 'tracks' ? TracksUploader : AlbumUploader;\n\n  const [createdItems, setCreatedItems] = useState<(Album | Track)[]>([]);\n\n  const ref = useRef<HTMLDivElement>(null);\n  const [isDragOver, setIsDragOver] = useState(false);\n  const {droppableProps} = useDroppable({\n    id: 'uploadPageRoot',\n    ref,\n    types: ['nativeFile'],\n    onDragEnter: () => setIsDragOver(true),\n    onDragLeave: () => setIsDragOver(false),\n    onDrop: async draggable => {\n      if (draggable.type === 'nativeFile') {\n        const files = await (draggable as NativeFileDraggable).getData();\n        const validFiles = uploaderRef.current?.validateUploads(files);\n        if (validFiles?.length) {\n          uploaderRef.current?.uploadTracks(validFiles);\n        }\n      }\n    },\n  });\n\n  const Wrapper = backstageLayout ? BackstageLayout : DefaultWrapper;\n\n  return (\n    <Wrapper {...droppableProps}>\n      {!modeIsLocked && (\n        <UploadPanel\n          onUpload={() => uploaderRef.current?.openFilePicker()}\n          uploadMode={uploadMode}\n          onUploadModeChange={setUploadMode}\n        />\n      )}\n      {createdItems.map(item => (\n        <UploadedMediaPreview key={item.id} media={item} />\n      ))}\n      <Uploader\n        ref={uploaderRef}\n        onUploadStart={() => setModeIsLocked(true)}\n        onCreate={item => {\n          setCreatedItems(prev => [...prev, item]);\n          resetMinutesLimitQuery();\n        }}\n        onCancel={() => {\n          setModeIsLocked(false);\n        }}\n      />\n      <DropTargetMask isVisible={isDragOver} />\n    </Wrapper>\n  );\n}\n\ninterface UploadPanelProps {\n  onUpload: () => void;\n  uploadMode: UploadMode;\n  onUploadModeChange: (newMode: UploadMode) => void;\n}\nfunction UploadPanel({\n  onUpload,\n  uploadMode,\n  onUploadModeChange,\n}: UploadPanelProps) {\n  const {data} = useUserMinutesLimit();\n  return (\n    <div className=\"pt-40\">\n      <div className=\"border rounded p-20 md:p-48 flex flex-col items-center max-w-580 mx-auto bg-paper\">\n        <h1 className=\"text-base md:text-[22px] md:font-light\">\n          <Trans message=\"Drag and drop your tracks, videos & albums here.\" />\n        </h1>\n        <Button\n          variant=\"flat\"\n          color=\"primary\"\n          className=\"mt-20 w-min\"\n          onClick={() => onUpload()}\n        >\n          <Trans message=\"Or choose files to upload\" />\n        </Button>\n        <div className=\"border-t pt-20 mt-20\">\n          <Switch\n            checked={uploadMode === 'album'}\n            onChange={e =>\n              onUploadModeChange(e.target.checked ? 'album' : 'tracks')\n            }\n          >\n            <Trans message=\"Make an album when multiple files are selected\" />\n          </Switch>\n        </div>\n      </div>\n      <div className=\"text-muted mt-20 text-sm text-center min-h-20\">\n        {data?.minutesLeft != null && (\n          <Trans\n            message=\"You have :count minutes left. Try <a>Pro accounts</a> to get more time and access to advanced features.\"\n            values={{\n              count: data.minutesLeft,\n              a: parts => (\n                <Link className={LinkStyle} to=\"/pricing\">\n                  {parts}\n                </Link>\n              ),\n            }}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\ninterface DefaultWrapperProps extends ComponentPropsWithoutRef<'div'> {\n  children: ReactNode;\n}\nfunction DefaultWrapper({children, ...domProps}: DefaultWrapperProps) {\n  return (\n    <div {...domProps} className=\"min-h-full relative\">\n      <div className=\"container mx-auto p-14 md:p-24\">{children}</div>\n    </div>\n  );\n}\n","import {useForm} from 'react-hook-form';\nimport React, {useEffect} from 'react';\nimport {CrupdateResourceLayout} from '@common/admin/crupdate-resource-layout';\nimport {Trans} from '@common/i18n/trans';\nimport {AlbumForm} from '@app/admin/albums-datatable-page/album-form/album-form';\nimport {\n  CreateAlbumPayload,\n  useCreateAlbum,\n} from '@app/admin/albums-datatable-page/requests/use-create-album';\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\nimport {useLocation, useSearchParams} from 'react-router-dom';\nimport {useNormalizedModel} from '@common/users/queries/use-normalized-model';\nimport {ARTIST_MODEL} from '@app/web-player/artists/artist';\nimport {useCurrentDateTime} from '@common/i18n/use-current-date-time';\nimport {getAlbumLink} from '@app/web-player/albums/album-link';\nimport {\n  FileUploadProvider,\n  useFileUploadStore,\n} from '@common/uploads/uploader/file-upload-provider';\n\ninterface Props {\n  wrapInContainer?: boolean;\n}\nexport function CreateAlbumPage({wrapInContainer}: Props) {\n  return (\n    <FileUploadProvider>\n      <PageContent wrapInContainer={wrapInContainer} />\n    </FileUploadProvider>\n  );\n}\n\nfunction PageContent({wrapInContainer}: Props) {\n  const uploadIsInProgress = !!useFileUploadStore(s => s.activeUploadsCount);\n  const now = useCurrentDateTime();\n  const navigate = useNavigate();\n  const {pathname} = useLocation();\n  const [searchParams] = useSearchParams();\n  const {data} = useNormalizedModel(ARTIST_MODEL, searchParams.get('artistId'));\n  const artist = data?.model;\n  const form = useForm<CreateAlbumPayload>({\n    defaultValues: {\n      release_date: now.toAbsoluteString(),\n    },\n  });\n  const createAlbum = useCreateAlbum(form);\n\n  useEffect(() => {\n    if (artist) {\n      form.reset({\n        artists: [artist],\n      });\n    }\n  }, [artist, form]);\n\n  return (\n    <CrupdateResourceLayout\n      form={form}\n      onSubmit={values => {\n        createAlbum.mutate(values, {\n          onSuccess: response => {\n            if (pathname.includes('admin')) {\n              if (artist) {\n                navigate(`/admin/artists/${artist.id}/edit`);\n              } else {\n                navigate('/admin/albums');\n              }\n            } else {\n              navigate(getAlbumLink(response.album));\n            }\n          },\n        });\n      }}\n      title={<Trans message=\"Add new album\" />}\n      isLoading={createAlbum.isLoading || uploadIsInProgress}\n      disableSaveWhenNotDirty\n      wrapInContainer={wrapInContainer}\n    >\n      <AlbumForm showExternalIdFields />\n    </CrupdateResourceLayout>\n  );\n}\n","import {useQuery} from '@tanstack/react-query';\nimport {apiClient} from '@common/http/query-client';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {useParams} from 'react-router-dom';\nimport {BackstageRequest} from '@app/web-player/backstage/backstage-request';\n\ninterface Response extends BackendResponse {\n  request: BackstageRequest;\n}\n\nexport function useBackstageRequest() {\n  const {requestId} = useParams();\n  return useQuery(['backstage-request', +requestId!], () =>\n    fetchBackstageRequest(requestId!)\n  );\n}\n\nfunction fetchBackstageRequest(trackId: number | string) {\n  return apiClient\n    .get<Response>(`backstage-request/${trackId}`)\n    .then(response => response.data);\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const DocumentScannerIcon = createSvgIcon(\n  <path d=\"M7 3H4v3H2V1h5v2zm15 3V1h-5v2h3v3h2zM7 21H4v-3H2v5h5v-2zm13-3v3h-3v2h5v-5h-2zM17 6H7v12h10V6zm2 12c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v12zM15 8H9v2h6V8zm0 3H9v2h6v-2zm0 3H9v2h6v-2z\" />\n, 'DocumentScannerOutlined');\n","import {useFormContext} from 'react-hook-form';\nimport React from 'react';\nimport {Trans} from '@common/i18n/trans';\nimport {Button} from '@common/ui/buttons/button';\nimport {IconButton} from '@common/ui/buttons/icon-button';\nimport {AddIcon} from '@common/icons/material/Add';\nimport {EditIcon} from '@common/icons/material/Edit';\nimport musicImage from '@app/admin/tracks-datatable-page/music.svg';\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\nimport {Link} from 'react-router-dom';\nimport {ColumnConfig} from '@common/datatable/column-config';\nimport {Album} from '@app/web-player/albums/album';\nimport {AlbumImage} from '@app/web-player/albums/album-image/album-image';\nimport {AlbumLink} from '@app/web-player/albums/album-link';\nimport {FormattedDate} from '@common/i18n/formatted-date';\nimport {FormattedNumber} from '@common/i18n/formatted-number';\nimport {Table} from '@common/ui/tables/table';\nimport {useSortableTableData} from '@common/ui/tables/use-sortable-table-data';\nimport {UpdateArtistPayload} from '@app/admin/artist-datatable-page/requests/use-update-artist';\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\nimport {ConfirmationDialog} from '@common/ui/overlays/dialog/confirmation-dialog';\nimport {CloseIcon} from '@common/icons/material/Close';\nimport {useDeleteAlbum} from '@app/web-player/albums/requests/use-delete-album';\nimport {InfoDialogTriggerIcon} from '@common/ui/overlays/dialog/info-dialog-trigger/info-dialog-trigger-icon';\n\nconst Columns: ColumnConfig<Album>[] = [\n  {\n    key: 'name',\n    allowsSorting: true,\n    header: () => <Trans message=\"Name\" />,\n    visibleInMode: 'all',\n    width: 'flex-3',\n    body: album => (\n      <div className=\"flex items-center gap-12\">\n        <AlbumImage\n          album={album}\n          className=\"flex-shrink-0\"\n          size=\"w-34 h-34 rounded\"\n        />\n        <AlbumLink album={album} target=\"_blank\" />\n      </div>\n    ),\n  },\n  {\n    key: 'release_date',\n    allowsSorting: true,\n    header: () => <Trans message=\"Release date\" />,\n    body: album =>\n      album.release_date ? <FormattedDate date={album.release_date} /> : null,\n  },\n  {\n    key: 'track_count',\n    allowsSorting: false,\n    header: () => <Trans message=\"Track count\" />,\n    body: album =>\n      album.tracks_count ? (\n        <FormattedNumber value={album.tracks_count} />\n      ) : null,\n  },\n  {\n    key: 'plays',\n    allowsSorting: true,\n    header: () => <Trans message=\"Plays\" />,\n    body: album =>\n      album.plays ? <FormattedNumber value={album.plays} /> : null,\n  },\n  {\n    key: 'actions',\n    header: () => <Trans message=\"Actions\" />,\n    width: 'w-84 flex-shrink-0',\n    visibleInMode: 'all',\n    hideHeader: true,\n    align: 'end',\n    body: album => <RowActions album={album} />,\n  },\n];\n\ninterface Props {\n  albums?: Album[];\n}\nexport function ArtistAlbumsTable({albums = []}: Props) {\n  const {watch} = useFormContext<UpdateArtistPayload>();\n  const artistId = watch('id');\n  const {data, sortDescriptor, onSortChange} = useSortableTableData(albums);\n  return (\n    <div>\n      <div className=\"my-24\">\n        <div className=\"flex items-center gap-12\">\n          <h2 className=\"text-xl font-semibold\">\n            <Trans message=\"Albums\" />\n          </h2>\n          <Button\n            variant=\"outline\"\n            color=\"primary\"\n            size=\"xs\"\n            className=\"ml-auto\"\n            startIcon={<AddIcon />}\n            elementType={artistId ? Link : undefined}\n            to={`/admin/albums/new?artistId=${artistId}`}\n            disabled={!artistId}\n          >\n            <Trans message=\"Add album\" />\n          </Button>\n        </div>\n\n        {!artistId && (\n          <div className=\"flex items-center gap-6 text-sm\">\n            <InfoDialogTriggerIcon\n              viewBox=\"0 0 16 16\"\n              size=\"xs\"\n              className=\"text-muted\"\n            />\n            <Trans message=\"Save changes to enable album creation.\" />\n          </div>\n        )}\n      </div>\n\n      <Table\n        columns={Columns}\n        data={albums}\n        sortDescriptor={sortDescriptor}\n        onSortChange={onSortChange}\n        enableSelection={false}\n      />\n\n      {!data.length ? (\n        <IllustratedMessage\n          className=\"mt-40\"\n          image={<SvgImage src={musicImage} />}\n          title={<Trans message=\"This artist does not have any albums yet\" />}\n        />\n      ) : null}\n    </div>\n  );\n}\n\ninterface RowActionsProps {\n  album: Album;\n}\nfunction RowActions({album}: RowActionsProps) {\n  const deleteAlbum = useDeleteAlbum();\n  return (\n    <div className=\"text-muted\">\n      <Link to={`../../../albums/${album.id}/edit`} relative=\"path\">\n        <IconButton size=\"md\">\n          <EditIcon />\n        </IconButton>\n      </Link>\n      <DialogTrigger\n        type=\"modal\"\n        onClose={isConfirmed => {\n          if (isConfirmed) {\n            deleteAlbum.mutate({albumId: album.id});\n          }\n        }}\n      >\n        <IconButton size=\"md\" disabled={deleteAlbum.isLoading}>\n          <CloseIcon />\n        </IconButton>\n        <ConfirmationDialog\n          isDanger\n          title={<Trans message=\"Delete album\" />}\n          body={<Trans message=\"Are you sure you want to delete this album?\" />}\n          confirm={<Trans message=\"Delete\" />}\n        />\n      </DialogTrigger>\n    </div>\n  );\n}\n","import React, {Fragment} from 'react';\nimport {FormTextField} from '@common/ui/forms/input-field/text-field/text-field';\nimport {Trans} from '@common/i18n/trans';\nimport {FormImageSelector} from '@common/ui/images/image-selector';\nimport {FileUploadProvider} from '@common/uploads/uploader/file-upload-provider';\nimport {FormNormalizedModelChipField} from '@common/tags/form-normalized-model-chip-field';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {message} from '@common/i18n/message';\nimport {GENRE_MODEL} from '@app/web-player/genres/genre';\nimport {useSettings} from '@common/core/settings/use-settings';\nimport {useIsMobileMediaQuery} from '@common/utils/hooks/is-mobile-media-query';\nimport {FormSwitch} from '@common/ui/forms/toggle/switch';\nimport {ArtistAlbumsTable} from '@app/admin/artist-datatable-page/artist-form/artist-albums-table';\nimport {Album} from '@app/web-player/albums/album';\nimport {TabList} from '@common/ui/tabs/tab-list';\nimport {Tab} from '@common/ui/tabs/tab';\nimport {TabPanel, TabPanels} from '@common/ui/tabs/tab-panels';\nimport {Tabs} from '@common/ui/tabs/tabs';\nimport {useFieldArray} from 'react-hook-form';\nimport {Button} from '@common/ui/buttons/button';\nimport {AddIcon} from '@common/icons/material/Add';\nimport {CreateArtistPayload} from '@app/admin/artist-datatable-page/requests/use-create-artist';\nimport {ProfileLinksForm} from '@app/admin/artist-datatable-page/artist-form/profile-links-form';\n\ninterface Props {\n  albums?: Album[];\n  showExternalFields?: boolean;\n}\nexport function CrupdateArtistForm({albums, showExternalFields}: Props) {\n  const isMobile = useIsMobileMediaQuery();\n  return (\n    <FileUploadProvider>\n      <div className=\"md:flex gap-24\">\n        <div className=\"flex-shrink-0\">\n          <FormImageSelector\n            name=\"image_small\"\n            diskPrefix=\"artist_images\"\n            label={isMobile ? <Trans message=\"Image\" /> : null}\n            variant={isMobile ? 'input' : 'square'}\n            previewSize={isMobile ? undefined : 'w-full md:w-224 aspect-square'}\n            stretchPreview\n          />\n          {showExternalFields && (\n            <FormSwitch name=\"verified\" className=\"mt-14\">\n              <Trans message=\"Verified\" />\n            </FormSwitch>\n          )}\n        </div>\n        <div className=\"flex-auto mt-24 md:mt-0\">\n          <Tabs isLazy>\n            <TabList>\n              <Tab>\n                <Trans message=\"Details\" />\n              </Tab>\n              <Tab>\n                <Trans message=\"Links\" />\n              </Tab>\n              <Tab>\n                <Trans message=\"Biography\" />\n              </Tab>\n              <Tab>\n                <Trans message=\"Images\" />\n              </Tab>\n            </TabList>\n            <TabPanels className=\"pt-20\">\n              <TabPanel>\n                <DetailsPanel showExternalFields={showExternalFields} />\n              </TabPanel>\n              <TabPanel>\n                <ProfileLinksForm />\n              </TabPanel>\n              <TabPanel>\n                <BiographyPanel />\n              </TabPanel>\n              <TabPanel>\n                <ImagesPanel />\n              </TabPanel>\n            </TabPanels>\n          </Tabs>\n        </div>\n      </div>\n      <ArtistAlbumsTable albums={albums} />\n    </FileUploadProvider>\n  );\n}\n\ninterface DetailsPanelProps {\n  showExternalFields?: boolean;\n}\nfunction DetailsPanel({showExternalFields}: DetailsPanelProps) {\n  const {trans} = useTrans();\n  return (\n    <Fragment>\n      <FormTextField\n        name=\"name\"\n        label={<Trans message=\"Name\" />}\n        className=\"mb-24\"\n        required\n        autoFocus\n        disabled={!showExternalFields}\n      />\n      <FormNormalizedModelChipField\n        label={<Trans message=\"Genres\" />}\n        placeholder={trans(message('+Add genre'))}\n        model={GENRE_MODEL}\n        name=\"genres\"\n        allowCustomValue\n        className=\"mb-24\"\n      />\n      {showExternalFields && <SpotifyIdField />}\n    </Fragment>\n  );\n}\n\nfunction BiographyPanel() {\n  return (\n    <Fragment>\n      <FormTextField\n        name=\"profile.country\"\n        label={<Trans message=\"Country\" />}\n        className=\"mb-24\"\n      />\n      <FormTextField\n        name=\"profile.city\"\n        label={<Trans message=\"City\" />}\n        className=\"mb-24\"\n      />\n      <FormTextField\n        inputElementType=\"textarea\"\n        rows={5}\n        name=\"profile.description\"\n        label={<Trans message=\"Description\" />}\n        className=\"mb-24\"\n      />\n    </Fragment>\n  );\n}\n\nfunction ImagesPanel() {\n  const {fields, append, remove} = useFieldArray<CreateArtistPayload>({\n    name: 'profile_images',\n  });\n\n  return (\n    <div>\n      <div className=\"flex gap-12 flex-wrap mb-24\">\n        {fields.map((field, index) => {\n          return (\n            <FormImageSelector\n              key={field.id}\n              name={`profile_images.${index}.url`}\n              diskPrefix=\"artist_images\"\n              variant=\"square\"\n              previewSize=\"w-160 h-160\"\n              stretchPreview\n              showRemoveButton\n              onChange={value => {\n                if (!value) {\n                  remove(index);\n                }\n              }}\n            />\n          );\n        })}\n      </div>\n      <Button\n        variant=\"outline\"\n        color=\"primary\"\n        startIcon={<AddIcon />}\n        onClick={() => {\n          append({url: ''});\n        }}\n      >\n        <Trans message=\"Add another image\" />\n      </Button>\n    </div>\n  );\n}\n\nfunction SpotifyIdField() {\n  const {spotify_is_setup} = useSettings();\n  if (!spotify_is_setup) {\n    return null;\n  }\n  return (\n    <FormTextField\n      name=\"spotify_id\"\n      label={<Trans message=\"Spotify ID\" />}\n      className=\"mb-24\"\n      minLength={22}\n      maxLength={22}\n    />\n  );\n}\n","import {useMutation} from '@tanstack/react-query';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\nimport {toast} from '@common/ui/toast/toast';\nimport {message} from '@common/i18n/message';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {DatatableDataQueryKey} from '@common/datatable/requests/paginated-resources';\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {UseFormReturn} from 'react-hook-form';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {Artist} from '@app/web-player/artists/artist';\nimport {CreateArtistPayload} from '@app/admin/artist-datatable-page/requests/use-create-artist';\nimport {useLocation} from 'react-router-dom';\nimport {getArtistLink} from '@app/web-player/artists/artist-link';\n\ninterface Response extends BackendResponse {\n  artist: Artist;\n}\n\nexport interface UpdateArtistPayload extends CreateArtistPayload {\n  id: number;\n}\n\nconst Endpoint = (id: number) => `artists/${id}`;\n\nexport function useUpdateArtist(form: UseFormReturn<UpdateArtistPayload>) {\n  const {trans} = useTrans();\n  const navigate = useNavigate();\n  const {pathname} = useLocation();\n  return useMutation((payload: UpdateArtistPayload) => updateAlbum(payload), {\n    onSuccess: response => {\n      toast(trans(message('Artist updated')));\n      queryClient.invalidateQueries(DatatableDataQueryKey('artists'));\n      if (pathname.includes('admin')) {\n        navigate('/admin/artists');\n      } else {\n        navigate(getArtistLink(response.artist));\n      }\n    },\n    onError: err => onFormQueryError(err, form),\n  });\n}\n\nfunction updateAlbum({id, ...payload}: UpdateArtistPayload): Promise<Response> {\n  return apiClient.put(Endpoint(id), payload).then(r => r.data);\n}\n","import {useForm} from 'react-hook-form';\nimport React from 'react';\nimport {CrupdateResourceLayout} from '@common/admin/crupdate-resource-layout';\nimport {Trans} from '@common/i18n/trans';\nimport {PageStatus} from '@common/http/page-status';\nimport {\n  useArtist,\n  UseArtistResponse,\n} from '@app/web-player/artists/requests/use-artist';\nimport {\n  UpdateArtistPayload,\n  useUpdateArtist,\n} from '@app/admin/artist-datatable-page/requests/use-update-artist';\nimport {CrupdateArtistForm} from '@app/admin/artist-datatable-page/artist-form/crupdate-artist-form';\nimport {useArtistPermissions} from '@app/web-player/artists/use-artist-permissions';\nimport {Navigate} from 'react-router-dom';\n\ninterface Props {\n  wrapInContainer?: boolean;\n  showExternalFields?: boolean;\n}\nexport function UpdateArtistPage({wrapInContainer, showExternalFields}: Props) {\n  const query = useArtist({\n    forEditing: true,\n    with: 'albums,genres,profile',\n    albumsPerPage: 50,\n  });\n\n  if (query.data) {\n    return (\n      <PageContent\n        response={query.data}\n        wrapInContainer={wrapInContainer}\n        showExternalFields={showExternalFields}\n      />\n    );\n  }\n\n  return <PageStatus query={query} loaderClassName=\"absolute inset-0 m-auto\" />;\n}\n\ninterface PageContentProps {\n  response: UseArtistResponse;\n  wrapInContainer?: boolean;\n  showExternalFields?: boolean;\n}\nfunction PageContent({\n  response,\n  wrapInContainer,\n  showExternalFields,\n}: PageContentProps) {\n  const {canEdit} = useArtistPermissions(response.artist);\n  const form = useForm<UpdateArtistPayload>({\n    defaultValues: {\n      id: response.artist.id,\n      name: response.artist.name,\n      verified: response.artist.verified,\n      spotify_id: response.artist.spotify_id,\n      genres: response.artist.genres,\n      image_small: response.artist.image_small,\n      links: response.artist.links,\n      profile: response.artist.profile,\n      profile_images: response.artist.profile_images,\n    },\n  });\n  const updateArtist = useUpdateArtist(form);\n\n  if (!canEdit) {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  return (\n    <CrupdateResourceLayout\n      form={form}\n      onSubmit={values => {\n        updateArtist.mutate(values);\n      }}\n      title={\n        <Trans\n          message=\"Edit :name artist\"\n          values={{name: response.artist.name}}\n        />\n      }\n      isLoading={updateArtist.isLoading}\n      disableSaveWhenNotDirty\n      wrapInContainer={wrapInContainer}\n    >\n      <CrupdateArtistForm\n        albums={response.albums?.data}\n        showExternalFields={showExternalFields}\n      />\n    </CrupdateResourceLayout>\n  );\n}\n","import {useDateRangePickerState} from '@common/ui/forms/input-field/date/date-range-picker/use-date-range-picker-state';\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\nimport {Button} from '@common/ui/buttons/button';\nimport {DateRangeIcon} from '@common/icons/material/DateRange';\nimport {FormattedDateTimeRange} from '@common/i18n/formatted-date-time-range';\nimport {DateRangeDialog} from '@common/ui/forms/input-field/date/date-range-picker/dialog/date-range-dialog';\nimport React from 'react';\nimport {DateRangeValue} from '@common/ui/forms/input-field/date/date-range-picker/date-range-value';\nimport {useIsMobileMediaQuery} from '@common/utils/hooks/is-mobile-media-query';\nimport {DateFormatPresets} from '@common/i18n/formatted-date';\n\nconst monthDayFormat: Intl.DateTimeFormatOptions = {\n  month: 'short',\n  day: '2-digit',\n};\n\ninterface ReportDataSelectorProps {\n  value: DateRangeValue;\n  onChange: (value: DateRangeValue) => void;\n  compactOnMobile?: boolean;\n}\nexport function ReportDateSelector({\n  value,\n  onChange,\n  compactOnMobile = true,\n}: ReportDataSelectorProps) {\n  const isMobile = useIsMobileMediaQuery();\n  return (\n    <DialogTrigger\n      type=\"popover\"\n      onClose={value => {\n        if (value) {\n          onChange(value);\n        }\n      }}\n    >\n      <Button variant=\"outline\" color=\"chip\" endIcon={<DateRangeIcon />}>\n        <FormattedDateTimeRange\n          start={value.start}\n          end={value.end}\n          options={\n            isMobile && compactOnMobile\n              ? monthDayFormat\n              : DateFormatPresets.short\n          }\n        />\n      </Button>\n      <DateSelectorDialog value={value} />\n    </DialogTrigger>\n  );\n}\n\ninterface DateSelectorDialogProps {\n  value: DateRangeValue;\n}\nfunction DateSelectorDialog({value}: DateSelectorDialogProps) {\n  const isMobile = useIsMobileMediaQuery();\n  const state = useDateRangePickerState({\n    defaultValue: value,\n    closeDialogOnSelection: false,\n  });\n  return (\n    <DateRangeDialog state={state} showInlineDatePickerField={!isMobile} />\n  );\n}\n","import {ReactNode, Ref} from 'react';\nimport clsx from 'clsx';\n\nexport interface ChartLayoutProps {\n  title: ReactNode;\n  description?: ReactNode;\n  className?: string;\n  children: ReactNode;\n  contentIsFlex?: boolean;\n  contentClassName?: string;\n  minHeight?: string;\n  contentRef?: Ref<HTMLDivElement>;\n  isLoading?: boolean;\n}\nexport function ChartLayout(props: ChartLayoutProps) {\n  const {\n    title,\n    description,\n    children,\n    className,\n    contentIsFlex = true,\n    contentClassName,\n    contentRef,\n    minHeight = 'min-h-440',\n  } = props;\n\n  return (\n    <div\n      className={clsx(\n        'bg border rounded h-full flex flex-col flex-auto',\n        minHeight,\n        className\n      )}\n    >\n      <div className=\"text-xs p-14 flex-shrink-0 flex justify-between items-center\">\n        <div className=\"font-semibold text-sm\">{title}</div>\n        {description && <div className=\"text-muted\">{description}</div>}\n      </div>\n      <div\n        ref={contentRef}\n        className={clsx(\n          'p-14 relative',\n          contentIsFlex && 'flex-auto flex items-center justify-center',\n          contentClassName\n        )}\n      >\n        {children}\n      </div>\n    </div>\n  );\n}\n","import {ProgressCircle} from '@common/ui/progress/progress-circle';\nimport {Trans} from '@common/i18n/trans';\n\nexport function ChartLoadingIndicator() {\n  return (\n    <div className=\"flex items-center gap-10 text-sm absolute mx-auto\">\n      <ProgressCircle isIndeterminate size=\"sm\" />\n      <Trans message=\"Chart loading\" />\n    </div>\n  );\n}\n","import type {ChartData, ChartOptions, ChartType} from 'chart.js';\nimport {lazy, Suspense} from 'react';\nimport {ChartLayout, ChartLayoutProps} from './chart-layout';\nimport {ChartLoadingIndicator} from '@common/charts/chart-loading-indicator';\n\nconst LazyChart = lazy(() => import('./lazy-chart'));\n\nexport interface BaseChartProps<Type extends ChartType = ChartType>\n  extends Omit<ChartLayoutProps, 'children'> {\n  type: Type;\n  data: ChartData<Type, unknown>;\n  options?: ChartOptions<Type>;\n  hideLegend?: boolean;\n}\nexport function BaseChart<Type extends ChartType = ChartType>(\n  props: BaseChartProps<Type>\n) {\n  const {title, description, className, contentRef, isLoading} = props;\n\n  return (\n    <ChartLayout\n      title={title}\n      description={description}\n      className={className}\n      contentRef={contentRef}\n    >\n      <Suspense fallback={<ChartLoadingIndicator />}>\n        <LazyChart {...props} />\n        {isLoading && <ChartLoadingIndicator />}\n      </Suspense>\n    </ChartLayout>\n  );\n}\n","import {DateFormatter, parseAbsoluteToLocal} from '@internationalized/date';\nimport memoize from 'nano-memoize';\nimport {ChartType} from 'chart.js';\nimport {\n  FormattedDatasetItem,\n  FormattedReportData,\n} from './formatted-dataset-item';\nimport {\n  DatasetItem,\n  RangedDatasetGranularity,\n  ReportMetric,\n} from '../../admin/analytics/report-metric';\nimport {shallowEqual} from '../../utils/shallow-equal';\n\ninterface Options {\n  localeCode: string;\n  shareFirstDatasetLabels?: boolean;\n}\n\ntype FormattedDatasetLabels = Omit<FormattedDatasetItem, 'value'>;\n\nexport function formatReportData(\n  report: ReportMetric | undefined,\n  {localeCode = 'en', shareFirstDatasetLabels = true}: Options\n): FormattedReportData {\n  if (!report) return {datasets: []};\n\n  const firstDatasetLabels: FormattedDatasetLabels[] = [];\n\n  return {\n    ...report,\n    datasets: report.datasets.map((dataset, datasetIndex) => {\n      const data = dataset.data.map((datasetItem, itemIndex) => {\n        let label: FormattedDatasetLabels;\n        // when there are multiple datasets, we'll need to use labels from the first dataset, so charts are\n        // overlapped over one another, otherwise they will be side by side, if labels in all datasets are not identical.\n        if (datasetIndex === 0 || !shareFirstDatasetLabels) {\n          label = generateDatasetLabels(\n            datasetItem,\n            report.granularity,\n            localeCode\n          );\n          firstDatasetLabels[itemIndex] = label;\n        } else {\n          label = firstDatasetLabels[itemIndex];\n        }\n        return {\n          ...label,\n          value: datasetItem.value,\n        };\n      });\n\n      return {...dataset, data};\n    }),\n  };\n}\n\nfunction generateDatasetLabels<T extends ChartType = ChartType>(\n  datum: DatasetItem,\n  granularity: RangedDatasetGranularity | undefined,\n  locale: string\n): FormattedDatasetLabels {\n  if (datum.label != null) {\n    return {label: datum.label};\n  }\n\n  if (!datum.date) {\n    return {label: ''};\n  }\n\n  return generateTimeLabels(datum, granularity, locale);\n}\n\nfunction generateTimeLabels(\n  {date: isoDate, endDate: isoEndDate, value}: DatasetItem,\n  granularity: RangedDatasetGranularity | undefined = 'day',\n  locale: string\n): Omit<FormattedDatasetItem, 'value'> {\n  const date = parseAbsoluteToLocal(isoDate).toDate();\n  const endDate = isoEndDate ? parseAbsoluteToLocal(isoEndDate).toDate() : null;\n\n  switch (granularity) {\n    case 'minute':\n      return {\n        label: getFormatter(locale, {\n          second: '2-digit',\n        }).format(date),\n        tooltipTitle: getFormatter(locale, {\n          day: '2-digit',\n          hour: 'numeric',\n          minute: 'numeric',\n          second: '2-digit',\n        }).format(date),\n      };\n    case 'hour':\n      return {\n        label: getFormatter(locale, {\n          hour: 'numeric',\n          minute: 'numeric',\n        }).format(date),\n        tooltipTitle: getFormatter(locale, {\n          month: 'short',\n          day: '2-digit',\n          hour: 'numeric',\n          minute: 'numeric',\n        }).format(date),\n      };\n    case 'day':\n      return {\n        label: getFormatter(locale, {\n          day: '2-digit',\n          weekday: 'short',\n        }).format(date),\n        tooltipTitle: getFormatter(locale, {\n          day: '2-digit',\n          weekday: 'short',\n          month: 'short',\n        }).format(date),\n      };\n    case 'week':\n      return {\n        label: getFormatter(locale, {\n          month: 'short',\n          day: '2-digit',\n        }).format(date),\n        tooltipTitle: getFormatter(locale, {\n          day: '2-digit',\n          month: 'long',\n          year: 'numeric',\n        }).formatRange(date, endDate as Date),\n      };\n    case 'month':\n      return {\n        label: getFormatter(locale, {\n          month: 'short',\n          year: 'numeric',\n        }).format(date),\n        tooltipTitle: getFormatter(locale, {\n          month: 'long',\n          year: 'numeric',\n        }).format(date),\n      };\n    case 'year':\n      return {\n        label: getFormatter(locale, {\n          year: 'numeric',\n        }).format(date),\n        tooltipTitle: getFormatter(locale, {\n          year: 'numeric',\n        }).format(date),\n      };\n  }\n}\n\nconst getFormatter = memoize(\n  (locale, options: Intl.DateTimeFormatOptions) => {\n    return new DateFormatter(locale, options);\n  },\n  {\n    equals: (a, b) => {\n      return shallowEqual(a, b);\n    },\n    callTimeout: undefined as any,\n  }\n);\n","import {getBootstrapData} from '@common/core/bootstrap-data/use-backend-bootstrap-data';\n\nconst primaryColor = getBootstrapData().themes.all[0].colors['--be-primary'];\nexport const ChartColors = [\n  [\n    `rgb(${primaryColor.replaceAll(' ', ',')})`,\n    `rgba(${primaryColor.replaceAll(' ', ',')},0.2)`,\n  ],\n  ['rgb(255,112,67)', 'rgb(255,112,67,0.2)'],\n  ['rgb(255,167,38)', 'rgb(255,167,38,0.2)'],\n  ['rgb(141,110,99)', 'rgb(141,110,99,0.2)'],\n  ['rgb(102,187,106)', 'rgba(102,187,106,0.2)'],\n  ['rgb(92,107,192)', 'rgb(92,107,192,0.2)'],\n];\n","import {BaseChart, BaseChartProps} from './base-chart';\nimport {ReportMetric} from '../admin/analytics/report-metric';\nimport {useMemo} from 'react';\nimport {formatReportData} from './data/format-report-data';\nimport {useSelectedLocale} from '../i18n/selected-locale';\nimport {ChartData, ChartOptions} from 'chart.js';\nimport {ChartColors} from './chart-colors';\nimport {FormattedDatasetItem} from './data/formatted-dataset-item';\nimport clsx from 'clsx';\n\nconst LineChartOptions: ChartOptions<'line'> = {\n  parsing: {\n    xAxisKey: 'label',\n    yAxisKey: 'value',\n  },\n  datasets: {\n    line: {\n      fill: 'origin',\n      tension: 0.1,\n      pointBorderWidth: 4,\n      pointHitRadius: 10,\n    },\n  },\n  plugins: {\n    tooltip: {\n      intersect: false,\n      mode: 'index',\n    },\n  },\n};\n\ninterface LineChartProps extends Omit<BaseChartProps<'line'>, 'type' | 'data'> {\n  data?: ReportMetric;\n}\nexport function LineChart({data, className, ...props}: LineChartProps) {\n  const {localeCode} = useSelectedLocale();\n  const formattedData: ChartData<'line', FormattedDatasetItem[]> =\n    useMemo(() => {\n      const formattedData = formatReportData(data, {localeCode});\n      formattedData.datasets = formattedData.datasets.map((dataset, i) => ({\n        ...dataset,\n        backgroundColor: ChartColors[i][1],\n        borderColor: ChartColors[i][0],\n        pointBackgroundColor: ChartColors[i][0],\n      }));\n      return formattedData;\n    }, [data, localeCode]);\n\n  return (\n    <BaseChart\n      {...props}\n      className={clsx(className, 'min-w-500')}\n      data={formattedData}\n      type=\"line\"\n      options={LineChartOptions}\n    />\n  );\n}\n","import {BaseChart, BaseChartProps} from './base-chart';\nimport {ChartData, ChartOptions} from 'chart.js';\nimport {ChartColors} from './chart-colors';\nimport {useSelectedLocale} from '../i18n/selected-locale';\nimport {useMemo} from 'react';\nimport {formatReportData} from './data/format-report-data';\nimport {ReportMetric} from '../admin/analytics/report-metric';\nimport {FormattedDatasetItem} from './data/formatted-dataset-item';\nimport clsx from 'clsx';\n\nconst PolarAreaChartOptions: ChartOptions<'polarArea'> = {\n  parsing: {\n    key: 'value',\n  },\n  plugins: {\n    tooltip: {\n      intersect: true,\n    },\n  },\n};\n\ninterface PolarAreaChartProps\n  extends Omit<BaseChartProps<'polarArea'>, 'type' | 'data'> {\n  data?: ReportMetric;\n}\nexport function PolarAreaChart({\n  data,\n  className,\n  ...props\n}: PolarAreaChartProps) {\n  const {localeCode} = useSelectedLocale();\n  const formattedData: ChartData<'polarArea', FormattedDatasetItem[]> =\n    useMemo(() => {\n      const formattedData = formatReportData(data, {localeCode});\n      formattedData.labels = formattedData.datasets[0]?.data.map(d => d.label);\n      formattedData.datasets = formattedData.datasets.map((dataset, i) => ({\n        ...dataset,\n        backgroundColor: ChartColors.map(c => c[1]),\n        borderColor: ChartColors.map(c => c[0]),\n        borderWidth: 2,\n      }));\n      return formattedData;\n    }, [data, localeCode]);\n\n  return (\n    <BaseChart\n      type=\"polarArea\"\n      data={formattedData}\n      options={PolarAreaChartOptions}\n      className={clsx(className, 'min-w-500')}\n      {...props}\n    />\n  );\n}\n","import lazyLoader from '../../../utils/http/lazy-loader';\nimport {useSettings} from '@common/core/settings/use-settings';\nimport {RefObject, useCallback, useEffect, useRef} from 'react';\nimport {useThemeSelector} from '@common/ui/themes/theme-selector-context';\nimport {themeValueToHex} from '@common/ui/themes/utils/theme-value-to-hex';\nimport {useTrans} from '@common/i18n/use-trans';\nimport {message} from '@common/i18n/message';\nimport {LocationDatasetItem} from '@common/admin/analytics/report-metric';\n\nconst loaderUrl = 'https://www.gstatic.com/charts/loader.js';\n\ninterface UseGoogleGeoChartProps {\n  placeholderRef: RefObject<HTMLDivElement>;\n  data: LocationDatasetItem[];\n  onCountrySelected?: (countryCode: string) => void;\n  country?: string;\n}\nexport function useGoogleGeoChart({\n  placeholderRef,\n  data,\n  country,\n  onCountrySelected,\n}: UseGoogleGeoChartProps) {\n  const {trans} = useTrans();\n  const {analytics} = useSettings();\n  const apiKey = analytics?.gchart_api_key;\n  const {selectedTheme} = useThemeSelector();\n  const geoChartRef = useRef<google.visualization.GeoChart>();\n  // only allow selecting countries, not cities\n  const regionInteractivity = !!onCountrySelected && !country;\n  const drawGoogleChart = useCallback(() => {\n    if (typeof google === 'undefined') return;\n\n    const seedData = data.map(location => [location.label, location.value]);\n    seedData.unshift([\n      country ? trans(message('City')) : trans(message('Country')),\n      trans(message('Clicks')),\n    ]);\n\n    const backgroundColor = `${themeValueToHex(\n      selectedTheme.colors['--be-paper']\n    )}`;\n    const chartColor = `${themeValueToHex(\n      selectedTheme.colors['--be-primary']\n    )}`;\n\n    const options: google.visualization.GeoChartOptions = {\n      colorAxis: {colors: [chartColor]},\n      backgroundColor,\n      region: country ? country.toUpperCase() : undefined,\n      resolution: country ? 'provinces' : 'countries',\n      displayMode: country ? 'markers' : 'regions',\n      enableRegionInteractivity: regionInteractivity,\n    };\n\n    if (\n      !geoChartRef.current &&\n      placeholderRef.current &&\n      google?.visualization?.GeoChart\n    ) {\n      geoChartRef.current = new google.visualization.GeoChart(\n        placeholderRef.current\n      );\n    }\n    geoChartRef.current?.draw(\n      google.visualization.arrayToDataTable(seedData),\n      options\n    );\n  }, [\n    selectedTheme,\n    data,\n    placeholderRef,\n    trans,\n    country,\n    regionInteractivity,\n  ]);\n\n  const initGoogleGeoChart = useCallback(() => {\n    if (lazyLoader.alreadyLoading(loaderUrl)) return;\n    lazyLoader.loadAsset(loaderUrl, {type: 'js'}).then(() => {\n      google.charts.load('current', {\n        packages: ['geochart'],\n        // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings\n        mapsApiKey: apiKey,\n        callback: () => {\n          drawGoogleChart();\n          if (geoChartRef.current && onCountrySelected) {\n            google.visualization.events.addListener(\n              geoChartRef.current,\n              'regionClick',\n              (a: {region: string}) => {\n                onCountrySelected?.(a.region);\n              }\n            );\n          }\n        },\n      });\n    });\n  }, [apiKey, drawGoogleChart, onCountrySelected]);\n\n  // on component load: load chart library then draw, otherwise just draw\n  useEffect(() => {\n    initGoogleGeoChart();\n  }, [initGoogleGeoChart]);\n\n  // redraw chart if data or theme changes\n  useEffect(() => {\n    drawGoogleChart();\n  }, [selectedTheme, drawGoogleChart, data]);\n\n  return {drawGoogleChart};\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const ArrowBackIcon = createSvgIcon(\n  <path d=\"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z\" />\n, 'ArrowBackOutlined');\n","import {useSelectedLocale} from '@common/i18n/selected-locale';\nimport {Fragment, memo} from 'react';\n\ninterface Props {\n  code: string;\n}\nexport const FormattedCountryName = memo(({code: countryCode}: Props) => {\n  const {localeCode} = useSelectedLocale();\n  const regionNames = new Intl.DisplayNames([localeCode], {type: 'region'});\n  let formattedName: string | undefined;\n\n  try {\n    formattedName = regionNames.of(countryCode.toUpperCase());\n  } catch (e) {}\n\n  return <Fragment>{formattedName}</Fragment>;\n});\n","import {\n  LocationDatasetItem,\n  ReportMetric,\n} from '@common/admin/analytics/report-metric';\nimport React, {useMemo, useRef} from 'react';\nimport {useGoogleGeoChart} from './use-google-geo-chart';\nimport {ChartLayout, ChartLayoutProps} from '@common/charts/chart-layout';\nimport {Trans} from '@common/i18n/trans';\nimport {ChartLoadingIndicator} from '@common/charts/chart-loading-indicator';\nimport {Button} from '@common/ui/buttons/button';\nimport {ArrowBackIcon} from '@common/icons/material/ArrowBack';\nimport clsx from 'clsx';\nimport {InfoDialogTrigger} from '@common/ui/overlays/dialog/info-dialog-trigger/info-dialog-trigger';\nimport {FormattedCountryName} from '@common/i18n/formatted-country-name';\n\ninterface GeoChartData extends Partial<ChartLayoutProps> {\n  data?: ReportMetric<LocationDatasetItem>;\n  onCountrySelected?: (countryCode: string | undefined) => void;\n  country?: string;\n}\nexport function GeoChart({\n  data: metricData,\n  isLoading,\n  onCountrySelected,\n  country,\n  ...layoutProps\n}: GeoChartData) {\n  const placeholderRef = useRef<HTMLDivElement>(null);\n  const regionInteractivity = !!onCountrySelected;\n\n  // memo data to avoid redrawing chart on rerender\n  const initialData = metricData?.datasets[0].data;\n  const data = useMemo(() => {\n    return initialData || [];\n  }, [initialData]);\n  useGoogleGeoChart({placeholderRef, data, country, onCountrySelected});\n\n  return (\n    <ChartLayout\n      {...layoutProps}\n      className=\"min-w-500\"\n      title={\n        <div className=\"flex items-center\">\n          <Trans message=\"Top Locations\" />\n          {country ? (\n            <span className=\"pl-4\">\n              ({<FormattedCountryName code={country} />})\n            </span>\n          ) : null}\n          {regionInteractivity && <InfoTrigger />}\n        </div>\n      }\n      contentIsFlex={isLoading}\n    >\n      {isLoading && <ChartLoadingIndicator />}\n      <div className=\"flex gap-24\">\n        <div\n          ref={placeholderRef}\n          className=\"flex-auto w-[480px] min-h-[340px]\"\n        />\n        <div className=\"w-[170px]\">\n          <div className=\"text-sm max-h-[340px] w-full flex-initial overflow-y-auto\">\n            {data.map(location => (\n              <div\n                key={location.label}\n                className={clsx(\n                  'flex items-center gap-4 mb-4',\n                  regionInteractivity && 'cursor-pointer hover:underline'\n                )}\n                role={regionInteractivity ? 'button' : undefined}\n                onClick={() => {\n                  onCountrySelected?.(location.code);\n                }}\n              >\n                <div className=\"max-w-110 whitespace-nowrap overflow-hidden overflow-ellipsis\">\n                  {location.label}\n                </div>\n                <div>({location.percentage})%</div>\n              </div>\n            ))}\n          </div>\n          {country && (\n            <Button\n              variant=\"outline\"\n              size=\"xs\"\n              className=\"mt-14\"\n              startIcon={<ArrowBackIcon />}\n              onClick={() => {\n                onCountrySelected?.(undefined);\n              }}\n            >\n              <Trans message=\"Back to countries\" />\n            </Button>\n          )}\n        </div>\n      </div>\n    </ChartLayout>\n  );\n}\n\nfunction InfoTrigger() {\n  return (\n    <InfoDialogTrigger\n      title={<Trans message=\"Zooming in\" />}\n      body={\n        <Trans message=\"Click on a country inside the map or country list to zoom in and see city data for that country.\" />\n      }\n    />\n  );\n}\n","import {useQuery} from '@tanstack/react-query';\nimport {DateRangeValue} from '@common/ui/forms/input-field/date/date-range-picker/date-range-value';\nimport {apiClient} from '@common/http/query-client';\nimport {\n  DatasetItem,\n  LocationDatasetItem,\n  ReportMetric,\n} from '@common/admin/analytics/report-metric';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {Track} from '@app/web-player/tracks/track';\nimport {User} from '@common/auth/user';\nimport {Artist} from '@app/web-player/artists/artist';\nimport {Album} from '@app/web-player/albums/album';\n\nconst endpoint = 'reports/insights';\n\nexport interface TopModelDatasetItem extends DatasetItem {\n  model: Artist | Album | Track | User;\n}\n\nexport interface FetchInsightsReportResponse extends BackendResponse {\n  report: {\n    totalClicks: number;\n    plays: ReportMetric;\n    browsers: ReportMetric;\n    locations: ReportMetric<LocationDatasetItem>;\n    devices: ReportMetric;\n    platforms: ReportMetric;\n    tracks: ReportMetric<TopModelDatasetItem>;\n    artists: ReportMetric<TopModelDatasetItem>;\n    albums: ReportMetric<TopModelDatasetItem>;\n    users: ReportMetric<TopModelDatasetItem>;\n  };\n}\n\nexport type InsightsReportMetric =\n  | 'plays'\n  | 'devices'\n  | 'browsers'\n  | 'platforms'\n  | 'locations'\n  | 'tracks'\n  | 'artists'\n  | 'albums'\n  | 'users';\n\ninterface Payload {\n  dateRange: DateRangeValue;\n  model?: string;\n  metrics?: InsightsReportMetric[];\n}\n\ninterface Options {\n  isEnabled: boolean;\n}\n\nexport function useInsightsReport(payload: Payload, options: Options) {\n  return useQuery([endpoint, payload], () => fetchReport(endpoint, payload), {\n    keepPreviousData: true,\n    enabled: options.isEnabled,\n  });\n}\n\nfunction fetchReport<\n  T extends FetchInsightsReportResponse = FetchInsightsReportResponse\n>(endpoint: string, payload: Payload): Promise<T> {\n  const params: Record<string, any> = {\n    model: payload.model,\n    metrics: payload.metrics?.join(','),\n  };\n  params.startDate = payload.dateRange.start.toAbsoluteString();\n  params.endDate = payload.dateRange.end.toAbsoluteString();\n  params.timezone = payload.dateRange.start.timeZone;\n\n  return apiClient.get(endpoint, {params}).then(response => response.data);\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const InfoIcon = createSvgIcon(\n  <path d=\"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z\" />\n, 'InfoOutlined');\n","import {Trans} from '@common/i18n/trans';\nimport {ChartLayout, ChartLayoutProps} from '@common/charts/chart-layout';\nimport React, {Fragment, ReactElement} from 'react';\nimport {ReportMetric} from '@common/admin/analytics/report-metric';\nimport {ChartLoadingIndicator} from '@common/charts/chart-loading-indicator';\nimport {TopModelDatasetItem} from '@app/admin/reports/requests/use-insights-report';\nimport {PlayArrowFilledIcon} from '@app/web-player/tracks/play-arrow-filled';\nimport {InfoIcon} from '@common/icons/material/Info';\nimport {FormattedNumber} from '@common/i18n/formatted-number';\nimport {Link, useLocation} from 'react-router-dom';\nimport {SmallArtistImage} from '@app/web-player/artists/artist-image/small-artist-image';\nimport {ArtistLink} from '@app/web-player/artists/artist-link';\nimport {AlbumImage} from '@app/web-player/albums/album-image/album-image';\nimport {TrackImage} from '@app/web-player/tracks/track-image/track-image';\nimport {AlbumLink} from '@app/web-player/albums/album-link';\nimport {TrackLink} from '@app/web-player/tracks/track-link';\nimport {ArtistLinks} from '@app/web-player/artists/artist-links';\nimport {UserProfileLink} from '@app/web-player/users/user-profile-link';\nimport {UserAvatar} from '@common/ui/images/user-avatar';\n\ninterface Props extends Partial<ChartLayoutProps> {\n  data?: ReportMetric<TopModelDatasetItem>;\n  title: ReactElement;\n}\nexport function TopModelsChartLayout({data, isLoading, ...layoutProps}: Props) {\n  const dataItems = data?.datasets[0].data || [];\n\n  return (\n    <ChartLayout\n      {...layoutProps}\n      className=\"min-w-500 md:min-w-0 w-1/2\"\n      contentIsFlex={isLoading}\n      contentClassName=\"max-h-[370px] overflow-y-auto compact-scrollbar\"\n    >\n      {isLoading && <ChartLoadingIndicator />}\n      {dataItems.map(item => (\n        <div\n          key={item.model.id}\n          className=\"mb-20 text-sm flex items-center justify-between gap-24\"\n        >\n          <div className=\"flex items-center gap-8\">\n            <Image\n              model={item.model}\n              size=\"w-42 h-42\"\n              className=\"rounded flex-shrink-0\"\n            />\n            <div>\n              <div className=\"text-sm\">\n                <Name model={item.model} />\n              </div>\n              <div className=\"text-xs text-muted\">\n                <Description model={item.model} />\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-4 flex-shrink-0\">\n            <PlayArrowFilledIcon className=\"text-muted\" size=\"sm\" />\n            <Trans\n              message=\":count plays\"\n              values={{count: <FormattedNumber value={item.value} />}}\n            />\n          </div>\n        </div>\n      ))}\n      {!isLoading && !dataItems.length ? (\n        <div className=\"flex items-center gap-8 text-muted\">\n          <InfoIcon size=\"sm\" />\n          <Trans message=\"No plays in selected timeframe.\" />\n        </div>\n      ) : null}\n    </ChartLayout>\n  );\n}\n\ninterface ImageProps {\n  model: TopModelDatasetItem['model'];\n  size: string;\n  className: string;\n}\nfunction Image({model, size, className}: ImageProps) {\n  const {pathname} = useLocation();\n  const inAdmin = pathname.includes('/admin');\n  const link = inAdmin\n    ? `/admin/${model.model_type}s/${model.id}/insights`\n    : `/backstage/${model.model_type}s/${model.id}/insights`;\n\n  switch (model.model_type) {\n    case 'artist':\n      return (\n        <Link to={link}>\n          <SmallArtistImage artist={model} size={size} className={className} />\n        </Link>\n      );\n    case 'album':\n      return (\n        <Link to={link}>\n          <AlbumImage album={model} size={size} className={className} />\n        </Link>\n      );\n    case 'track':\n      return (\n        <Link to={link}>\n          <TrackImage track={model} size={size} className={className} />\n        </Link>\n      );\n    case 'user':\n      // there's no separate insights page for user\n      return <UserAvatar user={model} size={size} className={className} />;\n  }\n}\n\ninterface NameProps {\n  model: TopModelDatasetItem['model'];\n}\nfunction Name({model}: NameProps) {\n  switch (model.model_type) {\n    case 'artist':\n      return <ArtistLink artist={model} target=\"_blank\" />;\n    case 'album':\n      return <AlbumLink album={model} target=\"_blank\" />;\n    case 'track':\n      return <TrackLink track={model} target=\"_blank\" />;\n    case 'user':\n      return model.id ? (\n        <UserProfileLink user={model} target=\"_blank\" />\n      ) : (\n        <Fragment>{model.display_name}</Fragment>\n      );\n  }\n}\n\ninterface DescriptionProps {\n  model: TopModelDatasetItem['model'];\n}\nfunction Description({model}: DescriptionProps) {\n  switch (model.model_type) {\n    case 'artist':\n    case 'user':\n      return null;\n    case 'album':\n    case 'track':\n      return <ArtistLinks artists={model.artists} target=\"_blank\" />;\n  }\n}\n","import React, {\n  cloneElement,\n  Fragment,\n  ReactElement,\n  useCallback,\n  useRef,\n  useState,\n} from 'react';\nimport {LineChart} from '@common/charts/line-chart';\nimport {Trans} from '@common/i18n/trans';\nimport {FormattedNumber} from '@common/i18n/formatted-number';\nimport {PolarAreaChart} from '@common/charts/polar-area-chart';\nimport {GeoChart} from '@common/admin/analytics/geo-chart/geo-chart';\nimport {BaseChartProps} from '@common/charts/base-chart';\nimport {DateRangeValue} from '@common/ui/forms/input-field/date/date-range-picker/date-range-value';\nimport {UseQueryResult} from '@tanstack/react-query';\nimport {\n  FetchInsightsReportResponse,\n  InsightsReportMetric,\n  useInsightsReport,\n} from '@app/admin/reports/requests/use-insights-report';\nimport {TopModelsChartLayout} from '@app/admin/reports/top-models-chart-layout';\n\nexport interface InsightsReportChartsProps {\n  showTracks?: boolean;\n  showArtistsAndAlbums?: boolean;\n  dateRange?: DateRangeValue;\n  model?: string;\n}\nexport function InsightsReportCharts(props: InsightsReportChartsProps) {\n  const colGap = 'gap-12 md:gap-24 mb-12 md:mb-24';\n  const rowClassName = `flex flex-col lg:flex-row lg:items-center overflow-x-auto ${colGap}`;\n\n  // will be set via \"cloneElement\"\n  const model = props.model as string;\n  const dateRange = props.dateRange as DateRangeValue;\n\n  return (\n    <Fragment>\n      <div className={rowClassName}>\n        <AsyncChart metric=\"plays\" model={model} dateRange={dateRange}>\n          {({data}) => (\n            <LineChart\n              className=\"flex-auto\"\n              title={<Trans message=\"Plays\" />}\n              hideLegend\n              description={\n                <Trans\n                  message=\":count total plays\"\n                  values={{\n                    count: (\n                      <FormattedNumber value={data?.report.plays.total || 0} />\n                    ),\n                  }}\n                />\n              }\n            />\n          )}\n        </AsyncChart>\n        <AsyncChart metric=\"devices\" model={model} dateRange={dateRange}>\n          <PolarAreaChart title={<Trans message=\"Top devices\" />} />\n        </AsyncChart>\n      </div>\n      <div className={rowClassName}>\n        {props.showTracks && (\n          <AsyncChart metric=\"tracks\" model={model} dateRange={dateRange}>\n            <TopModelsChartLayout\n              title={<Trans message=\"Most played tracks\" />}\n            />\n          </AsyncChart>\n        )}\n        <AsyncChart metric=\"users\" model={model} dateRange={dateRange}>\n          <TopModelsChartLayout title={<Trans message=\"Top listeners\" />} />\n        </AsyncChart>\n      </div>\n      {props.showArtistsAndAlbums && (\n        <div className={rowClassName}>\n          <AsyncChart metric=\"artists\" model={model} dateRange={dateRange}>\n            <TopModelsChartLayout\n              title={<Trans message=\"Most played artists\" />}\n            />\n          </AsyncChart>\n          <AsyncChart metric=\"albums\" model={model} dateRange={dateRange}>\n            <TopModelsChartLayout\n              title={<Trans message=\"Most played albums\" />}\n            />\n          </AsyncChart>\n        </div>\n      )}\n      <div className={rowClassName}>\n        <AsyncChart metric=\"locations\" model={model} dateRange={dateRange}>\n          <GeoChart className=\"flex-auto w-1/2 lg:max-w-[740px]\" />\n        </AsyncChart>\n        <AsyncChart metric=\"platforms\" model={model} dateRange={dateRange}>\n          <PolarAreaChart\n            className=\"max-w-500\"\n            title={<Trans message=\"Top platforms\" />}\n          />\n        </AsyncChart>\n      </div>\n    </Fragment>\n  );\n}\n\ninterface AsyncChartProps {\n  children:\n    | ReactElement<BaseChartProps>\n    | ((\n        query: UseQueryResult<FetchInsightsReportResponse>\n      ) => ReactElement<BaseChartProps>);\n  metric: InsightsReportMetric;\n  model: string;\n  dateRange: DateRangeValue;\n}\nfunction AsyncChart({children, metric, model, dateRange}: AsyncChartProps) {\n  const [isEnabled, setIsEnabled] = useState(false);\n  const query = useInsightsReport(\n    {metrics: [metric], model, dateRange},\n    {isEnabled}\n  );\n  const chart = typeof children === 'function' ? children(query) : children;\n  const observerRef = useRef<IntersectionObserver>();\n\n  const contentRef = useCallback((el: HTMLDivElement | null) => {\n    if (el) {\n      const observer = new IntersectionObserver(\n        ([e]) => {\n          if (e.isIntersecting) {\n            setIsEnabled(true);\n            observerRef.current?.disconnect();\n            observerRef.current = undefined;\n          }\n        },\n        {threshold: 0.1} // if only header is visible, don't load\n      );\n      observerRef.current = observer;\n      observer.observe(el);\n    } else if (observerRef.current) {\n      observerRef.current?.disconnect();\n    }\n  }, []);\n\n  return cloneElement<BaseChartProps>(chart, {\n    data: query.data?.report?.[metric],\n    isLoading: query.isLoading,\n    contentRef,\n  });\n}\n","import {Trans} from '@common/i18n/trans';\nimport React, {cloneElement, Fragment, ReactElement, useState} from 'react';\nimport {DateRangeValue} from '@common/ui/forms/input-field/date/date-range-picker/date-range-value';\nimport {DateRangePresets} from '@common/ui/forms/input-field/date/date-range-picker/dialog/date-range-presets';\nimport {ReportDateSelector} from '@common/admin/analytics/report-date-selector';\nimport {StaticPageTitle} from '@common/seo/static-page-title';\nimport {InsightsReportChartsProps} from '@app/admin/reports/insights-report-charts';\nimport {Navbar} from '@common/ui/navigation/navbar/navbar';\nimport {Footer} from '@common/ui/footer/footer';\nimport {Skeleton} from '@common/ui/skeleton/skeleton';\n\ninterface Props {\n  children: ReactElement<InsightsReportChartsProps>;\n  reportModel: string;\n  title?: ReactElement;\n  isNested?: boolean;\n}\nexport function BackstageInsightsLayout({\n  children,\n  reportModel,\n  title,\n  isNested,\n}: Props) {\n  const [dateRange, setDateRange] = useState<DateRangeValue>(() => {\n    // This week\n    return DateRangePresets[2].getRangeValue();\n  });\n  return (\n    <Fragment>\n      <StaticPageTitle>\n        <Trans message=\"Insights\" />\n      </StaticPageTitle>\n      <div className=\"h-full flex flex-col\">\n        {!isNested && (\n          <Navbar className=\"flex-shrink-0\" color=\"bg\" darkModeColor=\"bg\" />\n        )}\n        <div className=\"overflow-y-auto flex-auto bg-cover relative\">\n          <div className=\"min-h-full p-12 md:p-24 overflow-x-hidden max-w-[1600px] mx-auto flex flex-col\">\n            <div className=\"flex-auto\">\n              <div className=\"md:flex items-center justify-between gap-24 h-48 mt-14 mb-38\">\n                {title ? title : <Skeleton className=\"max-w-320\" />}\n                <div className=\"flex-shrink-0 flex items-center justify-between gap-10 md:gap-24\">\n                  <ReportDateSelector\n                    value={dateRange}\n                    onChange={setDateRange}\n                  />\n                </div>\n              </div>\n              {cloneElement(children, {dateRange, model: reportModel})}\n            </div>\n            {!isNested && <Footer />}\n          </div>\n        </div>\n      </div>\n    </Fragment>\n  );\n}\n","import {Trans} from '@common/i18n/trans';\nimport React, {cloneElement, ReactElement} from 'react';\n\ninterface Props {\n  image: ReactElement<{size: string; className: string}>;\n  name: ReactElement;\n  description?: ReactElement;\n}\nexport function BackstageInsightsTitle({image, name, description}: Props) {\n  return (\n    <div className=\"flex items-center gap-10\">\n      {cloneElement(image, {size: 'w-48 h-48', className: 'rounded'})}\n      <div>\n        <h1 className=\"text-base whitespace-nowrap overflow-hidden overflow-ellipsis\">\n          {name} <Trans message=\"insights\" />\n        </h1>\n        {description && <div className=\"text-muted text-sm\">{description}</div>}\n      </div>\n    </div>\n  );\n}\n","import {useParams} from 'react-router-dom';\nimport {BackstageInsightsLayout} from '@app/web-player/backstage/insights/backstage-insights-layout';\nimport {InsightsReportCharts} from '@app/admin/reports/insights-report-charts';\nimport React from 'react';\nimport {useArtist} from '@app/web-player/artists/requests/use-artist';\nimport {BackstageInsightsTitle} from '@app/web-player/backstage/insights/backstage-insights-title';\nimport {SmallArtistImage} from '@app/web-player/artists/artist-image/small-artist-image';\nimport {ArtistLink} from '@app/web-player/artists/artist-link';\n\ninterface Props {\n  isNested?: boolean;\n}\nexport function BackstageArtistInsights({isNested}: Props) {\n  const {artistId} = useParams();\n  const {data} = useArtist({});\n  return (\n    <BackstageInsightsLayout\n      reportModel={`artist=${artistId}`}\n      title={\n        data?.artist && (\n          <BackstageInsightsTitle\n            image={<SmallArtistImage artist={data.artist} />}\n            name={<ArtistLink artist={data.artist} />}\n          />\n        )\n      }\n      isNested={isNested}\n    >\n      <InsightsReportCharts showTracks />\n    </BackstageInsightsLayout>\n  );\n}\n","import {useParams} from 'react-router-dom';\nimport {BackstageInsightsLayout} from '@app/web-player/backstage/insights/backstage-insights-layout';\nimport {InsightsReportCharts} from '@app/admin/reports/insights-report-charts';\nimport React from 'react';\nimport {useAlbum} from '@app/web-player/albums/requests/use-album';\nimport {BackstageInsightsTitle} from '@app/web-player/backstage/insights/backstage-insights-title';\nimport {ArtistLinks} from '@app/web-player/artists/artist-links';\nimport {AlbumImage} from '@app/web-player/albums/album-image/album-image';\nimport {AlbumLink} from '@app/web-player/albums/album-link';\n\ninterface Props {\n  isNested?: boolean;\n}\nexport function BackstageAlbumInsights({isNested}: Props) {\n  const {albumId} = useParams();\n  const {data} = useAlbum({});\n  return (\n    <BackstageInsightsLayout\n      reportModel={`album=${albumId}`}\n      title={\n        data?.album && (\n          <BackstageInsightsTitle\n            image={<AlbumImage album={data.album} />}\n            name={<AlbumLink album={data.album} />}\n            description={<ArtistLinks artists={data.album.artists} />}\n          />\n        )\n      }\n      isNested={isNested}\n    >\n      <InsightsReportCharts showTracks />\n    </BackstageInsightsLayout>\n  );\n}\n","import {useParams} from 'react-router-dom';\nimport {BackstageInsightsLayout} from '@app/web-player/backstage/insights/backstage-insights-layout';\nimport {InsightsReportCharts} from '@app/admin/reports/insights-report-charts';\nimport React from 'react';\nimport {useTrack} from '@app/web-player/tracks/requests/use-track';\nimport {BackstageInsightsTitle} from '@app/web-player/backstage/insights/backstage-insights-title';\nimport {TrackImage} from '@app/web-player/tracks/track-image/track-image';\nimport {TrackLink} from '@app/web-player/tracks/track-link';\nimport {ArtistLinks} from '@app/web-player/artists/artist-links';\n\ninterface Props {\n  isNested?: boolean;\n}\nexport function BackstageTrackInsights({isNested}: Props) {\n  const {trackId} = useParams();\n  const {data} = useTrack({});\n  return (\n    <BackstageInsightsLayout\n      reportModel={`track=${trackId}`}\n      title={\n        data?.track && (\n          <BackstageInsightsTitle\n            image={<TrackImage track={data.track} />}\n            name={<TrackLink track={data.track} />}\n            description={<ArtistLinks artists={data.track.artists} />}\n          />\n        )\n      }\n      isNested={isNested}\n    >\n      <InsightsReportCharts />\n    </BackstageInsightsLayout>\n  );\n}\n"],"names":["startOfDay","date","endOfDay","getUserTimezone","defaultTimezone","getBootstrapData","preferredTimezone","_a","getLocalTimeZone","Now","now","locale","DateRangePresets","message","startOfWeek","endOfWeek","start","startOfYear","endOfYear","DateRangeIcon","createSvgIcon","jsx","Input","React","props","ref","children","inputProps","wrapperProps","className","autoFocus","style","onClick","clsx","FocusScope","DatePickerField","inputRef","onBlur","other","fieldClassNames","getInputFieldClassNames","objRef","useObjectRef","fieldProps","useField","Field","mergeProps","e","createFocusManager","getDefaultGranularity","CalendarDate","dateIsInvalid","min","max","useBaseDatePickerState","selectedDate","timezone","useUserTimezone","calendarIsOpen","setCalendarIsOpen","useState","closeDialogOnSelection","granularity","toZoned","useCurrentDateTime","useMemo","useDateRangePickerState","isPlaceholder","setIsPlaceholder","_b","setStateValue","internalValue","setInternalValue","useControlledState","completeRange","clear","useCallback","anchorDate","setAnchorDate","isHighlighting","setIsHighlighting","highlightedRange","setHighlightedRange","calendarDates","setCalendarDates","rangeToCalendarDates","constrainRange","range","end","maxDate","startMax","minDate","endMin","setSelectedValue","newRange","value","dayIsActive","day","isSameDay","dayIsHighlighted","dayIsRangeStart","dayIsRangeEnd","getCellProps","isSameMonth","makeRange","finalRange","toCalendarDate","startOfMonth","endOfMonth","ArrowRightAltIcon","adjustSegment","part","amount","options","hours","isPM","setSegment","segmentValue","wasPM","PAGE_STEP","EditableDateSegment","segment","domProps","onChange","isMobile","useIsMobileMediaQuery","enteredKeys","useRef","localeCode","useSelectedLocale","focusManager","useFocusManager","formatter","useDateFormatter","parser","NumberParser","setSegmentValue","newValue","adjustSegmentValue","backspace","parsed","today","onKeyDown","onInput","amPmFormatter","am","amDate","pm","pmDate","key","numberValue","allowsZero","shouldSetValue","spinButtonProps","LiteralDateSegment","getSegmentLimits","type","getMinimumMonthInYear","getMinimumDayInMonth","DateSegmentList","segmentProps","state","memoOptions","dateValue","segments","limits","textValue","index","CalendarCell","currentMonth","dayOfWeek","getDayOfWeek","isActive","isHighlighted","isRangeStart","isRangeEnd","dayIsToday","isToday","sameMonth","isDisabled","jsxs","CalendarMonth","startDate","isFirst","isLast","weeksInMonth","getWeeksInMonth","monthStart","CalendarMonthHeader","WeekdayHeader","weekIndex","m","dayIndex","shiftCalendars","direction","count","newDates","monthFormatter","isBackwardDisabled","isForwardDisabled","IconButton","KeyboardArrowLeftIcon","KeyboardArrowRightIcon","dayFormatter","dateDay","weekday","Calendar","visibleMonths","Fragment","FormattedDateTimeRange","memo","preset","dates","useSettings","DateFormatPresets","castToDate","shallowEqual","parseAbsolute","DatePresetList","onPresetSelected","selectedValue","List","ListItem","Trans","DateRangeDialog","showInlineDatePickerField","isTablet","useIsTabletMediaQuery","close","useDialogContext","initialStateRef","hasPlaceholder","footer","DialogFooter","Button","Dialog","DialogBody","AnimatePresence","Calendars","InlineDatePickerField","DatatableDataQueryKey","endpoint","params","useDatatableData","useQuery","paginate","apiClient","response","defaultEndpoint","model","prefix","useNormalizedModels","queryParams","queryOptions","userEndpoint","fetchUsers","r","buildEndpoint","modelName","modelId","useNormalizedModel","fetchModel","NormalizedModelField","modelType","label","defaultValue","description","errorMessage","invalid","openMenuOnFocus","customEndpoint","disabled","inputValue","setInputValue","query","trans","useTrans","SelectedModelPreview","ComboBox","Item","Avatar","onEditClick","data","isLoading","LoadingSkeleton","opacityAnimation","Tooltip","EditIcon","Skeleton","FormNormalizedModelField","name","error","useController","useDatePickerState","DatePicker","showCalendarFooter","dialog","DialogTrigger","openOnClick","isHourSegment","FormDatePicker","format","v","parseAbsoluteToLocal","parsedValue","formProps","stringToChipValue","ChipFieldInner","fieldRef","displayWith","validateWith","suggestions","onInputValueChange","onItemSelected","placeholder","onOpenChange","chipSize","showEmptyMessage","propsValue","propsOnChange","valueKey","isAsync","allowCustomValue","showDropdownArrow","onChipClick","inputFieldProps","useChipFieldValueState","listboxIsOpen","setListboxIsOpen","loadingIndicator","ProgressCircle","dropdownArrow","KeyboardArrowDownIcon","ListWrapper","ChipInput","items","setItems","displayChipUsing","manager","removeItem","i","cr","newItems","ChipList","item","Chip","setChips","chips","inputClassName","addItems","listbox","useListbox","handleItemSelection","activeIndex","setActiveIndex","isOpen","setIsOpen","refs","listboxId","collection","onInputChange","option","useLayoutEffect","handleTriggerKeyDown","handleListboxKeyboardNavigation","useListboxKeyboardNavigation","handleFocusAndClick","createEventHandler","Listbox","Popover","emails","selection","email","input","mixedValueToChipValue","propsDefaultValue","handleChange","ChipField","FormChipField","DragHandleIcon","useStickySentinel","isSticky","setIsSticky","observerRef","sentinelRef","sentinel","observer","CrupdateResourceLayout","onSubmit","form","title","disableSaveWhenNotDirty","wrapInContainer","isDirty","Form","InfoDialogTriggerIcon","InfoDialogTrigger","body","dialogSize","DialogHeader","musicImage","useArtistPickerSuggestions","fetchArtists","FormArtistPicker","result","FormNormalizedModelChipField","TAG_MODEL","FileUploadIcon","TrackUploadStatusText","fileUpload","status","bytesUploaded","totalBytes","prettyBytes","uploadedBytes","statusMessage","TrackUploadProgress","onAbort","size","UploadStatusButton","ProgressBar","useFileUploadStore","s","statusButton","errMessage","AnimatedStatus","MixedText","ErrorIcon","WarningIcon","CheckCircleIcon","CloseIcon","useExtractTackFileMetadata","useMutation","payload","extractMeta","err","showHttpErrorToast","metadataToFormValues","values","hydrateAlbumForm","mergeArraysWithoutDuplicates","mergeTrackFormValues","newValues","oldValues","nv","ov","FiftyMB","useTrackUploader","uploads","restrictions","UploadInputType","extractMetadata","optionsRef","uploadMultiple","updateFileUpload","getUpload","updateUpload","uploadId","newMeta","uploadOptions","Disk","entry","file","formValues","toast","validateUploads","files","validFiles","validateUpload","uploadTracks","waveData","generateWaveformData","openUploadWindow","useTrackUpload","upload","isUploading","meta","isProcessing","TrackFormUploadButton","setUploadId","setValue","watch","getValues","useFormContext","openFilePicker","newData","mergedValues","activeUpload","abortUpload","clearInactive","TrackForm","showExternalIdFields","showAlbumField","uploadButton","FormImageSelector","FormTextField","ALBUM_MODEL","GENRE_MODEL","DurationField","SourceField","SpotifyIdField","spotify_is_setup","FormattedDuration","useCreateTrack","onSuccess","createTrack","queryClient","onFormQueryError","prepareTrackPayload","artist","useCreateTrackForm","onTrackCreated","defaultValues","useForm","CreateTrackPage","navigate","useNavigate","pathname","useLocation","getTrackLink","FileUploadProvider","Endpoint","id","useUpdateTrack","updateChannel","useUpdateTrackForm","track","updateTrack","UpdateTrackPage","useTrack","PageContent","PageStatus","canEdit","useTrackPermissions","Navigate","useCreateAlbum","createAlbum","prepareAlbumPayload","useUpdateAlbum","albumId","updateAlbum","getAlbumLink","UpdateTrackDialog","hideAlbumField","formId","CreateTrackDialog","AlbumTracksForm","fields","remove","prepend","move","useFieldArray","f","tracks","newTrack","AddIcon","field","TrackItem","oldIndex","newIndex","IllustratedMessage","SvgImage","onRemove","onUpdate","onSort","previewRef","sortableProps","useSortable","updatedTrack","isConfirmed","ConfirmationDialog","RowDragPreview","content","DragPreview","AlbumForm","UpdateAlbumPage","useAlbum","album","useAlbumPermissions","uploadIsInProgress","AlbumUploader","forwardRef","onUploadStart","onCancel","onCreate","userArtist","usePrimaryArtistForCurrentUser","isVisible","setIsVisible","useImperativeHandle","TracksUploader","setTracks","prev","allTracks","TrackUploadItem","createdTrack","t","newTracks","useEffect","uploadProgress","albumBorderImage","UploadedMediaPreview","media","isAlbum","absoluteLink","AlbumImage","TrackImage","ArtistLinks","genre","parts","Link","LinkStyle","ShareMediaButtons","TextField","DropTargetMask","mask","resetMinutesLimitQuery","user","useUserMinutesLimit","useAuth","userId","fetchLimit","lightBgImage","darkBgImage","BackstageLayout","isDarkMode","useIsDarkMode","Navbar","Footer","UploadPage","backstageLayout","Content","uploadMode","setUploadMode","modeIsLocked","setModeIsLocked","uploaderRef","Uploader","createdItems","setCreatedItems","isDragOver","setIsDragOver","droppableProps","useDroppable","draggable","Wrapper","DefaultWrapper","UploadPanel","onUpload","onUploadModeChange","Switch","CreateAlbumPage","searchParams","useSearchParams","ARTIST_MODEL","useBackstageRequest","requestId","useParams","fetchBackstageRequest","trackId","DocumentScannerIcon","Columns","AlbumLink","FormattedDate","FormattedNumber","RowActions","ArtistAlbumsTable","albums","artistId","sortDescriptor","onSortChange","useSortableTableData","Table","deleteAlbum","useDeleteAlbum","CrupdateArtistForm","showExternalFields","FormSwitch","Tabs","TabList","Tab","TabPanels","TabPanel","DetailsPanel","ProfileLinksForm","BiographyPanel","ImagesPanel","append","useUpdateArtist","getArtistLink","UpdateArtistPage","useArtist","useArtistPermissions","updateArtist","monthDayFormat","ReportDateSelector","compactOnMobile","DateSelectorDialog","ChartLayout","contentIsFlex","contentClassName","contentRef","minHeight","ChartLoadingIndicator","LazyChart","lazy","__vitePreload","BaseChart","Suspense","formatReportData","report","shareFirstDatasetLabels","firstDatasetLabels","dataset","datasetIndex","datasetItem","itemIndex","generateDatasetLabels","datum","generateTimeLabels","isoDate","isoEndDate","endDate","getFormatter","memoize","DateFormatter","a","b","primaryColor","ChartColors","LineChartOptions","LineChart","formattedData","PolarAreaChartOptions","PolarAreaChart","d","c","loaderUrl","useGoogleGeoChart","placeholderRef","country","onCountrySelected","analytics","apiKey","selectedTheme","useThemeSelector","geoChartRef","regionInteractivity","drawGoogleChart","seedData","location","backgroundColor","themeValueToHex","initGoogleGeoChart","lazyLoader","ArrowBackIcon","FormattedCountryName","countryCode","regionNames","formattedName","GeoChart","metricData","layoutProps","initialData","InfoTrigger","useInsightsReport","fetchReport","InfoIcon","TopModelsChartLayout","dataItems","Image","Name","Description","PlayArrowFilledIcon","link","SmallArtistImage","UserAvatar","ArtistLink","TrackLink","UserProfileLink","InsightsReportCharts","rowClassName","dateRange","AsyncChart","metric","isEnabled","setIsEnabled","chart","el","cloneElement","BackstageInsightsLayout","reportModel","isNested","setDateRange","StaticPageTitle","BackstageInsightsTitle","image","BackstageArtistInsights","BackstageAlbumInsights","BackstageTrackInsights"],"mappings":"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"}